%!TEX root = main-cav.tex

\section{Decision procedure for the non-zero output problem}\label{sec:dec-snt}

Our goal in this section is to present a decision procedure for the non-zero output problem of normalized SNTs.  In the following, we fix a normalized SNT $\Ss = (Q,X,Y,\delta,q_0,O)$ such that $X=\{ x_1,\dots, x_k\}$ and $Y = \{y_1,\dots,y_l\}$. We illustrate the main ideas of the decision procedure for the situation that the guards in the transitions are constant-free, that is, the guards contain no comparisons with constants. The discussions of the more general situation are migrated to the appendix. 

We will present the decision procedure step by step.
\begin{itemize}
\item We first demonstrate how to summarize the computations of $\Ss$ on paths and on cycles (see Section~\ref{sec-sum}). 
%
\item Then we present a decision procedure for the situation that the transition graph of $\Ss$ is a generalized lassos (see Section~\ref{sec-glasso}). The transition graph of $\Ss$ is said to be a generalized lasso if it comprises a handle $H=q_0 q_1 \dots q_m$ and a collection of simple cycles $C_1,\dots,C_n$ such that $q_m$ is the unique state shared by different cycles from $C_1,\dots,C_n$. 
%
\item Finally, we show how the decision procedure for generalized lassos can be generalized to the situation that the transition graph is generalized flat (see Section~\ref{sec-gflat}).
\end{itemize}

%Finally, we will show how to adapt the algorithm for the situation that the guards of the transitions may contain the comparisons with integer constants.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\subsection{Summarization of the computations on paths and cycles}\label{sec-sum}

Suppose that $P=p_0 \xrightarrow{(g_1,\eta_1)} p_1 \dots p_{n-1} \xrightarrow{(g_n,\eta_n)} p_{n}$ is a path in the transition graph of $\Ss$. 



We assume that the initial values of the control and data variables are represented by a symbolic valuation $\sval$ of $X \cup Y$. When $P$ is traversed in a run of $\Ss$ over a data word,  the data value in a position may have to be equal or unequal to the initial value of some control variable (enforced by the guards and assignments in $P$), or have to be equal or unequal to some other data value that have been met before, or can be an arbitrary value from $\intnum$. Let $\sim$  denote the equivalence relation on $[n]$ induced by $P$ such that $i \sim j$ iff the guards and assignments on $P$ enforce that the data value in the $i$-th position has to be equal to that in the $j$-th position. Assuming that there are $r^{(P)}$ equivalence classes of $\sim$, we use the variables $\vard^{(P)}_1,\vard^{(P)}_2,\dots, \vard^{(P)}_{r^{(P)}}$ to denote the data values met when traversing $P$, one for each equivalence class. Note that here we use the superscript ${(P)}$ to denote the fact that the number $r^{(P)}$ is related to the path $(P)$. We will adopt this notation in the rest of this paper.

%Moreover, suppose that the $r$ fresh data values that are introduced when traversing the path are denoted by the variables $d^{(1)}_{1},\dots,d^{(1)}_{r}$, with one data value for each of $I_{1},\dots,I_{r}$. 
%In addition, suppose that the initial values of $y_1,\dots, y_l$ are denoted by the variables $o_1,\dots,o_l$ respectively. 

\begin{proposition}\label{prop-sum-path}
Suppose that $P$ is a path and the initial values of control and data variables are represented by a symbolic valuation $\initval$. Then the values of the control and data variables after traversing the path $P$ are specified by a symbolic valuation $\sumf^{(P,\initval)}$ of $X \cup Y$ satisfying the following conditions.
\begin{itemize}
\item There are a partition of $[k]$ into $I^{(P)}_{pe}$ and $I^{(P)}_{tr}$ (indices of persistent and transient control variables respectively) and an injective mapping $\pi^{(P)}: I^{(P)}_{tr} \rightarrow [r^{(P)}]$ such that for each $j \in I^{(P)}_{pe}$, $\sumf^{(P,\initval)}(x_j)=\sval(x_j)$, and for each $j \in I^{(P)}_{tr}$, $\sumf^{(P,\initval)}(x_j)=\vard^{(P)}_{\pi^{(P)}(j)}$.
% 
\item For each $y_j \in Y$, 
\[
\small
\begin{array}{l}
\smallskip
\sumf^{(P,\initval)}(y_j)  = \\
\hspace{2mm} \cste^{(P)}_{j} + \cstl^{(P)}_j \initval(y_j)  + \csta^{(P)}_{j,1} \initval(x_1) + \dots + \csta^{(P)}_{j,k} \initval(x_k) +  \cstb^{(P)}_{j,1} \vard^{(P)}_1 +\dots + \cstb^{(P)}_{j,r^{(P)}} \vard^{(P)}_{r^{(P)}},
\end{array}
\] 
where $\cste^{(P)}_j,\cstl^{(P)}_j, \csta^{(P)}_{j,1},\dots,\csta^{(P)}_{j,k}, \cstb^{(P)}_{j,1},\dots,\cstb^{(P)}_{j,r^{(P)}}$ are integer constants such that $\cstl^{(P)}_{j} \in \{0,1\}$ (as a result of the ``independently evolving and copyless'' constraint). Note that possibly $\cstl^{(P)}_j =0$,  which means that $\initval(y_j)$ is irrelevant to $\sumf^{(P,\initval)}(y_j)$. Similarly for $\csta^{(P)}_{j,1}=0$, and so on.
\end{itemize}
\end{proposition}
Note that in Proposition~\ref{prop-sum-path}, the two sets $I^{(P)}_{pe}$ and $I^{(P)}_{tr}$, the mapping $\pi^{(P)}$, and the constants $\cste^{(P)}_j,\cstl^{(P)}_j, \dots, \cstb^{(P)}_{j,r^{(P)}}$ for $j \in [l]$ only depend on $P$ and are independent of $\initval$.

As a corollary of Proposition~\ref{prop-sum-path}, the following result demonstrates how to summarize the computations of $\Ss$ on the composition of two paths.

\begin{corollary}\label{cor-comp-two-paths}
Suppose that $P_1= p_{1,0} \xrightarrow{(g_{1,1},\ \eta_{1,1})} p_{1,1} \dots p_{1, n_1-1} \xrightarrow{(g_{1,n_1},\ \eta_{1,n_1})} p_{1,n_1}$ and $P_2=p_{2,0} \xrightarrow{(g_{2,1},\ \eta_{2,1})} p_{2,1} \dots p_{2, n_2-1} \xrightarrow{(g_{2,n_2},\ \eta_{2,n_2})} p_{2,n_2}$ are two paths in $\Ss$ such that $p_{1,n_1}=p_{2,0}$. Moreover, let $\sumf^{(P_1, \initval)}$ (resp. $\sumf^{(P_2, \initval)}$) be the symbolic valuation summarizing the computation of $\Ss$ on $P_1$ (resp. $P_2$). Then the symbolic valuation summarizing the computation of $\Ss$ on $P_1 P_2$ is $\sumf^{(P_2,\ \sumf^{(P_1,\initval)})}$.
\end{corollary}

In order to get a better understanding of the relation between $\sumf^{(P_2,\ \sumf^{(P_1,\initval)})}$ and $(\sumf^{(P_1, \initval)},\sumf^{(P_2, \initval)})$, in the following, for each $y_j \in Y$, we obtain a more explicit form of the expression $\sumf^{(P_2,\ \sumf^{(P_1,\initval)})}(y_j)$, by unfolding therein the expression $\sumf^{(P_1,\initval)}(y_{j})$ and the expressions $\sumf^{(P_1,\initval)}(x_{j'})$ with $j' \in [k]$.
\[
\small
\begin{array}{l c l}
\medskip
\sumf^{(P_2,\ \sumf^{(P_1,\initval)})}(y_j) &  & \\
%\smallskip
%& \hspace{-2cm} = & \\
%\smallskip
%& & \hspace{-12mm} \cste^{(P_2)}_{j} + \cstl^{(P_2)}_j \sumf^{(P_1,\initval)}(y_j)  +  \csta^{(P_2)}_{j,1} \sumf^{(P_1,\initval)}(x_1) + \dots + \csta^{(P_2)}_{j,k} \sumf^{(P_1,\initval)}(x_k) +  \\
%\smallskip
%& & \hspace{-8mm}  \cstb^{(P_2)}_{j,1} \vard^{(P_2)}_1 +\dots + \cstb^{(P_2)}_{j,r} \vard^{(P_2)}_{r}
%\\
\smallskip
& \hspace{-24mm}  =  &  \\
\smallskip
& & \hspace{-12mm} \left(\cste^{(P_2)}_{j}+\cstl^{(P_2)}_{j} \cste^{(P_1)}_{j}\right)+ \left(\cstl^{(P_2)}_{j} \cstl^{(P_1)}_{j} \right) \initval(y_j)+\\
\smallskip
& &  \hspace{-12mm} \sum \limits_{j' \in I^{(P_1)}_{pe}} \left(\csta^{(P_2)}_{j,j'}+\cstl^{(P_2)}_{j} \csta^{(P_1)}_{j,j'} \right) \initval(x_{j'}) + \sum \limits_{j' \in I^{(P_1)}_{tr}} \left(\cstl^{(P_2)}_{j} \csta^{(P_1)}_{j,j'} \right) \initval(x_{j'}) + \\
%
\smallskip
& & \hspace{-12mm} \sum \limits_{j' \in \rng(\pi^{(P_1)})} \left( \csta^{(P_2)}_{j,(\pi^{(P_1)})^{-1}(j')}+\cstl^{(P_2)}_{j} \cstb^{(P_1)}_{j,j'} \right) \vard^{(P_1)}_{j'} + \\
\medskip
& & \hspace{-12mm}  \sum \limits_{j' \le [r^{(P_1)}] \setminus \rng(\pi^{(P_1)})} \left( \cstl^{(P_2)}_{j} \cstb^{(P_1)}_{j,j'} \right) \vard^{(P_1)}_{j'} + \cstb^{(P_2)}_{j,1} \vard^{(P_2)}_1 +\dots + \cstb^{(P_2)}_{j, r^{(P_2)} } \vard^{(P_2)}_{r^{(P_2)} }.
\end{array}
\] 
Below, we explain more intuitively how the coefficients in $\sumf^{(P_2,\ \sumf^{(P_1,\initval)})}(y_j)$ are obtained from $\sumf^{(P_1, \initval)}(y_j)$ and $\sumf^{(P_2, \initval)}(y_j)$.
\begin{itemize}
\item The constant coefficient is the sum of $\cste^{(P_2)}_{j}$, i.e. the constant coefficient of $\sumf^{(P_2, \initval)}$,  and $\cstl^{(P_2)}_{j} \cste^{(P_1)}_{j}$, i.e. the constant coefficient of  $\sumf^{(P_1, \initval)}$ multiplied by $\cstl^{(P_2)}_{j} $, that is, the coefficient of $\initval(y_j)$ in $\sumf^{(P_2, \initval)}$.
%
\item The coefficient of $\initval(y_j)$ is the product of the two coefficients of $\initval(y_j)$ in $\sumf^{(P_1, \initval)}$ and $\sumf^{(P_2, \initval)}$ respectively.
%
\item If $j' \in I^{(P_1)}_{pe}$, then the value of $x_{j'}$ is unchanged when traversing $P_1$. This means that the initial value of $x_{j'}$ before traversing $P_2$ is still $\initval(x_{j'})$. Thus the coefficient of $\initval(x_{j'})$ is the sum of $\csta^{(P_2)}_{j,j'}$, i.e. the coefficient of $\initval(x_{j'})$ in $\sumf^{(P_2, \initval)}$, and $\cstl^{(P_2)}_{j} \csta^{(P_1)}_{j,j'}$, i.e. the coefficient of $\initval(x_{j'})$ in $\sumf^{(P_1, \initval)}$ multiplied by $\cstl^{(P_2)}_{j}$.
%
\item If $j' \in \rng(\pi^{(P_1)})$, let $\pi^{(P)}(j'')=j'$. Then the initial value of $x_{j''}$ before traversing $P_2$ is $\vard^{(P_1)}_{j'}$. Therefore, the coefficient of $\vard^{(P_1)}_{j'}$ is the sum of $\csta^{(P_2)}_{j,j''}$, i.e. the coefficient of $\initval(x_{j''})$ in $\sumf^{(P_2, \initval)}$, and $\cstl^{(P_2)}_{j} \cstb^{(P_1)}_{j,j'}$, i.e. the coefficient of $\vard^{(P_1)}_{j'}$ in $\sumf^{(P_1, \initval)}$ multiplied by $\cstl^{(P_2)}_{j}$.
%
\item Similarly for the other coefficients.
\end{itemize}

In the following, by utilizing Proposition~\ref{prop-sum-path} and Corollary~\ref{cor-comp-two-paths}, for each path $C^{\ell}$ which is obtained by iterating a cycle $C$ for $\ell$ times, we illustrate how $\sumf^{(C^\ell,\initval)}$ is related to $\sumf^{(C,\initval)}$ and $\ell$.




%Suppose that $C$ is a cycle in $\Ss$, that is, a path $q_0 \xrightarrow{(g_1,\eta_1)} q_1 \dots q_{n-1} \xrightarrow{(g_n, \eta_n)} q_n$ such that $q_n = q_0$.  

%Suppose the initial values of the $k$ control variables are $d^{(0)}_1,\dots,d^{(0)}_k$. Moreover, suppose that the $r_C$ data values $d^{(C,1)}_{1},\dots,d^{(C,1)}_{r_C}$ are introduced when traversing the cycle for the first time. 
%In addition, suppose that the initial values of $y_1,\dots, y_l$ are $o_1,\dots,o_l$. 
%
%From Proposition~\ref{prop-sum-path}, we know that a function $\chi_C$ can be constructed to summarize the computation of $\Ss$ on $C$.
%\begin{itemize}
%\item There is an injective mapping $\pi_C: \{1,\dots,k\} \rightarrow \{1,\dots, k+r\}$ such that for each $x_j \in X$, if $\pi_C(j) \le k$, then $\pi_C(j)=j$ and $\chi_C(x_j)=d^{(0)}_{j}$, otherwise, $\chi_C(x_j)=d^{(C,1)}_{\pi_C(j)-k}$.
% 
%\item For each $y_j \in Y$, $\chi_C(y_j) = \alpha^{(C)}_{j,0} + \alpha^{(C)}_{j,1} o_j + \beta^{(C)}_{j,1} d^{(0)}_1 + \dots + \beta^{(C)}_{j,k} d^{(0)}_k + \gamma^{(C)}_{j,1} d^{(C,1)}_1 +\dots + \gamma^{(C)}_{j,r_C} d^{(C,1)}_{r_C}$ such that $\alpha^{(C)}_{j,1} \in \{0,+1\}$.
%\end{itemize}

\begin{proposition}\label{prop-sum-cycle}
Suppose $C$ is a cycle and $P=C^{\ell}$ such that $\ell \ge 2$. Then the symbolic valuation $\sumf^{(C^\ell,\initval)}$ to summarize the computation of $\Ss$ on $P$ is as follows,
\[
\small
\begin{array}{l c l}
\sumf^{(C^\ell,\initval)}(y_j)  & = & \left(\cste^{(C)}_{j} + \cstl^{(C)}_{j} \cste^{(C)}_{j}+ \dots +(\cstl^{(C)}_{j})^{\ell-1} \cste^{(C)}_{j}\right) + (\cstl^{(C)}_{j})^\ell \initval(y_j) + \\
& & \sum \limits_{j' \in I^{(C)}_{pe}} \left(\csta^{(C)}_{j,j'}+\cstl^{(C)}_{j}\csta^{(C)}_{j,j'} + \dots +(\cstl^{(C)}_{j})^{\ell-1}  \csta^{(C)}_{j,j'} \right) \initval(x_{j'}) + \\
%
& & \sum \limits_{j' \in I^{(C)}_{tr}} \left((\cstl^{(C)}_{j})^{\ell-1} \csta^{(C)}_{j,j'} \right) \initval(x_{j'}) +  \\
%
& & \sum \limits_{j' \in \rng(\pi^{(C)})} \left( (\cstl^{(C)}_{j})^{\ell-2} \csta^{(C)}_{j, (\pi^{(C)})^{-1}(j')} +(\cstl^{(C)}_{j})^{\ell-1}\cstb^{(C)}_{j,j'} \right) \vard^{(C,1)}_{j'} + \dots  +\\
%
& & \sum \limits_{j' \in \rng(\pi^{(C)})} \left( \csta^{(C)}_{j, (\pi^{(C)})^{-1}(j')}+ \cstl^{(C)}_{j} \cstb^{(C)}_{j,j'} \right) \vard^{(C,\ell-1)}_{j'} + \\
%
& & \sum \limits_{j' \in [r^{(C)}] \setminus \rng(\pi^{(C)})} \left((\cstl^{(C)}_{j})^{\ell-1} \cstb^{(C)}_{j,j'} \right) \vard^{(C,1)}_{j'} + \dots  \\
%
%
& &  \sum \limits_{j' \in [r^{(C)}] \setminus \rng(\pi^{(C)})}  \left(\cstl^{(C)}_{j} \cstb^{(C)}_{j,j'} \right) \vard^{(C,\ell-1)}_{j'} + \cstb^{(C)}_{j, 1} \vard^{(C,\ell)}_{1} + \dots + \cstb^{(C)}_{j,r^{(C)}} \vard^{(C,\ell)}_{r^{(C)}},
\end{array} 
\]
where the variables $\vard^{(C,1)}_{1},\dots, \vard^{(C,1)}_{r^{(C)}},\dots, \vard^{(C,\ell)}_{1},\dots, \vard^{(C,\ell)}_{r^{(C)}}$
 represent the data values introduced when traversing $C$ for the first time, $\dots$, and for the $\ell$-th time.
\end{proposition}

From Proposition~\ref{prop-sum-cycle} and the fact that $\cstl_{j} \in \{0, 1\}$, we have the following observation.
\begin{itemize}
\item If $\cstl^{(C)}_{j}=0$, then
\[
\small
\begin{array}{l c l}
\smallskip
\sumf^{(C^\ell,\initval)}(y_j)  & = & \cste^{(C)}_{j} +  \sum \limits_{j' \in I^{(C)}_{pe}} \csta^{(C)}_{j,j'} \initval(x_{j'}) +
\sum \limits_{j'  \in \rng(\pi^{(C)})} \csta^{(C)}_{j, (\pi^{(C)})^{-1}(j')}\ \vard^{(C,\ell-1)}_{j'} + \\
%
& & \cstb^{(C)}_{j, 1} \vard^{(C,\ell)}_{1} + \dots + \cstb^{(C)}_{j,r^{(C)}} \vard^{(C,\ell)}_{r^{(C)}}.
\end{array} 
\]
\item If $\cstl^{(C)}_{j}=1$, then 
\[
\small
\begin{array}{l c l}
\sumf^{(C^\ell,\initval)}(y_j)  & = &  \left(\cste^{(C)}_{j} \ell \right) + \initval(y_j) +   \sum  \limits_{j' \in I^{(C)}_{pe}} \left(\csta^{(C)}_{j,j'} \ell \right) \initval(x_{j'}) + \sum \limits_{j' \in I^{(C)}_{tr}} \csta^{(C)}_{j,j'} \initval(x_{j'}) +  \\
\smallskip
& & \sum \limits_{j' \in \rng(\pi^{(C)})} \left(\csta^{(C)}_{j, (\pi^{(C)})^{-1}(j')} + \cstb^{(C)}_{j,j'} \right) \vard^{(C,1)}_{j'} + \dots +\\
%
& &  \sum \limits_{j' \in \rng(\pi^{(C)})}  \left(\csta^{(C)}_{j, (\pi^{(C)})^{-1}(j')}+\cstb^{(C)}_{j,j'} \right) \vard^{(C,\ell-1)}_{j'} + \\
%
& & \sum \limits_{j' \in [r_C]  \setminus \rng(\pi^{(C)}) } \cstb^{(C)}_{j,j'} \vard^{(C,1)}_{j'} + \dots + \\
%
%
& & \sum \limits_{j' \in [r_C]  \setminus \rng(\pi^{(C)}) } \cstb^{(C)}_{j,j'} \vard^{(C,\ell-1)}_{j'} + \cstb^{(C)}_{j, 1} \vard^{(C,\ell)}_{1} + \dots + \cstb^{(C)}_{j,r^{(C)}} \vard^{(C,\ell)}_{r^{(C)}}.
\end{array} 
\]
%
\hide{
\item If $\alpha^{(C)}_{j,1}=-1$ and $\ell$ is even, then
\[
\begin{array}{l c l}
\chi^{(C)}_{\ell}(y_j)  & = &  o_j + \sum \limits_{j'\le k, \pi_C(j') \neq j'} (-\beta^{(C)}_{j,j'}) d^{(0)}_{j'} +  \\
%
& & \sum \limits_{j' \le r_C, j'+k \in \rng(\pi_C)} ( \beta^{(C)}_{j, \pi_C^{-1}(j'+k)} - \gamma^{(C)}_{j,j'}) d^{(C,1)}_{j'} + \\
%
& & \sum \limits_{j' \le r_C,  j'+k \not \in \rng(\pi_C)} (-\gamma^{(C)}_{j,j'}) d^{(C,1)}_{j'} + \dots + \\
%
& & \sum \limits_{j' \le r_C, j'+k \in \rng(\pi_C)} (\beta^{(C)}_{j, \pi_C^{-1}(j'+k)}-\gamma^{(C)}_{j,j'}) d^{(C,\ell-1)}_{j'} + \\
%
& & \sum \limits_{j' \le r_C,  j'+k \not \in \rng(\pi_C)} (-\gamma^{(C)}_{j,j'}) d^{(C,\ell-1)}_{j'} + \gamma^{(C)}_{j, 1} d^{(C,\ell)}_{1} + \dots + \gamma^{(C)}_{j,r_C} d^{(C,\ell)}_{r_C}.
\end{array} 
\]
\item If $\alpha_{j,1}=-1$ and $\ell$ is odd, then
\[
\begin{array}{l c l}
\smallskip
\chi^{(C)}_{\ell}(y_j)  & = &  \alpha^{(C)}_{j,0} - o_j + \sum \limits_{j' \le k, \pi_C(j')=j'} \beta^{(C)}_{j,j'} d^{(0)}_{j'} +  \sum \limits_{j'\le k, \pi_C(j') \neq j'}  \beta^{(C)}_{j,j'} d^{(0)}_{j'} +  \\
%
& & \sum \limits_{j' \le r_C, j'+k \in \rng(\pi_C)} ( -\beta^{(C)}_{j, \pi_C^{-1}(j'+k)} +\gamma^{(C)}_{j,j'}) d^{(C,1)}_{j'} + \\
%
& & \sum \limits_{j' \le r_C,  j'+k \not \in \rng(\pi_C)} \gamma^{(C)}_{j,j'} d^{(C,1)}_{j'} + \dots + \\
%
& & \sum \limits_{j' \le r_C, j'+k \in \rng(\pi_C)} (\beta^{(C)}_{j, \pi_C^{-1}(j'+k)}-\gamma^{(C)}_{j,j'}) d^{(C,\ell-1)}_{j'} + \\
%
& & \sum \limits_{j' \le r_C,  j'+k \not \in \rng(\pi_C)} (-\gamma^{(C)}_{j,j'}) d^{(C,\ell-1)}_{j'} + \gamma^{(C)}_{j, 1} d^{(C,\ell)}_{1} + \dots + \gamma^{(C)}_{j,r_C} d^{(C,\ell)}_{r_C}.
\end{array} 
\]
}
\end{itemize}
%
%From the analysis above, we observe that in $\chi^{(C)}_\ell(y_j)$, 
%\begin{itemize}
%\item the constant coefficient is either $\alpha^{(C)}_{j,0}$, or $\alpha^{(C)}_{j,0} \ell$, 
%
%\item the coefficient of $o_j$ is $0$, or $1$, 
%
%\item for each data value $d^{(0)}_{j'}$, the coefficient of $d^{(0)}_{j'}$ is either $\beta^{(C)}_{j,j'}$, or $0$, or $\beta^{(C)}_{j,j'} \ell$,
%
%\item for each data value $d^{(C,i)}_{j'}$ with $i \ge 1$, the coefficient of $d^{(C,i)}_{j'}$ is either $0$, or $\beta^{(C)}_{j, \pi_C^{-1}(j'+k)}$, or $\beta^{(C)}_{j, \pi_C^{-1}(j'+k)}+\gamma^{(C)}_{j,j'}$, or $\gamma^{(C)}_{j,j'}$.
%\end{itemize}


\subsection{Decision procedure for generalized lassos}\label{sec-glasso}

Before presenting the decision procedure for generalized lassos, we introduce some notations.

Suppose $P$ is a path in $\Ss$, $\initval$ is a symbolic valuation representing the initial values of the control and data variables, and $r^{(P)}$ data values are introduced when traversing $P$. Moreover, let $e$ be an expression that is a linear combination of $\initval(x_1)$, $\dots$, $\initval(x_k)$, $\vard^{(P)}_1$, $\dots$, and $\vard^{(P)}_{r^{(P)}}$, more precisely, 
\[e:=\mu_0 + \mu_1 \initval(x_1) +\dots + \mu_k \initval(x_k) + \nu_1 \initval(y_1)+\dots + \nu_l \initval(y_l)+ \xi_1 \vard^{(P)}_{1} + \dots + \xi_{r^{(P)}} \vard^{(P)}_{r^{(P)}},\]
 such that $\mu_0,\mu_1,\dots,\mu_k,\nu_1,\dots,\nu_{l}, \xi_1,\dots,\xi_{r^{(P)}}$ are the expressions that contain none of the variables from $\initval(x_1)$, $\dots$, $\initval(x_k)$, $\initval(y_1)$, $\dots$, $\initval(y_l)$, $\vard^{(P)}_1$, $\dots$, and $\vard^{(P)}_{r^{(P)}}$ (although they may contain some other variables). Then we call $\mu_0$ as the \emph{constant atom} of $e$ (with respect to $P$), and the subexpressions $\mu_1 \initval(x_1)$, $\dots$, $\mu_k \initval(x_k)$, $\nu_1 \initval(y_1)$, $\dots$, $\nu_l \initval(y_l)$, $\xi_1 \vard^{(P)}_{1}$ , $\dots$,  $\xi_{r^{(P)}} \vard^{(P)}_{r^{(P)}}$ as the $(\initval(x_1))$-atom, $\dots$, $(\initval(x_k))$-atom, $(\initval(y_1))$-atom, $\dots$, $(\initval(y_l))$-atom, $\vard^{(P)}_{1}$-atom, $\dots$, and $(\vard^{(P)}_{r^{(P)}})$-atom of $e$ respectively. Moreover, $\mu_1, \dots, \mu_k, \nu_1,\dots, \nu_{l}, \xi_1,\dots, \xi_{r^{(P)}}$ are called the \emph{coefficients} of these atoms. A non-constant atom is said to be \emph{nontrivial} if its coefficient is \emph{not} an expression that is identical to zero.

In the rest of this subsection, we assume that 
\begin{quote}
\it the transition graph of $\Ss$ comprises a handle $H=q_0 q_1 \dots q_m$ and a collection of simple cycles $C_1,\dots,C_n$ such that $q_m$ is the unique state shared by different cycles from $C_1,\dots,C_n$. Moreover, without loss of generality, we assume that $O(q_m) = a_0 + a_1 x_1 + \dots + a_k x_k + b_1 y_1 + \dots + b_l y_l$, and $O(q)$ is undefined for all the other states $q$.
\end{quote}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\hide{
From Proposition~\ref{prop-sum-path}, we know that a function $\chi_H$ can be constructed to summarize the computation of $\Ss$ on the handle. Let $d^{(0)}_{1}, \dots, d^{(0)}_{r_H}$ denote the $r_H$ data values introduced in the handle. Because all the values of the control and data variables are $\bot$ (undefined) in the initial configuration,  we can concretize $\chi_H$ as follows. 
\begin{itemize}
\item There is an injective mapping $\pi_H: \{1,\dots,k\} \rightarrow \{1,\dots, k+r\}$ such that for each $x_j \in X$, if $\pi_H(j) \le k$, then $\pi_H(j)=j$ and $\chi_H(x_j)=\bot$, otherwise, $\chi_H(x_j)=d^{(0)}_{\pi_H(j)-k}$. Without loss of generality, we assume $\pi_H(j) > k$ for each $j: 1\le j \le k$. Intuitively, this means that after traversing the handle $H$, the values of all control variables are defined (i.e. not $\bot$).
% 
\item For each $y_j \in Y$, $\chi_H(y_j) = \alpha^{(H)}_{j,0} + \alpha^{(H)}_{j,1} o_j + \gamma^{(H)}_{j,1} d^{(0)}_1 +\dots + \gamma^{(H)}_{j,r_H} d^{(0)}_{r_H}$ such that $\alpha^{(H)}_{j,1} \in \{0,+1,-1\}$. Since the initial value of the control variable $y_j$ is $o_j=\bot$, we assume that $\alpha^{(H)}_{j,1}=0$, without loss of generality.
\end{itemize}

Moreover, from Proposition~\ref{prop-sum-cycle}, we know that for each cycle $C_i$ ($1 \le i \le n$), a function $\chi^{(C_i)}_{\ell}$ can be constructed to summarize the computation of $\Ss$ on $C^{\ell}_i$ (the iteration of $C_i$ for $\ell$ times).
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

A \emph{cycle scheme} $\schm$ is a path $C_{i_1}^{\ell_1} C_{i_2}^{\ell_2} \dots C_{i_t}^{\ell_t}$ such that $i_1,\dots,i_t \in \{1,\dots,n\}$, $\ell_1,\dots, \ell_t \ge 1$, and for each $j: 1 \le j < t$, $i_j \neq i_{j+1}$. Intuitively, $\schm$ is a path obtained by iterating $C_{i_1}$ for $\ell_1$ times, $C_{i_2}$ for $\ell_2$ times, and so on. From Proposition~\ref{prop-sum-cycle} and Corollary~\ref{cor-comp-two-paths}, we know that a symbolic valuation $\sumf^{(\schm,\initval)}$ can be constructed 
%by composing $\sumf^{((C_{i_1})^{\ell_1},\initval)}$, $\dots$, and $\sumf^{((C_{i_t})^{\ell_t},\initval)}$, 
to summarize the computation of $\Ss$ on $\schm$. Suppose for each $s: 1 \le s \le t$, the data values introduced when traversing $C_{i_s}^{\ell_s}$ in $\schm$ are represented by the variables $\vard^{(C_{i_s},1)}_{s,1}$, $\dots$, $\vard^{(C_{i_s},1)}_{s,r^{(C_{i_s})}}$, $\dots$, $\vard^{(C_{i_s},\ell_s)}_{s,1}$, $\dots$, $\vard^{(C_{i_s},\ell_s)}_{s,r^{(C_{i_s})}}$. Then for each $y_j \in Y$, $\sumf^{(\schm,\initval)}(y_j)$ is a linear combination of $\initval(x_1)$, $\dots$, $\initval(x_k)$, $\initval(y_j)$, $\vard^{(C_{i_1},1)}_{1,1}$, $\dots$, $\vard^{(C_{i_1},\ell_1)}_{1,r^{(C_{i_1})}}$, $\dots$, $\vard^{(C_{i_t},1)}_{t,1}$, $\dots$, $\vard^{(C_{i_t},\ell_t)}_{t, r^{(C_{i_t})}}$. 


\begin{proposition}\label{prop-cycle-schm}
Suppose $\schm=C_{i_1}^{\ell_1} C_{i_2}^{\ell_2} \dots C_{i_t}^{\ell_t}$ is a cycle scheme, and $\initval$ is a symbolic valuation representing the initial values of the control and data variables. Then for each $j: 1 \le j \le l$ and each $j' \in I^{(C_{i_1})}_{pe}$, the coefficient of the $(\initval(x_{j'}))$-atom of $\sumf^{(\schm,\initval)}(y_j)$ contains the following subexpression,
\[\left((\lambda^{(C_{i_2})}_{j})^{\ell_2} \dots (\lambda^{(C_{i_t})}_{j})^{\ell_t}\right) \\
\left(1+\lambda^{(C_{i_1})}_{j} + \dots + (\lambda^{(C_{i_1})}_{j})^{\ell_1-1} \right) \csta^{(C_{i_1})}_{j,j'},\]
and the constant atom of $\sumf^{(\schm,\initval)}(y_j)$ is
\[
\begin{array}{l c l}
\left((\lambda^{(C_{i_2})}_{j})^{\ell_2} \dots (\lambda^{(C_{i_t})}_{j})^{\ell_t}\right)
\left(1+\lambda^{(C_{i_1})}_{j} + \dots + (\lambda^{(C_{i_1})}_{j})^{\ell_1-1} \right) \cste^{(C_{i_1})}_{j} + \\
\left((\lambda^{(C_{i_3})}_{j})^{\ell_3} \dots (\lambda^{(C_{i_t})}_{j})^{\ell_t}\right)
\left(1+\lambda^{(C_{i_2})}_{j} + \dots + (\lambda^{(C_{i_2})}_{j})^{\ell_2-1} \right) \cste^{(C_{i_2})}_{j} +\\
 \dots + 
\left(1+\lambda^{(C_{i_t})}_{j} + \dots + (\lambda^{(C_{i_t})}_{j})^{\ell_t-1} \right) \cste^{(C_{i_t})}_{j}.
\end{array}
\]
Moreover, for each $j: 1 \le j \le l$, it holds that each \emph{nontrivial} non-constant atom of $\sumf^{(\schm,\initval)}(y_j)$ such that its coefficient contains a subexpression  of the form $c\ell_1$ for some $c \in \intnum$, is in fact an $(\initval(x_{j'}))$-atom of $\sumf^{(\schm,\initval)}(y_j)$ with $j' \in I^{(C_{i_1})}_{pe}$.
\end{proposition}

We are ready to present the decision procedure. Without loss of generality, we assume that $I^{(H)}_{tr}=[k]$, that is, after traversing $H$, the values of all the control variables become defined.

\smallskip

\noindent {\bf Step I}. Decide whether $\sub{O(q_m)}{\sumf^{(H,\initval_0)}}$ is not identical to zero, where $\initval_0$ is the special symbolic valuation such that $\initval_0(x_j)=\bot$ for each $x_j \in X$ and $\initval_0(y_j)=\bot$ for each $y_j \in Y$. If the answer is yes, then the decision procedure terminates and returns the answer $\ltrue$. Otherwise, go to Step II. \qed

\medskip


From Proposition~\ref{prop-sum-path}, we know that for each $j' \in [k]$ (recall that we assume $I^{(H)}_{tr}=[k]$), $\sumf^{(H,\initval_0)}(x_{j'})=\vard^{(H)}_{\pi^{(H)}(j')}$.  Let $\schm=C_{i_1}^{\ell_1} C_{i_2}^{\ell_2} \dots C_{i_t}^{\ell_t}$ be a cycle scheme. Then from Proposition~\ref{prop-cycle-schm}, for each $j' \in  I^{(C_{i_1})}_{pe}$, the coefficient of the $\vard^{(H)}_{\pi^{(H)}(j')}$-atom of $\sub{O(q_m)}{\sumf^{(\schm,\sumf^{(H,\initval_0)})}}$ contains the following subexpression, 
\[
\sum \limits_{1 \le j \le l} 
%\begin{array}{l}
b_j \left((\cstl^{(C_{i_2})}_{j})^{\ell_2} \dots (\cstl^{(C_{i_t})}_{j})^{\ell_t}\right) 
\left(1+\cstl^{(C_{i_1})}_{j} + \dots + (\cstl^{(C_{i_1})}_{j})^{\ell_1-1} \right) \csta^{(C_{i_1})}_{j,j'}.
%\end{array} \hspace{1cm}  
\hspace{4mm} (\ast)
\]
Since $\cstl^{(C_{i_1})}_{j}, \cstl^{(C_{i_2})}_{j}, \dots, \cstl^{(C_{i_t})}_{j} \in \{0, 1\}$, the expression $(\ast)$  can be rewritten as  
 $\mu_{\schm, (i_1,j')} \ell_1 + \nu_{\schm, (i_1,j')}$ for some integer constants $\mu_{\schm, (i_1,j')}$ and $\nu_{\schm, (i_1,j')}$. 
 
Similarly, from Proposition~\ref{prop-cycle-schm},  the constant atom of  $\sub{O(q_m)}{\sumf^{(\schm,\sumf^{(H,\initval_0)})}}$ contains the following  subexpression,
\[
\sum \limits_{1 \le j \le l} b_j
\begin{array}{l}
 \left((\lambda^{(C_{i_2})}_{j})^{\ell_2} \dots (\lambda^{(C_{i_t})}_{j})^{\ell_t}\right)
\left(1+\lambda^{(C_{i_1})}_{j} + \dots + (\lambda^{(C_{i_1})}_{j})^{\ell_1-1} \right) \cste^{(C_{i_1})}_{j}. \hspace{2mm} (\ast\ast)
\end{array}
\]
%
The expression $(\ast\ast)$ can be rewritten as $\mu_{\schm,(i_1,0)} \ell_1 + \nu_{\schm,(i_1,0)}$ for some integer constants $\mu_{\schm, (i_1,0)}$ and $\nu_{\schm, (i_1,0)}$.


 
 \smallskip

\noindent {\bf Step II}. For each $i_1: 1 \le i_1 \le n$, if there is a cycle scheme $\schm=C_{i_1}^{\ell_1} C_{i_2} \dots C_{i_t}$ such that $i_2,\dots,i_t$ are mutually distinct and 
one of the following constraints is satisfied, then return $\ltrue$.
\begin{itemize}
\item There is $j' \in  I^{(C_{i_1})}_{pe}$ such that $\mu_{\schm,(i_1,j')} \neq 0$.
%
\item $\mu_{\schm,(i_1,0)} \neq 0$.
%
\end{itemize}
%
If the decision procedure has not returned yet, then go to Step III. \qed

\medskip

Let $\schm=C_{i_1}^{\ell_1} C_{i_2}^{\ell_2} \dots C_{i_t}^{\ell_t}$ be a cycle scheme. If there is $j' \in I^{(C_{i_1})}_{pe}$ such that $\mu_{\schm,(i_1,j')} \neq 0$, then we let $\vard^{(H)}_{\pi^{(H)}(j')} \neq 0$ and $\ell_1$ arbitrarily large, so that the $\vard^{(H)}_{\pi^{(H)}(j')}$-atom of $\sub{O(q_m)}{\sumf^{(\schm,\sumf^{(H,\initval_0)})}}$, whose coefficient includes the expression $\mu_{\schm, (i_1,j')} \ell_1 + \nu_{\schm, (i_1,j')}$, dominates $\sub{O(q_m)}{\sumf^{(\schm,\sumf^{(H,\initval_0)})}}$. This is sufficient to make $\sub{O(q_m)}{\sumf^{(\schm,\sumf^{(H,\initval_0)})}}$ become non-zero. Similarly, if $\mu_{\schm,(i_1,0)} \neq 0$, then we can let $\ell_1$ arbitrarily large to make $\sub{O(q_m)}{\sumf^{(\schm,\sumf^{(H,\initval_0)})}}$ become non-zero.

\smallskip

We would like to remark that in Step II, for a given index $i_1$, we restrict the cycle schemes to those of the form $C_{i_1}^{\ell_1} C_{i_2} \dots C_{i_t}$.This is justified by the following argument: For each $j: 1 \le j \le l$, $\cstl^{(C_{1})}_j, \dots, \cstl^{(C_{n})}_j \in \{0,1\}$. Therefore, for each cycle scheme $\schm=C_{i_1}^{\ell_1} C_{i_2}^{\ell_2} \dots C_{i_t}^{\ell_t}$ and each $j: 1 \le j \le l$,  we have $(\lambda^{(C_{i_2})}_{j})^{\ell_2} \dots (\lambda^{(C_{i_t})}_{j})^{\ell_t} = \lambda^{(C_{i_2})}_{j} \dots \lambda^{(C_{i_t})}_{j}$.


\begin{proposition}\label{prop-bnd-domain}
Suppose that the decision procedure has not returned yet after Step II. For each cycle scheme $\schm=C_{i_1}^{\ell_1} C_{i_2}^{\ell_2} \dots C_{i_t}^{\ell_t}$ and $y_j \in Y$, let $(\sumf^{(\schm,\initval)})'(y_j)$ denote the expression obtained by removing from the coefficients of the atoms of $\sumf^{(\schm,\initval)}(y_j)$ all the expressions of the form $c\ \ell_1$, $\dots$, or $c\ \ell_t$ (where $c$ is an integer constant).  Then the following three facts hold.
\begin{enumerate}
\item There is a valuation $\rho$ such that $\eval{\sub{O(q_m)}{\sumf^{(\schm, \sumf^{(H,\initval_0)})}}}{\rho}\neq 0$ iff there is a valuation $\rho$ such that $\eval{\sub{O(q_m)}{(\sumf^{(\schm, \sumf^{(H,\initval_0)})})'}}{\rho} \neq 0$.
%
\item There is a finite subset of $\intnum$, say $K$, such that for every cycle scheme $\schm$ and $y_j \in Y$, the constant atom and all the coefficients of atoms in $(\sumf^{(\schm, \sumf^{(H,\initval_0)})})'(y_j)$ are from $K$. 
%
\item For each cycle scheme $\schm$, an abstraction of $(\sumf^{(\schm, \sumf^{(H,\initval_0)})})'$, denoted by $\abs(\schm)$, can be defined such that $\abs(\schm) \subseteq \{0,\dots, k+1\} \times K^l$ and for each $j: 0 \le j \le k$,  $\abs(\schm) \cap (\{j\} \times K^l)$ is a singleton. Let $\Kk=\{\abs(\schm) \mid \schm \mbox{ a cycle scheme}\}$. Then $\Kk$ can be constructed effectively from $\sumf^{(H,\initval)}$, $\sumf^{(C_1,\initval)}$, $\dots$, and $\sumf^{(C_n,\initval)}$.
\end{enumerate}
\end{proposition}


\noindent {\bf Step III}. For each $U \in \Kk$, do the following.
\begin{enumerate}
\item Check whether there is $(0,(c_{0,1},\dots,c_{0,l})) \in U$ such that $a_0+b_1 c_{0,1}+\dots + b_l c_{0,l} \neq 0$. If the answer is yes, then return $\ltrue$.
%
\item Check whether there are $j \in [k]$ and $(j, (c_{j,1},\dots,c_{j,l})) \in U$ such that $a_j + b_1 c_{j,1} + \dots + b_l c_{j,l} \neq 0$. If the answer is yes, then return $\ltrue$. 
%
\item Check whether there is $(k+1,(c_1,\dots,c_n)) \in U$ such that $b_1 c_1 + \dots + b_l c_l \neq 0$. If the answer is yes, then return $\ltrue$. 
\end{enumerate}
If the decision procedure has not returned yet, return $\lfalse$.


%From the claim, it follows that the updates of the values of control and data variables along $\schm$, as well as the update of the value of the output expression $O(q_m)$, can be obtained by composing $\chi_H$, $(\chi^{(\Cc_{i_1})}_{\ell_1})'$, $\dots$, and $\chi^{(\Cc_{i_t})}_{\ell_t})'$, which can further be simulated by a $\intnum$-VASS $\Aa$, that is, an integer vector addition system with states (cf. \cite{HH14}). Then the non-zero output reachability of $\Ss$ is reduced to the non-zero reachability of $\Aa$, that is, given an index $i$, decide whether $\Aa$ can reach a vector $\vec{z}$ where $z_i \neq 0$. Finally, we decide the non-zero reachability of $\Aa$. If the answer is ``yes'', then return $\ltrue$, otherwise, return $\lfalse$.

%\begin{proposition}
%The non-zero reachability problem of $\intnum$-VASS is in NP.
%\end{proposition}
%
%\begin{proof}
%The non-zero reachability problem of $\intnum$-VASS can be reduced to the coverability problem of $\intnum$-VASS in polynomial time as follows: Given a $\intnum$-VASS $\Aa$ of dimension $m$ (that is, $m$ is the length of the integer vectors) and an index $i: 1 \le i \le m$, we construct a $\intnum$-VASS $\Bb$ as follows: From each final state of $\Aa$, nondeterministically we choose a subset $Idx \subseteq \{1,\dots,m\}$, and for each $i' \in Idx$, replace $z_{i'}$ by $-z_{i'}$. It is easy to see that $\Aa$ can reach a vector $\vec{z}$ where $z_i \neq 0$ iff $\Bb$ can reach a vector covering $(0,\dots,1,\dots,0)$, that is, the vector whose $i$-th component is $1$ and all the other components are zero.
%
% From the fact that the coverability of $\intnum$-VASS is NP-complete (\cite{HH14}), we know that the non-zero reachability problem of $\intnum$-VASS is in NP. \qed
%\end{proof}
%
%
%Therefore, in this case, the non-zero output reachability problem is reduced to the non-zero reachability problem of $\intnum$-VAS, 

\subsection{Decision procedure for SNTs}\label{sec-gflat}

In this subsection, we generalize the decision procedure in Section~\ref{sec-glasso} for the special case that the transition graphs of the SNTs are generalized lassos to SNTs.

We first introduce a notation. A \emph{generalized multi-lasso} of the transition graph of $\Ss$ is a sequence 
\[
\gmlasso= H_1 (C_{1,1},\dots,C_{1,n_1}) H_2 (C_{2,1},\dots,C_{2,n_2}) \dots H_r (C_{r,1},\dots, C_{r, n_r}),
\]
such that 
\begin{itemize}
\item for each $s: 1 \le s \le r$, $H_s = q_{s,1} \dots q_{s, m_s}$ and $H_s (C_{s,1},\dots,C_{s, n_s})$ is a generalized lasso, 

\item for each $s, s': 1 \le s < s' \le r$, $H_s (C_{s,1},\dots,C_{s, n_s})$ and $H_{s'} (C_{s', 1},\dots,C_{s', n_{s'}})$ are state-disjoint,

\item $q_{1,1}=q_0$, and for each $s: 1 \le s < r$, $q_{s, m_s}=q_{s+1,1}$.
\end{itemize}

Since the transition graph of $\Ss$ can be seen as a collection of generalized multi-lassos, in the following, we shall present the decision procedure by showing how to decide the non-zero output problem for generalized multi-lassos. 

In the rest of this section, we fix a generalized multi-lasso
\[
\gmlasso= H_1 (C_{1,1},\dots,C_{1,n_1}) H_2 (C_{2,1},\dots,C_{2,n_2}) \dots H_r (C_{r,1},\dots, C_{r, n_r}).
\]
For each $s: 1 \le s \le r$, suppose $H_s=q_{s,1} \dots q_{s, m_s}$. Without loss of generality, we assume that $O(q_{r,m_r})=a_0+a_1 x_1 + \dots + a_k x_k + b_1 y_1  + \dots + b_l y_l$ and $O(q')$ is undefined for every other state $q'$ in $\gmlasso$.

%We shall illustrate the argument by the following situation, the transition graph comprises a handle $H=q_0\dots q_{m}$,  a collection of cycles $(C_1,\dots,C_n)$ such that $q_m$ is the unique state shared by each pair of them, another handle $H'=q'_0 \dots q'_{m'}$ such that $q'_0=q_m$, and another collection of cycles $(C'_1,\dots,C'_{n'})$ such that $q'_{m'}$ is the unique state shared by each pair of them. Moreover, $O(q'_{m'})$ is defined and $O(q)$ is undefined for all the other states $q$. Suppose $O(q'_{m'}) = a_0 + a_1 x_1 + \dots + a_k x_k + b_1 y_1 + \dots + b_l y_l$.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\hide{
From Proposition~\ref{prop-sum-path}, we know that 
for the handle $H = q_0 \dots q_m$, a function $\chi_H$ can be constructed to summarize the computation on the handle. Suppose for each $j: 1 \le j \le l$,  $\chi_H(y_j) = \alpha^{(H)}_{j,0} + \gamma^{(H)}_{j,1} d^{(H,0)}_1 + \dots + \gamma^{(H)}_{j,r_H} d^{(H,0)}_{r_H}$, where $d^{(H,0)}_1,\dots, d^{(H,0)}_{r_H}$ represent the $r_H$ data values introduced in the handle. Moreover, there is an injective mapping $\pi_H$ from $\{1,\dots,k\}$ to $\{1,\dots,k+r_H\}$ such that for each $j: 1 \le j \le k$, $\chi_H(x_j) = d^{(H,0)}_{\pi_H(j)-k}$.

Similarly, for the handle $H' = q'_0 \dots q'_{m'}$, a function $\chi_{H'}$ can be constructed to summarize the computation on the handle. Let $d'_1,\dots,d'_k$ and $o'_1,\dots,o'_k$ denote the initial values of the control and data variables respectively. Then for each $j: 1 \le j \le l$,  $\chi_{H'}(y_j) = \alpha^{(H')}_{j,0} + \alpha^{(H')}_{j,1} o'_j + \beta^{(H')}_{j,1} d'_1 + \dots + \beta^{(H')}_{j,k} d'_{k}+ \gamma^{(H')}_{j,1} d^{(H',0)}_1 + \dots + \gamma^{(H')}_{j,r_{H'}} d^{(H',0)}_{r_{H'}}$, where $d^{(H',0)}_1,\dots, d^{(H',0)}_{r_{H'}}$ represent the $r_{H'}$ data values introduced in the handle. Moreover, there is an injective mapping $\pi_{H'}$ from $\{1,\dots,k\}$ to $\{1,\dots,k+r_{H'}\}$ such that for each $j: 1 \le j \le k$, if $\pi_{H'}(j)=j$, then $\chi_{H'}(x_j) = d'_j$, otherwise, $\chi_{H'}(x_j) = d^{(H',0)}_{\pi_{H'}(j)-k}$.

From Proposition~\ref{prop-sum-cycle}, we know that for $\ell \ge 1$, the functions $\chi^{(C_1)}_{\ell}$,$\dots$, $\chi^{(C_n)}_{\ell}$, $\chi^{(C'_1)}_{\ell}$, $\dots$, and $\chi^{(C'_{n'})}_{\ell}$ can be defined to summarize to computation on $C^{\ell}_1$, $\dots$, $C^{\ell}_n$, $(C'_1)^{\ell}$, $\dots$, and $(C'_n)^{\ell}$ respectively. 

Let us check the expression $\chi_{H'}(O(q'_{m'}))$ defined as follows,
\[
\begin{array}{l c l}
\smallskip
\chi_{H'}(O(q'_{m'})) & = & a_0 + a_1 \chi_{H'}(x_1) + \dots a_k \chi_{H'}(x_k) + \\
\smallskip
& & b_1 \chi_{H'}(y_1) + \dots + b_l \chi_{H'}(y_l) \\
\smallskip
&  = &  \left(a_0+\sum \limits_{1 \le j \le l} b_j \alpha^{(H')}_{j,0} \right) + \sum \limits_{j \le k, \pi_{H'}(j)=j} \left(a_j + \sum \limits_{1 \le j' \le l} b_{j'} \beta^{(H')}_{j,j'} \right) d'_j  + \\
%
& & \sum \limits_{j \le k, \pi_{H'}(j) \neq j} \left(\sum \limits_{1 \le j' \le l} (b_{j'} \beta^{(H')}_{j,j'})\right) d'_j + \sum \limits_{1\le j \le l} (b_{j} \alpha^{(H')}_{j,0}) o'_{j} + \\
\smallskip
%
& & \sum \limits_{1 \le j \le r_{H'}, j+k \in \rng(\pi_{H'})} \left(a_{(\pi_{H'})^{-1}(j+k)}+\sum \limits_{1 \le j' \le l} (b_{j'} \gamma^{(H')}_{j,j'})\right) d^{(H',0)}_j +\\ & & \dots  + \sum \limits_{1 \le j \le r_{H'}, j \not \in \rng(\pi_{H'})} \left(\sum \limits_{1 \le j' \le l} (b_{j'} \gamma^{(H')}_{j,j'})\right) d^{(H',0)}_j.
\end{array}
\] 
Let $a'_0,a'_1,\dots,a'_k,b'_1,\dots,b'_l$ denote the constant coefficient, the coefficients of $d'_1,\dots,d'_k$, and the coefficients of $o'_1,\dots,o'_l$ in $\chi_{H'}(O(q'_{m'}))$ respectively. 

Then we can adapt the output function $O$ and set $O(q_m) = a'_0 + a'_1 x_1 + \dots a'_k x_k + b'_1 y_1 + \dots b'_l y_l$.
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\smallskip

\noindent {\bf Step I$'$}. We do the same analysis for the simple path $H_1\dots H_r$ as for the handle $H$ in Step I.

\smallskip

Suppose $s: 2 \le s \le r$, and  in $\sub{O(q_{r,m_r})}{\sumf^{(H_s\dots H_{r}, \initval)}}$, the constant atom is $a'_{s,0}$, the coefficient of the $\initval(x_j)$-atom is $a'_{s, j}$ for each $j \in [k]$, moreover, the coefficient of the $\initval(y_{j'})$-atom is $b'_{s, j'}$ for each $j' \in [l]$. Then we change the output function and let
\[O(q_{s-1, m_{s-1}}):=a'_{s, 0}+a'_{s, 1} x_1 + \dots + a'_{s, k} x_k + b'_{s,1} y_1 + \dots + b'_{s, l} y_l.\]

\smallskip 
\noindent {\bf Step II$'$}.  For each $1 \le s \le r$, each $i_{s,1}\in [n_s]$, and each cycle scheme $\schm = C^{\ell_1}_{i_{s,1}} C_{i_{s,2}} \dots C_{i_{s, t}}$ over the collection of cycles $\{C_{s, 1}, \dots, C_{s,n_s},\dots, C_{r,1}, \dots, C_{r,n_r}\}$ such that $i_{s,2},\dots, i_{s,t}$ are mutually distinct, we apply an analysis to the expression $\sub{ O(q_{s, m_{s}})} {\sumf^{(\schm,\sumf^{(H_1 \dots H_{s}, \initval_0)} ) } }$, similar to Step II. If the decision procedure does not return during the analysis, then go to Step III$'$.

\smallskip

Intuitively, in Step II$'$, during the analysis of $\sub{ O(q_{s, m_{s}})} {\sumf^{(\schm,\sumf^{(H_1 \dots H_{s}, \initval_0)} ) } }$, the effect of the paths $H_{s+1},  \dots,  H_r$ and the cycles $C_{i_{s,2}}, \dots, C_{i_{s, t}}$ is described by the expressions $\cstl^{(H_{s+1})}_j \dots \cstl^{(H_{r})}_j  \cstl^{(C_{i_{s,2}})}_j \dots \cstl^{(C_{i_{s,t}})}_j $ for $j \in [l]$. Since $O(q_{s, m_{s}})$ has already taken into consideration the expressions $\cstl^{(H_{s+1})}_j \dots \cstl^{(H_{r})}_j$ for $j \in [l]$, conceptually, in Step II$'$, we can do the analysis as if we have a generalized lasso where the handle is $H_1\dots H_s$ and the collection of cycles is $\{C_{s,1},\dots, C_{s,n_s}$, $\dots$, $C_{r,1},\dots, C_{r,n_r}\}$. 

%$\schm=C^{\ell_{s, 1}}_{i_{s,1}} \dots C^{\ell_{s, t_s}}_{i_{s, t_s}} C^{\ell_{s+1, 1}}_{i_{s+1, 1} } \dots C^{\ell_{s+1, t_{s+1}}}_{i_{s+1, t_{s+1}} } \dots C^{\ell_{r, 1}}_{i_{r,1}} \dots C^{\ell_{r, t_r}}_{i_{r, t_r}} $, where for each $s': s \le s' \le r$, $i_{s',1},\dots, i_{s', t_{s'}} \in [n_{s'}]$, 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\hide
{
At first, by using $O(q_m)$, we do the following computation, similarly to Step II: For each $i_1: 1 \le i_1 \le n$, if there are a cycle scheme $\schm$  
$HC_{i_1}^{\ell_1} C_{i_2}^{\ell_2} \dots C_{i_t}^{\ell_t}
$
or 
$HC_{i_1}^{\ell_1} C_{i_2}^{\ell_2} \dots C_{i_t}^{\ell_t} (C'_{i'_1})^{\ell'_1} (C'_{i'_2})^{\ell'_2} \dots (C'_{i'_{t'}})^{\ell'_{t'}}$,
and $j' \le k$ such that 
\begin{itemize}
\item $i_2,\dots,i_t \le n$ are mutually distinct, $\ell_2 = \dots = \ell_t = 1$, 
%
\item $i'_1,\dots,i'_{t'} \le n'$ are mutually distinct, $\ell'_2 = \dots = \ell'_{t'} = 1$, 
%
\item $\pi_{C_{i_1}}(j')=j'$, and $\mu_{\schm,(i_1,j')} \neq 0$ (recall that $\mu_{\schm,(i_1,j')}$ is obtained from the coefficient of $d^{(0)}_{\pi_H(j')-k}$ in  $\chi_\schm(O(q_m))$), 
\end{itemize}
then return $\ltrue$. 

Then by using $O(q'_{m'})$, we do the following: For each $i'_1: 1 \le i'_1 \le n'$, if there are a cycle scheme $\schm' =(C'_{i'_1})^{\ell'_1} (C'_{i'_2})^{\ell'_2} \dots (C'_{i'_{t'}})^{\ell'_{t'}}$, and $j' \le k$ such that
\begin{itemize}
\item $i'_2,\dots,i'_t \le n'$ are mutually distinct, $\ell'_2 = \dots = \ell'_t = 1$, 
%
\item $\pi_{C'_{i_1}}(j')=j'$, and $\mu_{\schm',(i'_1,j')} \neq 0$ (here $\mu_{\schm',(i_1,j')}$ is obtained from the coefficient of $d''_{j'}$ in  $\chi_{\schm'}(O(q'_{m'}))$, where $d''_1,\dots,d''_k$ denote the initial data values of $x_1,\dots,x_k$ respectively),
\end{itemize}
then return $\ltrue$. 

Similarly, we can apply an analysis for the constant coefficient to $\chi_\schm(O(q_m))$. 


If the decision procedure has not return yet, then go to Step III$'$. \qed
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\smallskip

After Step II$'$, if the decision procedure has not returned yet, then similar to Proposition~\ref{prop-bnd-domain}, the following results hold.
\begin{itemize}
\item For each $s \in [r]$ and each path $\schm=H_1 \schm_1 H_2 \dots H_s \schm_s$ such that for each $s'\in [s]$, $\schm_{s'}$ is a cycle scheme over the collection of cycles $\{C_{s',1},\dots,C_{s',n_{s'}}\}$, it holds that the constant atom and all the coefficients of the non-constant atoms in $(\sumf^{(\schm,\initval_0)})'(y_j)$ are from a bounded domain $K$.
%
\item Moreover,  an abstraction of $\schm$, denoted by $\abs(\schm)$, can be defined, so that $\Kk$, which is the set of $\abs(\schm)$ for the paths $\schm=H_1 \schm_1 H_2 \dots H_s \schm_s$ (where $s \in [r]$), can be computed effectively from 
\[\sumf^{(H_1,\initval)}, \sumf^{(C_{1,1},\initval)}, \dots, \sumf^{(C_{1,n_1},\initval)},\dots, \sumf^{(H_r,\initval)}, \sumf^{(C_{r,1},\initval)}, \dots, \sumf^{(C_{r,n_r},\initval)}.\]
\end{itemize}

%Similarly to the generalized lassos, we can construct a finite state automaton $\Aa'$ from $\chi_H,\chi_{C_1},\dots,\chi_{C_n},\chi_{H'}, \chi_{C'_1},\dots,\chi_{C'_{n'}}$ to record the coefficients in the states and simulate the evolvement of these coefficients. The final states of $\Aa$ represent the coefficients obtained when reaching the state $q'_{m'}$ in $\Ss$. 

\smallskip 

\noindent {\bf Step III$'$}. We apply the same analysis to $\Kk$ as in Step III. Finally, if the procedure does not return during the analysis, return $\lfalse$.

