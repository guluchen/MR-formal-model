%!TEX root = main-cav.tex

\section{Decision procedure for the non-zero output problem}\label{sec:dec-snt}
%
We prove our main result, Theorem~\ref{thm:correctness}, by presenting a decision procedure for the non-zero output problem of SNTs. We fix a normalized SNT $\Ss = (Q,X,Y,\delta,q_0,O)$ such that $X=\{ x_1,\dots, x_k\}$ and $Y = \{y_1,\dots,y_l\}$. Due to space constraint, we only present a simplified version where the transition guards are constant-free and leave the procedure for the general case in the full version.
We define summaries of the computations of $\Ss$ on paths and cycles in Section~\ref{sec-sum}. We then present a decision procedure for the case that the transition graph of $\Ss$ is a \emph{generalized lasso} in Section~\ref{sec-glasso}. The transition graph of $\Ss$ is said to be a generalized lasso if it comprises a handle $H=q_0 q_1 \dots q_m$ and a collection of simple cycles $C_1,\dots,C_n$ such that $q_m$ is the unique state shared by each pair of distinct cycles from $\{C_1,\dots,C_n\}$. We will generalize the procedure to full SNTs in Section~\ref{sec-gflat}.

\begin{theorem}\label{thm:correctness}
The non-zero output problem of normalized SNTs can be decided in time exponential over the number of data variables and the maximum number of simple cycles in nontrivial SCCs of transition graphs.
\end{theorem}
\vspace{-2mm}

\begin{corollary}\label{cor:snt-dec-proc}
The commutativity problem of SNTs (resp. reducer programs) can be decided in time exponential over the numbers of control and data variables, and exponential over the maximum number of simple cycles in nontrivial SCCs (resp. doubly exponential over the number of branching statements in reducer programs). 
%On the other hand, the commutativity problem of reducer programs can be decided in time exponential over the number of control variables and the number of data variables, but .
\end{corollary}

\begin{remark}
Though the decision procedure for the commutativity problem of reducer programs has a complexity exponential over the number of control resp. data variables, and doubly exponential over the number of branching statements, we believe that the decision procedure could still be implemented to automatically analyze the programs in practice, in which these numbers are usually small. 
\end{remark}

\vspace{-4mm}
\subsection{Summarization of the computations on paths and cycles}\label{sec-sum}
\vspace{-1mm}

Suppose $P=p_0 \xrightarrow{(g_1,\eta_1)} p_1 \dots p_{n-1} \xrightarrow{(g_n,\eta_n)} p_{n}$ is a path of $\Ss$. We assume that the initial values of the control and data variables are represented by a symbolic valuation $\sval$ over $X \cup Y$. When $P$ is traversed in a run of $\Ss$ over a data word $w$,  the data value in a position of $w$ may have to be (un)equal to the initial value of some control variable or some other data value in $w$ that have been met before (enforced by the guards and assignments in $P$). Let $\sim$ denote the equivalence relation on $[n]$ induced by $P$ such that $i \sim j$ iff the guards and assignments on $P$ enforce that the data value in the $i$-th position of $w$ must be equal to that in the $j$-th position of $w$. Assuming that there are $r^{\circled{P}}$ equivalence classes of $\sim$, we use the variables $\vard^{\circled{P}}_1,\vard^{\circled{P}}_2,\dots, \vard^{\circled{P}}_{r^{\circled{P}}}$ to denote the data values met when traversing $P$, one for each equivalence class. Note here we use the superscript ${\circled{P}}$ to denote the fact that $r^{\circled{P}}$ (resp. $\vard^{\circled{P}}_1$, $\dots$) is associated with the path $P$.

\begin{proposition}\label{prop-sum-path}
Suppose that $P$ is a path and the initial values of $X \cup Y$ are represented by a symbolic valuation $\initval$. Then the values of $X \cup Y$ after traversing the path $P$ are specified by a symbolic valuation $\sumf^{(P,\initval)}$ satisfying the following conditions.
\begin{itemize}
\item The set of indices of $X$, i.e., $[k]$, is partitioned into $I^{\circled{P}}_{pe}$ and $I^{\circled{P}}_{tr}$, the indices of \emph{persistent} and \emph{transient} control variables, respectively. A control variable is persistent if its value has not been changed while traversing $P$, otherwise, it is transient.
\item For each $x_j\in X$ such that $j\in I^{\circled{P}}_{pe}$, $\sumf^{(P,\initval)}(x_j)=\sval(x_j)$.
%
\item  For each $x_j\in X$ such that $j\in I^{\circled{P}}_{tr}$,
$\sumf^{(P,\initval)}(x_j)=\vard^{\circled{P}}_{\pi^{\circled{P}}(j)}$, where $\pi^{\circled{P}}: I^{\circled{P}}_{tr} \rightarrow [r^{\circled{P}}]$ is an injective mapping from the index of a transient control variable to the index of the data value assigned to it.
% 
\item For each $y_j \in Y$, 
$
 \sumf^{(P,\initval)}(y_j)  =
 \cste^{\circled{P}}_{j} + 
 \cstl^{\circled{P}}_j \initval(y_j)  + 
  \sum\limits_{j'\in [k]}\csta^{\circled{P}}_{j,j'}\initval(x_{j'}) +
  \sum\limits_{j''\in [r^{\circled{P}}]}\cstb^{\circled{P}}_{j,j''} \vard^{\circled{P}}_{j''}$,
\hide{
\item For each $y_j \in Y$, 
\[
\small
\begin{array}{l}
\smallskip
\sumf^{(P,\initval)}(y_j)  = \\
\hspace{2mm} \cste^{\circled{P}}_{j} + \cstl^{\circled{P}}_j \initval(y_j)  + \csta^{\circled{P}}_{j,1} \initval(x_1) + \dots + \csta^{\circled{P}}_{j,k} \initval(x_k) +  \cstb^{\circled{P}}_{j,1} \vard^{\circled{P}}_1 +\dots + \cstb^{\circled{P}}_{j,r^{\circled{P}}} \vard^{\circled{P}}_{r^{\circled{P}}},
\end{array}
\]} 
where $\cste^{\circled{P}}_j,\cstl^{\circled{P}}_j, \csta^{\circled{P}}_{j,1},\dots,\csta^{\circled{P}}_{j,k}, \cstb^{\circled{P}}_{j,1},\dots,\cstb^{\circled{P}}_{j,r^{\circled{P}}}$ are integer constants such that $\cstl^{\circled{P}}_{j} \in \{0,1\}$ (as a result of the ``independently evolving and copyless'' constraint).  It can happen that $\cstl^{\circled{P}}_j =0$,  which means that $\initval(y_j)$ is irrelevant to $\sumf^{(P,\initval)}(y_j)$. Similarly for $\csta^{\circled{P}}_{j,1}=0$, and so on.
\end{itemize}
\end{proposition}
In Proposition~\ref{prop-sum-path}, the sets $I^{\circled{P}}_{pe}$, $I^{\circled{P}}_{tr}$, the mapping $\pi^{\circled{P}}$, and the constants $\cste^{\circled{P}}_j,\cstl^{\circled{P}}_j, \dots, \cstb^{\circled{P}}_{j,r^{\circled{P}}}$ only depend on $P$ and are independent of $\initval$. Due to the uniquely-valued constraint of normalized SNTs, $\pi^{\circled{P}}$ is injective, and the inverse function of $\pi^{\circled{P}}$, denoted $(\pi^{\circled{P}})^{-1}$, exists.

As a corollary of Proposition~\ref{prop-sum-path}, the following result demonstrates how to summarize the computations of $\Ss$ on the composition of two paths.

\begin{corollary}\label{cor-comp-two-paths}
Suppose that $P_1$ and $P_2$ are two paths in $\Ss$ such that the last state of $P_1$ is the first state of $P_2$. Moreover, let $\sumf^{(P_1, \initval)}$ (resp. $\sumf^{(P_2, \initval)}$) be the symbolic valuation summarizing the computation of $\Ss$ on $P_1$ (resp. $P_2$). Then the symbolic valuation summarizing the computation of $\Ss$ on $P_1 P_2$ is $\sumf^{(P_2,\ \sumf^{(P_1,\initval)})}$.
\end{corollary}

In order to get a better understanding of the relation between $\sumf^{(P_2,\ \sumf^{(P_1,\initval)})}$ and $(\sumf^{(P_1, \initval)},\sumf^{(P_2, \initval)})$, in the following, for each $y_j \in Y$, we obtain a more explicit form of the expression $\sumf^{(P_2,\ \sumf^{(P_1,\initval)})}(y_j)$, by unfolding therein the expression $\sumf^{(P_1,\initval)}$\medskip.
\resizebox{\hsize}{!}{
	$\begin{array}{rl}
	\medskip
	\sumf^{(P_2,\ \sumf^{(P_1,\initval)})}(y_j) = & 
	\left(\cste^{\circled{P_2}}_{j}+
	\cstl^{\circled{P_2}}_{j} \cste^{\circled{P_1}}_{j}\right)+ \left(\cstl^{\circled{P_2}}_{j} \cstl^{\circled{P_1}}_{j} \right) \initval(y_j)+ \sum \limits_{j' \in I^{\circled{P_1}}_{pe}} 
	\left(\csta^{\circled{P_2}}_{j,j'} +\cstl^{\circled{P_2}}_{j} \csta^{\circled{P_1}}_{j,j'}\right) \initval(x_{j'}) +\\
	\medskip
	& 
	\sum \limits_{j' \in  I^{\circled{P_1}}_{tr}} 
	\left(\cstl^{\circled{P_2}}_{j} \csta^{\circled{P_1}}_{j,j'} \right) \initval(x_{j'}) +
	\sum \limits_{j' \in \rng(\pi^{\circled{P_1}})} \left( \csta^{\circled{P_2}}_{j,(\pi^{\circled{P_1}})^{-1}(j')}+\cstl^{\circled{P_2}}_{j} \cstb^{\circled{P_1}}_{j,j'} \right) \vard^{\circled{P_1}}_{j'} + 
	 \\
	%
	\smallskip
	& 
	\sum \limits_{j' \in [r^{\circled{P_1}}]\setminus \rng(\pi^{\circled{P_1}})} \left( \cstl^{\circled{P_2}}_{j} \cstb^{\circled{P_1}}_{j,j'} \right) \vard^{\circled{P_1}}_{j'} +
	
	\sum \limits_{j'\in[r^{\circled{P_2}}]} \cstb^{\circled{P_2}}_{j,j'} \vard^{\circled{P_2}}_{j'}.
	\end{array}$
}\medskip\\
In the equation, $j'\in  I^{\circled{P_1}}_{pe}$ implies that $x_{j'}$ remains unchanged when traversing $P_1$, which means the initial value of $x_{j'}$ before traversing $P_2$ is still $\initval(x_{j'})$ and therefore we have the item $ (\csta^{\circled{P_2}}_{j,j'}) \initval(x_{j'})$. When $j' \in \rng(\pi^{\circled{P_1}})$, the initial value of $x_{(\pi^{\circled{P_1}})^{-1}(j')}$ before traversing $P_2$ is $\vard^{\circled{P_1}}_{j'}$ and therefore we have the item $( \csta^{\circled{P_2}}_{j,(\pi^{\circled{P_1}})^{-1}(j')}) \vard^{\circled{P_1}}_{j'}$.
For all $j'\in [k] = I^{\circled{P_1}}_{pe} \cup I^{\circled{P_1}}_{tr}$, we have the item $(\cstl^{\circled{P_2}}_{j} \csta^{\circled{P_1}}_{j,j'}) \initval(x_{j'})$, i.e. the coefficient of $\initval(x_{j'})$ in $\sumf^{(P_1, \initval)}$ multiplied by $\cstl^{\circled{P_2}}_{j}$. Moreover, for all $j'\in [r^{\circled{P_1}}] = \rng(\pi^{\circled{P_1}}) \cup ([r^{\circled{P_1}}] \setminus \rng(\pi^{\circled{P_1}}))$, we have 
the item $( \cstl^{\circled{P_2}}_{j} \cstb^{\circled{P_1}}_{j,j'}) \vard^{\circled{P_1}}_{j'}$, i.e. the coefficient of $\vard^{\circled{P_1}}_{j'}$ in $\sumf^{(P_1, \initval)}$ multiplied by $\cstl^{\circled{P_2}}_{j}$.

In the following, by utilizing Proposition~\ref{prop-sum-path} and Corollary~\ref{cor-comp-two-paths}, for each path $C^{\ell}$ which is obtained by iterating a cycle $C$ for $\ell$ times, we illustrate how $\sumf^{(C^\ell,\initval)}$ is related to $\sumf^{(C, \initval)}$ and $\ell$. For convenience, we call $\ell$ a \emph{loop counter variable}.

\begin{proposition}\label{prop-sum-cycle}
Suppose that $C$ is a cycle and $P=C^{\ell}$ such that $\ell \ge 2$. Then the symbolic valuation $\sumf^{(C^\ell,\initval)}$ to summarize the computation of $\Ss$ on $P$ is as follows,\medskip\\
\resizebox{\hsize}{!}{
$\begin{array}{l c l}
\sumf^{(C^\ell,\initval)}(y_j)  & = & 
\left(1 + \cstl^{\circled{C}}_{j} + \dots +(\cstl^{\circled{C}}_{j})^{\ell - 1} \right)\cste^{\circled{C}}_{j} + (\cstl^{\circled{C}}_{j})^\ell \initval(y_j) + \smallskip\\
%
& & \sum \limits_{j' \in I^{\circled{C}}_{pe}} \left(1+\cstl^{\circled{C}}_{j} + \dots +(\cstl^{\circled{C}}_{j})^{\ell - 1} \right) \csta^{\circled{C}}_{j,j'}\initval(x_{j'}) +  \sum \limits_{j' \in I^{\circled{C}}_{tr}}  (\cstl^{\circled{C}}_{j})^{\ell - 1} \csta^{\circled{C}}_{j,j'} \initval(x_{j'}) +  \\
%
& & \sum \limits_{j' \in \rng(\pi^{\circled{C}})} \sum \limits_{s\in[\ell -1]}
\left(  \csta^{\circled{C}}_{j, (\pi^{\circled{C}})^{-1}(j')} +(\cstl^{\circled{C}}_{j})\cstb^{\circled{C}}_{j,j'} \right)
(\cstl^{\circled{C}}_{j})^{\ell-s-1}
\vard^{\circled{C , s}}_{j'} +\\
%
& & \sum \limits_{j' \in [r^{\circled{C}}] \setminus \rng(\pi^{\circled{C}})}\sum \limits_{s\in[\ell -1]} \left((\cstl^{\circled{C}}_{j})^{\ell - s} \cstb^{\circled{C}}_{j,j'} \right) \vard^{\circled{C , s}}_{j'} + 
\sum \limits_{j' \in [r^{\circled{C}}] }  
 \cstb^{\circled{C}}_{j, j'} \vard^{\circled{C , \ell}}_{j'},
\end{array} 
$}\medskip\\
where the variables $\vard^{\circled{C , s}}_{1},\dots, \vard^{\circled{C ,s}}_{r^{\circled{C}}}$ for $s\in [\ell]$
 represent the data values introduced when traversing $C$ for the $s$-th time.
\end{proposition}

From Proposition~\ref{prop-sum-cycle} and the fact that $\cstl_{j} \in \{0, 1\}$, we have the following observation.
\begin{itemize}
\item If $\cstl^{\circled{C}}_{j}=0$, then\medskip\\
\resizebox{0.9\hsize}{!}{$
\sumf^{(C^\ell,\initval)}(y_j)   =  \cste^{\circled{C}}_{j} +  \sum \limits_{j' \in I^{\circled{C}}_{pe}} \csta^{\circled{C}}_{j,j'} \initval(x_{j'}) +
\sum \limits_{j'  \in \rng(\pi^{\circled{C}})} \csta^{\circled{C}}_{j, (\pi^{\circled{C}})^{-1}(j')}\ \vard^{\circled{C , \ell  -  1}}_{j'} + \sum \limits_{j' \in [r^{\circled{C}}] }  
\cstb^{\circled{C}}_{j, j'} \vard^{\circled{C , \ell}}_{j'}.$}


\item If $\cstl^{\circled{C}}_{j}=1$, then\medskip\\
\resizebox{0.95\hsize}{!}{$
\begin{array}{l }
\sumf^{(C^\ell,\initval)}(y_j)  =    \ell \cste^{\circled{C}}_{j}  + \initval(y_j) +   \sum  \limits_{j' \in I^{\circled{C}}_{pe}} \ell \csta^{\circled{C}}_{j,j'}  \initval(x_{j'}) + 
\sum \limits_{j' \in I^{\circled{C}}_{tr}} \csta^{\circled{C}}_{j,j'} \initval(x_{j'}) +  \smallskip\\
\sum \limits_{j' \in \rng(\pi^{\circled{C}})} \sum \limits_{s\in[\ell -1]}
\left(\csta^{\circled{C}}_{j, (\pi^{\circled{C}})^{-1}(j')} + \cstb^{\circled{C}}_{j,j'} \right) \vard^{\circled{C , s}}_{j'} + \sum \limits_{j' \in [r^{\circled{C}}]  \setminus \rng(\pi^{\circled{C}}) }\sum \limits_{s\in[\ell -1]} 
\cstb^{\circled{C}}_{j,j'} \vard^{\circled{C , s}}_{j'} + \sum \limits_{j' \in [r^{\circled{C}}] }  
\cstb^{\circled{C}}_{j, j'} \vard^{\circled{C , \ell}}_{j'}.
\end{array}
$}
%



\hide{
\item If $\alpha^{\circled{C}}_{j,1}=-1$ and $\ell$ is even, then
\[
\begin{array}{l c l}
\chi^{\circled{C}}_{\ell}(y_j)  & = &  o_j + \sum \limits_{j'\le k, \pi_C(j') \neq j'} (-\beta^{\circled{C}}_{j,j'}) d^{(0)}_{j'} +  \\
%
& & \sum \limits_{j' \le r_C ,  j'+k \in \rng(\pi_C)} ( \beta^{\circled{C}}_{j, \pi_C^{-1}(j'+k)} - \gamma^{\circled{C}}_{j,j'}) d^{\circled{C , 1}}_{j'} + \\
%
& & \sum \limits_{j' \le r_C ,   j'+k \not \in \rng(\pi_C)} (-\gamma^{\circled{C}}_{j,j'}) d^{\circled{C , 1}}_{j'} + \dots + \\
%
& & \sum \limits_{j' \le r_C ,  j'+k \in \rng(\pi_C)} (\beta^{\circled{C}}_{j, \pi_C^{-1}(j'+k)}-\gamma^{\circled{C}}_{j,j'}) d^{\circled{C , \ell  -  1}}_{j'} + \\
%
& & \sum \limits_{j' \le r_C ,   j'+k \not \in \rng(\pi_C)} (-\gamma^{\circled{C}}_{j,j'}) d^{\circled{C , \ell  -  1}}_{j'} + \gamma^{\circled{C}}_{j, 1} d^{\circled{C , \ell}}_{1} + \dots + \gamma^{\circled{C}}_{j,r_C} d^{\circled{C , \ell}}_{r_C}.
\end{array} 
\]
\item If $\alpha_{j,1}=-1$ and $\ell$ is odd, then
\[
\begin{array}{l c l}
\smallskip
\chi^{\circled{C}}_{\ell}(y_j)  & = &  \alpha^{\circled{C}}_{j,0} - o_j + \sum \limits_{j' \le k, \pi_C(j')=j'} \beta^{\circled{C}}_{j,j'} d^{(0)}_{j'} +  \sum \limits_{j'\le k, \pi_C(j') \neq j'}  \beta^{\circled{C}}_{j,j'} d^{(0)}_{j'} +  \\
%
& & \sum \limits_{j' \le r_C ,  j'+k \in \rng(\pi_C)} ( -\beta^{\circled{C}}_{j, \pi_C^{-1}(j'+k)} +\gamma^{\circled{C}}_{j,j'}) d^{\circled{C , 1}}_{j'} + \\
%
& & \sum \limits_{j' \le r_C ,   j'+k \not \in \rng(\pi_C)} \gamma^{\circled{C}}_{j,j'} d^{\circled{C , 1}}_{j'} + \dots + \\
%
& & \sum \limits_{j' \le r_C ,  j'+k \in \rng(\pi_C)} (\beta^{\circled{C}}_{j, \pi_C^{-1}(j'+k)}-\gamma^{\circled{C}}_{j,j'}) d^{\circled{C , \ell  -  1}}_{j'} + \\
%
& & \sum \limits_{j' \le r_C ,   j'+k \not \in \rng(\pi_C)} (-\gamma^{\circled{C}}_{j,j'}) d^{\circled{C , \ell  -  1}}_{j'} + \gamma^{\circled{C}}_{j, 1} d^{\circled{C , \ell}}_{1} + \dots + \gamma^{\circled{C}}_{j,r_C} d^{\circled{C , \ell}}_{r_C}.
\end{array} 
\]
}
\end{itemize}

%
%From the analysis above, we observe that in $\chi^{\circled{C}}_\ell(y_j)$, 
%\begin{itemize}
%\item the constant coefficient is either $\alpha^{\circled{C}}_{j,0}$, or $\alpha^{\circled{C}}_{j,0} \ell$, 
%
%\item the coefficient of $o_j$ is $0$, or $1$, 
%
%\item for each data value $d^{(0)}_{j'}$, the coefficient of $d^{(0)}_{j'}$ is either $\beta^{\circled{C}}_{j,j'}$, or $0$, or $\beta^{\circled{C}}_{j,j'} \ell$,
%
%\item for each data value $d^{(C , i)}_{j'}$ with $i \ge 1$, the coefficient of $d^{(C , i)}_{j'}$ is either $0$, or $\beta^{\circled{C}}_{j, \pi_C^{-1}(j'+k)}$, or $\beta^{\circled{C}}_{j, \pi_C^{-1}(j'+k)}+\gamma^{\circled{C}}_{j,j'}$, or $\gamma^{\circled{C}}_{j,j'}$.
%\end{itemize}

\vspace{-0.5cm}
\subsection{Decision procedure for generalized lassos}\label{sec-glasso}
\vspace{-0.2cm}
%
\yfc{newly added}
Observe the pattern of the computation summary in Proposition~\ref{prop-sum-cycle}.
The coefficients of the loop counter variable $\ell$ can be none-zero when $\cstl^{\circled{C}}_{j}=1$. The none-zero coefficients may propagate to the output expression.  In such a case, due to the ``transition-enablement'' constraint of a normalized SNT (for any sequence of transitions, one can find a corresponding run), one can pick a run corresponding to a very large $\ell$ such that it dominates the value of the output expression. Therefore the output of the SNT can be made none-zero. 
In the decision procedure we are going to present, we first check if the handle of the generalized lasso produces none-zero output in Step I.
We then check if the coefficient of $\ell$ is none-zero in the output expression in Step II. If the coefficient of $\ell$ is zero in the output expression, we show in Step III that the testing of output none-zeroness can be reduced to a finite state reachability problem and thus can be easily decided.

Before presenting the decision procedure for generalized lassos, we introduce some notations.
Let $e$ be an expression consists of symbolic values $\initval(z)$ for $z\in X\cup Y$ and data variables $\vard_1, \dots, \vard_{s_2}$. More specifically, let $e:=\mu_0 + \mu_1 \initval(z_1) +\dots + \mu_{s_1} \initval(z_{s_1}) + \xi_1 \vard_1 + \dots + \xi_{s_2} \vard_{s_2}$,
such that $\mu_0,\mu_1,\dots,\mu_{s_1}, \xi_1,\dots,\xi_{s_2}$ are expressions containing only constants and loop counter variables.
Then we call $\mu_0$ as the \emph{constant atom}, $\mu_i \initval(z_i)$ the $\initval(z_i)$-atom for $i\in[s_1]$, and $\xi_j \vard_j$ the $\vard_j$-atom for $j\in[s_2]$ of the expression $e$. Moreover, $\mu_1, \dots, \mu_{s_1}, \xi_1,\dots, \xi_{s_2}$ are called the \emph{coefficients} of these atoms. A non-constant atom is said to be \emph{nontrivial} if its coefficient is \emph{not} identical to zero.

In the rest of this subsection, we assume that the transition graph of $\Ss$ comprises a handle $H=q_0 q_1 \dots q_m$ and a collection of simple cycles $C_1,\dots,C_n$ such that $q_m$ is the unique state shared by each pair of distinct cycles from $\{C_1,\dots,C_n\}$. Moreover, without loss of generality, we assume that $O(q_m) = a_0 + a_1 x_1 + \dots + a_k x_k + b_1 y_1 + \dots + b_l y_l$, and $O(q)$ is undefined for all the other states $q$.

A \emph{cycle scheme} $\schm$ is a path $C_{i_1}^{\ell_1} C_{i_2}^{\ell_2} \dots C_{i_t}^{\ell_t}$ such that $i_1,\dots,i_t \in [n]$, $\ell_1,\dots, \ell_t \ge 1$, and for each $j\in [t-1]$, $i_j \neq i_{j+1}$. Intuitively, $\schm$ is a path obtained by iterating $C_{i_1}$ for $\ell_1$ times, $C_{i_2}$ for $\ell_2$ times, and so on. From Proposition~\ref{prop-sum-cycle} and Corollary~\ref{cor-comp-two-paths}, a symbolic valuation $\sumf^{(\schm,\initval)}$ can be constructed 
to summarize the computation of $\Ss$ on $\schm$. 


\begin{lemma}\label{prop-cycle-schm}
Suppose $\schm=C_{i_1}^{\ell_1} C_{i_2}^{\ell_2} \dots C_{i_t}^{\ell_t}$ is a cycle scheme, and $\initval$ is a symbolic valuation representing the initial values of the control and data variables. 
For all $j' \in  I^{\circled{C_{i_{1}}}}_{pe}$, let $r_{j'}$ be the largest number $r \in [t]$ such that $j'\in\bigcap_{s\in[r]} I^{\circled{C_{i_{s}}}}_{pe}$, i.e., $x_{j'}$ remains persistent when traversing $C_{i_1}^{\ell_1} C_{i_2}^{\ell_2} \dots C_{i_{r_{j'}}}^{\ell_{r_{j'}}}$.
Then for each $j\in [l]$ and $j' \in  I^{\circled{C_{i_{1}}}}_{pe}$, the coefficient of the $\initval(x_{j'})$-atom in $\sumf^{(\schm,\initval)}(y_j)$ is 
\begin{center}
\resizebox{0.8\hsize}{!}{
$e+\sum\limits_{s_1\in[r_{j'}]}  
\left(1+\lambda^{\circled{C_{i_{s_1}}}}_{j} + \dots + (\lambda^{\circled{C_{i_{s_1}}}}_{j})^{\ell_{s_1}-1} \right) \csta^{\circled{C_{i_{s_1}}}}_{j,j'}\prod\limits_{{s_2}\in[{s_1}+1,t]}\left(\lambda^{\circled{C_{i_{s_2}}}}_{j}\right)^{\ell_{s_2}}$},
\end{center}
where (1) $e\!=\!0$ when $r_{j'}\!=\!t$ and (2) $e=(\lambda^{\circled{C_{i_s}}}_{j})^{\ell_s-1} \csta^{\circled{C_{i_{s}}}}_{j,j'}$ with $s=r_{j'}+1$ when $r_{j'}<t$.\\
The constant atom of $\sumf^{(\schm,\initval)}(y_j)$ is 
\begin{center}
\resizebox{0.7\hsize}{!}{$
\sum\limits_{{s_1}\in[t]}
\left(1+\lambda^{\circled{C_{i_{s_1}}}}_{j} + \dots + (\lambda^{\circled{C_{i_{s_1}}}}_{j})^{\ell_{s_1}-1} \right)
\cste^{\circled{C_{i_{s_1}}}}_{j} 
\prod\limits_{{s_2}\in[{s_1}+1,t]}\left(\lambda^{\circled{C_{i_{s_2}}}}_{j}\right)^{\ell_{s_2}}$}
\end{center}
Moreover, for all $j\!\in\! [l]$, in $\sumf^{(\schm,\initval)}(y_j)$, only the constant atom and the coefficients of the $\initval(x_{j'})$-atoms with $j' \!\in\!I^{\circled{C_{i_{1}}}}_{pe}$ contain a subexpression of the form $ \mu_\schm \ell_1$ for some~$\mu_\schm\in \intnum$.
\end{lemma}
Notice that above, $\lambda^{\circled{C_{i_{s_1}}}}_j\in\{0,1\}$ for $j\in[l]$ and $s_1\in [t]$. Hence the value of $(1+\lambda^{\circled{C_{i_{s_1}}}}_{j} + \dots + (\lambda^{\circled{C_{i_{s_1}}}}_{j})^{\ell_{s_1}-1} )$ can only be $1$ or $\ell_{s_1}$ and $\left(\lambda^{\circled{C_{i_{s_2}}}}_{j}\right)^{\ell_{s_2}}\in\{0,1\}$.
Hence both the constant atom and the coefficient of the $\initval(x_{j'})$-atom with $j'\in I^{\circled{C_{i_{1}}}}_{pe}$ can be rewritten to the form of $c_0+c_1\ell_1+c_2\ell_2+\dots+c_t\ell_t$ for $c_0\ldots c_t\in \intnum$. Note that some of $c_0\ldots c_t$ might be zero.




We are ready to present the decision procedure. By the ``well-defined'' and ``uniquely-valued'' constraints of normalized SNTs, without loss of generality, we assume that $I^{\circled{H}}_{tr}=[k]$, that is, after traversing $H$, the values of all control variables become defined.
Under the assumption, for all $j' \in [k]$, the symbolic value of $\sumf^{(H,\sval_\bot)}(x_{j'})=\vard^{\circled{H}}_{\pi^{\circled{H}}(j')}$\smallskip\\
\framebox[\textwidth]{
\begin{minipage}{0.95\textwidth}
\noindent {\bf Step I}. Decide whether $\eval{O(q_m)}{\sumf^{(H,\sval_\bot)}}$ is not identical to zero.
This can be done by checking if the constant-atom or the coefficient of some non-constant atom of $\eval{O(q_m)}{\sumf^{(H,\sval_\bot)}}$ is not identical to zero.
If the answer is yes, then the decision procedure terminates and returns the answer $\ltrue$. Otherwise, go to Step II.
\end{minipage}
}\bigskip

The goal of Step II is either showing that in $f=\eval{O(q_m)}{\sumf^{(\schm,\sumf^{(H,\sval_\bot)})}}$, all subexpressions containing the cycle counter variables are identical to zero and hence can be ignored or showing that $f$ is not identical to zero. Let $\schm=C_{i_1}^{\ell_1} C_{i_2}^{\ell_2} \dots C_{i_t}^{\ell_t}$ be a cycle scheme. From Lemma~\ref{prop-cycle-schm}, for each $j'\in I^{\circled{C_{i_1}}}_{pe}$ and symbolic valuation $\sval$, the only subexpression containing $\ell_1$ in the coefficient of $\initval(x_{j'})$-atom of $\eval{O(q_m)}{\sumf^{(\schm,\initval)}}$ is
\begin{center}
	\resizebox{0.7\hsize}{!}{$
\sum \limits_{1 \le j \le l} 
b_j \left((\cstl^{\circled{C_{i_2}}}_{j})^{\ell_2} \dots (\cstl^{\circled{C_{i_t}}}_{j})^{\ell_t}\right) 
\left(1+\cstl^{\circled{C_{i_1}}}_{j} + \dots + (\cstl^{\circled{C_{i_1}}}_{j})^{\ell_1-1} \right) \csta^{\circled{C_{i_1}}}_{j,j'}.
\hspace{4mm} (\ast)
$}
\end{center}
Since $\cstl^{\circled{C_{i_1}}}_{j}, \cstl^{\circled{C_{i_2}}}_{j}, \dots, \cstl^{\circled{C_{i_t}}}_{j} \in \{0, 1\}$, the expression $(\ast)$  can be rewritten as  
 $\mu_{\schm, (i_1,j')} \ell_1 + \nu_{\schm, (i_1,j')}$ for some integer constants $\mu_{\schm, (i_1,j')}$ and $\nu_{\schm, (i_1,j')}$. 
 
The only subexpression containing $\ell_1$ in the constant atom of  $\eval{O(q_m)}{\sumf^{(\schm,\initval)}}$ is
\begin{center}
	\resizebox{0.7\hsize}{!}{$
\sum \limits_{1 \le j \le l} b_j
\begin{array}{l}
 \left((\lambda^{\circled{C_{i_2}}}_{j})^{\ell_2} \dots (\lambda^{\circled{C_{i_t}}}_{j})^{\ell_t}\right)
\left(1+\lambda^{\circled{C_{i_1}}}_{j} + \dots + (\lambda^{\circled{C_{i_1}}}_{j})^{\ell_1-1} \right) \cste^{\circled{C_{i_1}}}_{j}. \hspace{2mm} (\ast\ast)
\end{array}
$}
\end{center}
%
The expression $(\ast\ast)$ can be rewritten as $\mu_{\schm,(i_1,0)} \ell_1 + \nu_{\schm,(i_1,0)}$ for some integer constants $\mu_{\schm, (i_1,0)}$ and $\nu_{\schm, (i_1,0)}$. If $\mu_{\schm,(i_1,0)}=\mu_{\schm,(i_1,j')}=0$ for all $j' \in I^{\circled{C_{i_1}}}_{pe}$, then we can ignore all subexpressions containing the cycle counter variable $\ell_1$ in   $\eval{O(q_m)}{\sumf^{(\schm,\initval)}}$, i.e., the subexpressions $\mu_{\schm,(i_1,0)}\ell_1$ and $\mu_{\schm,(i_1,j')}\ell_1$ for all $j' \in I^{\circled{C_{i_1}}}_{pe}$.\smallskip\\
\framebox[\textwidth]{
	\begin{minipage}{0.95\textwidth}
		\noindent {\bf Step II}. For each $i_1 \in [n]$, check all cycle scheme $\schm=C_{i_1}^{\ell_1} C_{i_2} \dots C_{i_t}$ such that $i_2,\dots,i_t$ are mutually distinct. There are only finitely many this kind of cycle schemes. If 
		one of the following constraints is satisfied, then return $\ltrue$. \\(1) There is $j' \in  I^{\circled{C_{i_1}}}_{pe}$ such that $\mu_{\schm,(i_1,j')} \neq 0$. (2) $\mu_{\schm,(i_1,0)} \neq 0$.
		%
		If the decision procedure has not returned yet, then go to Step III.
	\end{minipage}
}\smallskip\\
If there exists $j' \in I^{\circled{C_{i_1}}}_{pe}$ such that $\mu_{\schm,(i_1,j')} \neq 0$, then we let $\vard^{\circled{H}}_{\pi^{\circled{H}}(j')} \neq 0$ and $\ell_1$ be arbitrarily large, so that the coefficient of the  $\vard^{\circled{H}}_{\pi^{\circled{H}}(j')}$-atom in $\eval{O(q_m)}{\sumf^{(\schm,\sumf^{(H,\sval_\bot)})}}$, which includes the expression $\mu_{\schm, (i_1,j')} \ell_1 + \nu_{\schm, (i_1,j')}$, dominates $\eval{O(q_m)}{\sumf^{(\schm,\sumf^{(H,\sval_\bot)})}}$. This is sufficient to make $\eval{O(q_m)}{\sumf^{(\schm,\sumf^{(H,\sval_\bot)})}}$ non-zero. Similarly, if $\mu_{\schm,(i_1,0)} \neq 0$, then we can let $\ell_1$ arbitrarily large to make the expression $\eval{O(q_m)}{\sumf^{(\schm,\sumf^{(H,\sval_\bot)})}}$ non-zero.
Similar arguments can be applied for $\ell_2\dots\ell_n$.

If Step II does not return $\ltrue$, we show below that for all cycle schemes $\schm_1=C_{i_1}^{\ell_1} C_{i_2}^{\ell_2} \dots C_{i_{s_1}}^{\ell_{s_1}}$ with $i_1,i_2,\dots,i_{s_1} \in [n]$, all subexpressions containing cycle counter variables in $\eval{O(q_m)}{\sumf^{(\schm,\initval)}}$ are identical to zero and hence can be removed. Let ${i'_2} \dots {i'_{s_2}}$ be the sequence obtained from $i_2 \dots i_{s,1}$ by keeping jus tone copy for each duplicated index therein.  
In Step II we already checked a cycle scheme $\schm_2=C_{i_1}^{\ell_1} C_{i'_2} \dots C_{i'_{s_2}}$. Step II guarantees that all subexpressions containing $\ell_1$ in 
$\eval{O(q_m)}{\sumf^{(\schm_2,\initval)}}$ are identical to zero and hence can be removed.
Because for all $j\in[l]$, $\cstl^{^{\circled{C_1}}}_j, \dots, \cstl^{^{\circled{C_n}}}_j \in \{0,1\}$,   $(\lambda^{\circled{C_{i_2}}}_{j})^{\ell_2} \dots (\lambda^{\circled{C_{i_{s_1}}}}_{j})^{\ell_{s_1}} = \lambda^{\circled{C_{i'_2}}}_{j} \dots \lambda^{\circled{C_{i'_{s_2}}}}_{j}$. We proved that the $(\ast)$ and $(\ast\ast)$ style expressions are equivalent in both $\schm_1$ and $\schm_2$.
Hence we can also remove all subexpressions containing $\ell_1$ from  $\eval{O(q_m)}{\sumf^{(\schm_1,\initval)}}$, without affecting its value.
Those subexpressions containing $\ell_2$ can also be removed by considering the cycle scheme $\schm_3=C_{i_2}^{\ell_2} C_{i''_3} \dots C_{i''_{s_3}}$ and applying a similar reasoning, where the sequence ${i''_3} \dots {i''_{s_3}}$ is obtained from ${i_3} \dots  i_{s_1}$, similarly to the construction of ${i'_2} \dots {i'_{s_2}}$ from $i_2 \dots i_{s,1}$. The same applies to all other cycle counter variables $\ell_3,\dots,\ell_{s_1}$.
We use the notation ${\sumf^{(\schm,\initval)}}^-(y_j)$ to denote the expression obtained by removing from the constant atom and coefficients of the non-constant atoms of $\sumf^{(\schm,\initval)}(y_j)$ all subexpressions containing cycle counter variables, for all $y_j \in Y$. 

\begin{lemma}\label{prop-bnd-domain-1}
	Suppose that the decision procedure has not returned $\ltrue$ after Step~II. For each cycle scheme $\schm$, let $f=\eval{O(q_m)}{\sumf^{(\schm, \sumf^{(H,\sval_\bot)})}}$ and $f'=\eval{O(q_m)}{{\sumf^{(\schm, \sumf^{(H,\sval_\bot)})}}^-}$. For all valuation $\rho$, $\eval{f}{\rho}\neq 0$ iff $\eval{f'}{\rho} \neq 0$.
\end{lemma}





\begin{lemma}\label{prop-bnd-domain-2}
Suppose that the decision procedure has not returned yet after Step II. 
For all cycle scheme $\schm$ and $y_j \in Y$, the constant atom and the coefficients of all non-constant atoms in ${\sumf^{(\schm, \sumf^{(H,\initval_\bot)})}}^-(y_j)$ are from a finite set $U \subset \intnum$ comprising \\ (1)
the constant atom and the coefficients of the non-constant atoms in the expression ${\sumf^{(C^{\ell_i}_{i}, \sumf^{(H,\initval_\bot)})}}^-(y_j)$ for $i\in [n]$ and $\ell_i \in \{1,2\}$,\smallskip\\(2) the numbers $\csta^{\circled{C_{s_2}}}_{j,j'} + \cstb^{\circled{C_{s_1}}}_{j,\pi^{\circled{C_{s_1}}}(j')}$ and $\csta^{\circled{C_{s_1}}}_{j, j''} + \csta^{\circled{C_{s_2}}}_{j,j''}$, where  $s_1,s_2 \in [n], j\in[l],j' \in I^{\circled{C_{s_1}}}_{tr} \cap I^{\circled{C_{s_2}}}_{tr},  j'' \in [k]$. 

\end{lemma}

For each cycle scheme $\schm$, an abstraction of ${\sumf^{(\schm, \sumf^{(H,\initval_\bot)})}}^-$, denoted by $\abs(\schm)$,  is the union of the following three sets:
(1)~constant atom: $\{(0, ( {\cste^{(\schm)}_{1}}^-,\dots, {\cste^{(\schm)}_l}^-))\}$. 
(2)~control variable atom: $\{(j', (c_{j',1},\dots, c_{j', l})) \mid j' \in [k]\}$, where $c_{j', j}$ is the coefficient of the ${\sumf^{(\schm,\sumf^{(H,\sval_\bot)})}}^-(x_{j'})$-atom in ${\sumf^{(\schm,\sumf^{(H,\sval_\bot)})}}^-(y_{j})$ for $j\in[l]$. (3)~data variable atom: $\{(k+1, (c_1,\dots,c_l))\}$, where $(c_1,\dots,c_l) \in U^l$ is the coefficients of the $\vard'$-atom in ${(\sumf^{(\schm,\sumf^{(H,\sval_\bot)})}}^-(y_{j})$ for all $j \in [l]$ and $\vard'\not\in \{{\sumf^{(\schm,\sumf^{(H,\sval_\bot)})}}^-(x_{j'})\mid x_{j'}\in X\}$.
Let $\mathscr{A}=\bigcup \{\abs(\schm) \mid \schm \mbox{ a cycle scheme}\}$. Then $\mathscr{A}$ can be constructed as follows. We first compute $\abs(HC_1), \ldots \abs(HC_n)$ and then compute the next abstract elements from them w.r.t. $C_1\ldots C_n$ until reached a fixed point.\medskip\\
\framebox[\textwidth]{
	\begin{minipage}{0.95\textwidth}
		\noindent {\bf Step III} We first construct the set $\mathscr{A}$ and then. 
		\begin{enumerate}
			\item Check whether there is $(0,(c_{0,1},\dots,c_{0,l})) \in \mathscr{A}$ such that $a_0+b_1 c_{0,1}+\dots + b_l c_{0,l} \neq 0$. If the answer is yes, then return $\ltrue$.
			%
			\item Check whether there are $j' \in [k]$ and $(j', (c_{j',1},\dots,c_{j',l})) \in \mathscr{A}$ such that $a_{j'} + b_1 c_{j',1} + \dots + b_l c_{j',l} \neq 0$. If the answer is yes, then return $\ltrue$. 
			%
			\item Check whether there is $(k+1,(c_1,\dots,c_l)) \in \mathscr{A}$ such that $b_1 c_1 + \dots + b_l c_l \neq 0$. If the answer is yes, then return $\ltrue$. 
		\end{enumerate}
		If the decision procedure has not returned yet, return $\lfalse$.
	\end{minipage}
}\smallskip\\

\vspace{-0.5cm}
\subsection{Decision procedure for SNTs without Constants}\label{sec-gflat}
\vspace{-0.3cm}

We generalize the decision procedure for the case that the transition graphs of the SNTs are generalized lassos to the full class of SNTs.
We first define a \emph{generalized multi-lasso} as a sequence $\gmlasso= H_1 (C_{1,1},\dots,C_{1,n_1}) H_2 (C_{2,1},\dots,C_{2,n_2}) \dots H_r (C_{r,1},\dots, C_{r, n_r})$ s.t. (1) for each $s\in[r]$, $H_s = q_{s,1} \dots q_{s, m_s}$ and $H_s (C_{s,1},\dots,C_{s, n_s})$ is a generalized lasso, (2) for $1 \leq s< s' \leq r$, $H_s (C_{s,1},\dots,C_{s, n_s})$ and $H_{s'} (C_{s', 1},\dots,C_{s', n_{s'}})$ are state-disjoint, except the case that when $s'=s+1$, $q_{s, m_s}=q_{s',1}$, and (3) $q_{1,1}=q_0$.

Since the transition graph of $\Ss$ can be seen as a collection of generalized multi-lassos, in the following, we shall present the decision procedure by showing how to decide the non-zero output problem for generalized multi-lassos. 

We fix a generalized multi-lasso

\smallskip
\hspace{8mm} $\gmlasso= H_1 (C_{1,1},\dots,C_{1,n_1}) H_2 (C_{2,1},\dots,C_{2,n_2}) \dots H_r (C_{r,1},\dots, C_{r, n_r})$.

\smallskip
\noindent Without loss of generality, we assume that $O(q_{r,m_r})=a_0+a_1 x_1 + \dots + a_k x_k + b_1 y_1  + \dots + b_l y_l$ and $O(q')$ is undefined for every other state $q'$ in $\gmlasso$.\smallskip\\
\framebox[\textwidth]{
	\begin{minipage}{0.95\textwidth}
		\noindent {\bf Step I$'$}. We do the same analysis as in Step I for the path $H_1\dots H_r$.
	\end{minipage}
}\smallskip

Let $s\in [2,r]$. In order to analyze the set of cycles $\Cc=\{C_{s-1,1},\dots,C_{s-1,n_{s-1}}\}$, below we show how to summarize effect of the path $H_s\dots H_r$ to $O(q_{s-1, m_{s-1}})$, which is shared by all those cycles in $\Cc$.
Suppose that $\eval{O(q_{r,m_r})}{\sumf^{(H_s\dots H_{r}, \initval)}}=a_{s, 0}+a_{s, 1} \initval(x_1)+ \dots + a_{s, k} \initval(x_k) + b_{s,1} \initval(y_1) + \dots + b_{s, l} \initval(y_l)+e$, where $e$ is a linear combination of the data variables that represent the data values introduced when traversing $H_s\dots H_r$. 
%the constant atom is $a_{s,0}$, the coefficient of the $\initval(x_j)$-atom is $a_{s, j}$ for each $j \in [k]$, and the coefficient of the $\initval(y_{j'})$-atom is $b_{s, j'}$ for each $j' \in [l]$. 
Then we change the output function and let
$O(q_{s-1, m_{s-1}}):=a_{s, 0}+a_{s, 1} x_1 + \dots + a_{s, k} x_k + b_{s,1} y_1 + \dots + b_{s, l} y_l$.\smallskip\\
\framebox[\textwidth]{
	\begin{minipage}{0.95\textwidth}
\noindent {\bf Step II$'$}.  For each $s\in [r]$ and $s'\in [n_s]$, we check each cycle scheme $\schm = C^{\ell_1}_{s,s'} C_{i_{2}} \dots C_{i_{t}}$ such that $C_{i_{2}} \dots C_{i_{t}}\in \{C_{s, 1}, \dots, C_{s,n_s},\dots, C_{r,1}, \dots, C_{r,n_r}\}$ and $C_{i_{2}} \dots C_{i_{t}}$ are mutually distinct by performing an analysis of the expression $\eval{ O(q_{s, m_{s}})} {\sumf^{(\schm,\sumf^{(H_1 \dots H_{s}, \initval)} ) } }$, in a way similar to Step II. If the decision procedure does not return during the analysis, then go to Step III$'$.
	\end{minipage}
}\smallskip

Intuitively, in Step II$'$, during the analysis of $\eval{ O(q_{s, m_{s}})} {\sumf^{(\schm,\sumf^{(H_1 \dots H_{s}, \initval)} ) } }$, the effect of the paths $H_{s+1},  \dots,  H_r$ and the cycles $C_{i_{2}}, \dots, C_{i_{t}}$ is described by the expressions $\cstl^{\circled{H_{s+1}}}_j \dots \cstl^{\circled{H_{r}}}_j  \cstl^{\circled{C_{i_{2}}}}_j \dots \cstl^{\circled{C_{i_{t}}}}_j $ for $j \in [l]$. Since $O(q_{s, m_{s}})$ has already taken into consideration the expressions $\cstl^{\circled{H_{s+1}}}_j \dots \cstl^{\circled{H_{r}}}_j$ for $j \in [l]$, conceptually, in Step II$'$, we can do the analysis as if we have a generalized lasso where the handle is $H_1\dots H_s$ and the collection of cycles is $\{C_{s,1},\dots, C_{s,n_s}$, $\dots$, $C_{r,1},\dots, C_{r,n_r}\}$. 
%$\schm=C^{\ell_{s, 1}}_{i_{s,1}} \dots C^{\ell_{s, t_s}}_{i_{s, t_s}} C^{\ell_{s+1, 1}}_{i_{s+1, 1} } \dots C^{\ell_{s+1, t_{s+1}}}_{i_{s+1, t_{s+1}} } \dots C^{\ell_{r, 1}}_{i_{r,1}} \dots C^{\ell_{r, t_r}}_{i_{r, t_r}} $, where for each $s': s \le s' \le r$, $i_{s',1},\dots, i_{s', t_{s'}} \in [n_{s'}]$, 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\hide
{
At first, by using $O(q_m)$, we do the following computation, similarly to Step II: For each $i_1: 1 \le i_1 \le n$, if there are a cycle scheme $\schm$  
$HC_{i_1}^{\ell_1} C_{i_2}^{\ell_2} \dots C_{i_t}^{\ell_t}
$
or 
$HC_{i_1}^{\ell_1} C_{i_2}^{\ell_2} \dots C_{i_t}^{\ell_t} (C'_{i'_1})^{\ell'_1} (C'_{i'_2})^{\ell'_2} \dots (C'_{i'_{t'}})^{\ell'_{t'}}$,
and $j' \le k$ such that 
\begin{itemize}
\item $i_2,\dots,i_t \le n$ are mutually distinct, $\ell_2 = \dots = \ell_t = 1$, 
%
\item $i'_1,\dots,i'_{t'} \le n'$ are mutually distinct, $\ell'_2 = \dots = \ell'_{t'} = 1$, 
%
\item $\pi_{C_{i_1}}(j')=j'$, and $\mu_{\schm,(i_1,j')} \neq 0$ (recall that $\mu_{\schm,(i_1,j')}$ is obtained from the coefficient of $d^{(0)}_{\pi_H(j')-k}$ in  $\chi_\schm(O(q_m))$), 
\end{itemize}
then return $\ltrue$. 

Then by using $O(q'_{m'})$, we do the following: For each $i'_1: 1 \le i'_1 \le n'$, if there are a cycle scheme $\schm' =(C'_{i'_1})^{\ell'_1} (C'_{i'_2})^{\ell'_2} \dots (C'_{i'_{t'}})^{\ell'_{t'}}$, and $j' \le k$ such that
\begin{itemize}
\item $i'_2,\dots,i'_t \le n'$ are mutually distinct, $\ell'_2 = \dots = \ell'_t = 1$, 
%
\item $\pi_{C'_{i_1}}(j')=j'$, and $\mu_{\schm',(i'_1,j')} \neq 0$ (here $\mu_{\schm',(i_1,j')}$ is obtained from the coefficient of $d''_{j'}$ in  $\chi_{\schm'}(O(q'_{m'}))$, where $d''_1,\dots,d''_k$ denote the initial data values of $x_1,\dots,x_k$ respectively),
\end{itemize}
then return $\ltrue$. 

Similarly, we can apply an analysis for the constant coefficient to $\chi_\schm(O(q_m))$. 


If the decision procedure has not return yet, then go to Step III$'$. \qed
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
After Step II$'$, if the decision procedure has not returned yet, then similar to Lemma~\ref{prop-bnd-domain-2}, the following hold.
\begin{itemize}
\item For each $s \in [r]$ and each path $\schm=H_1 \schm_1 H_2 \dots H_s \schm_s$ such that for each $s'\in [s]$, $\schm_{s'}$ is a cycle scheme over the collection of cycles $\{C_{s',1},\dots,C_{s',n_{s'}}\}$, it holds that the constant atom and all the coefficients of the non-constant atoms in ${\sumf^{(\schm,\sval_\bot)}}^-(y_j)$ are from a bounded domain $U$.
%
\item Moreover,  an abstraction of $\schm$, denoted by $\abs(\schm)$, can be defined, so that $\mathscr{A}$, which contains the set of $\abs(\schm)$ for the paths $\schm=H_1 \schm_1 H_2 \dots H_s \schm_s$ (where $s \in [r]$), can be computed effectively from 
$H_1, C_{1,1}, \dots, C_{1,n_1},H_2,\dots, H_r,C_{r,1},\dots, C_{r,n_r}$.
\end{itemize}
%Similarly to the generalized lassos, we can construct a finite state automaton $\Aa'$ from $\chi_H,\chi_{C_1},\dots,\chi_{C_n},\chi_{H'}, \chi_{C'_1},\dots,\chi_{C'_{n'}}$ to record the coefficients in the states and simulate the evolvement of these coefficients. The final states of $\Aa$ represent the coefficients obtained when reaching the state $q'_{m'}$ in $\Ss$. 
\framebox[\textwidth]{
	\begin{minipage}{0.95\textwidth}
\noindent {\bf Step III$'$}. We apply the same analysis to $\mathscr{A}$ as in Step III. If the procedure does not return during the analysis, return $\lfalse$.
	\end{minipage}
}

\subsection{Decision procedure for SNTs}

We now consider the situation that the guards of the transitions in $\Ss$ may contain constants, that is, the atomic formulae of the form $cur \odot c$ for integer constants $c$. 

We illustrate the arguments for generalized lassos and adapt the decision procedure Step I-III to Step I$''$-III$''$ below. The arguments for the SNTs whose transition graphs are not necessarily generalized lassos are similar.

Suppose $H (C_1, \dots, C_n)$ is a generalized lasso, $H=q_0 \dots q_m$, and $O(q_m)=a_0 + a_1 x_1 + \dots + a_k x_k + b_1 y_1 + \dots + b_l y_l$.

From the guards and assignments of the transitions in $H$, we know that some of $\vard^{\circled{H}}_1,\dots, \vard^{\circled{H}}_{r^{\circled{H}}}$ have to be integer constants in $[c_{min}, c_{max}]$. Let $J^{\circled{H}} \subseteq [r^{\circled{H}}]$ denote the set of indices $j \in [r^{\circled{H}}]$ such that $\vard^{\circled{H}}_j$ has to be in $[c_{min}, c_{max}]$. Let $c^{\circled{H}}_j \in [c_{min}, c_{max}]$ denote this constant corresponding to $\vard^{\circled{H}}_j$. Since $\Ss$ is assumed to be normalized, we know that for each $j \not \in J^{\circled{H}}$,  $\vard^{\circled{H}}_j < c_{min}$ or $\vard^{\circled{H}}_j > c_{max}$.
%
%
%
%
\smallskip\\
\framebox[\textwidth]{
	\begin{minipage}{0.95\textwidth}
		\noindent {\bf Step I$''$}. For each $j \in [r^{\circled{H}}] \setminus J^{\circled{H}}$, decide whether the coefficient of the $\vard^{\circled{H}}_j$-atom in $\eval{O(q_m)}{\sumf^{(H,\initval_\bot)}}$ is nonzero. If the answer is yes, then return $\ltrue$. If the decision procedure has not returned yet, substitute each data variable $\vard^{\circled{H}}_j$ for $j \in J^{\circled{H}}$ with $c^{\circled{H}}_j$ in $\eval{O(q_m)}{\sumf^{(H,\initval_\bot)}}$. Then $\eval{O(q_m)}{\sumf^{(H,\initval_\bot)}}$ becomes an integer constant $c^{\circled{H}}$. If $c^{\circled{H}} \neq 0$, then return $\ltrue$.  Otherwise, go to Step II$''$.
	\end{minipage}
}\bigskip

For each $i_1 \in [n]$, let $J^{\circled{q_m}}$ denote the set of indices $j' \in [k]$ such that $\initval(x_{j'})$ has to be in $[c_{min}, c_{max}]$, which is enforced by the state $q_m$. Recall that the SNT $\Ss$ is state-dominating. Therefore, from the state $q_m$, we know which control variable should have a value in $[c_{min},c_{max}]$. For each $j' \in J^{\circled{q_m}}$, let $c^{\circled{q_m}}_{j'}$ denote this constant corresponding to $j'$. 

Let $\schm=C_{i_1}^{\ell_1} C^{\ell_2}_{i_2} \dots C^{\ell_t}_{i_t}$ be a cycle scheme. 
For each $i_1 \in [n]$, let $J^{\circled{C_{i_1}}}$ denote the set of indices $j'' \in [r^{\circled{C_{i_1}}}]$ such that there is $c^{\circled{C_{i_1}}}_{j''} \in [c_{min}, c_{max}]$ satisfying that for each $i \in [\ell_1]$, $\vard^{\circled{C_{i_1}, i}}_{1, j''}$ has to be equal to $c^{\circled{C_{i_1}}}_{j''}$, as a result of the guards and assignments on $C_{i_1}$. (Recall that the SNT $\Ss$ is required to be normalized). Note that the definition of $J^{\circled{C_{i_1}}}$ is independent of the choices of $\schm$.

Suppose $\schm=C_{i_1}^{\ell_1} C^{\ell_2}_{i_2} \dots C^{\ell_t}_{i_t}$ is a cycle scheme. Then for each $j' \in  I^{\circled{C_{i_1}}}_{pe} \setminus J^{\circled{q_m}}$, we can obtain $\mu_{\schm, (i_1,j')} \ell_1 + \nu_{\schm, (i_1,j')}$ as in Step II of Section~\ref{sec-glasso}. 

We then define $\mu'_{\schm,(i_1,0)} \ell_1 + \nu'_{\schm,(i_1,0)}$ as follows. Because $\initval(x_{j'})$ is a constant for each $j' \in J^{\circled{q_m}}$, and for each $j \in [r^{\circled{C_{i_1}}}]$ and $i \in [\ell_1]$, $\vard^{\circled{C_{i_1}, i}}_{1, j}$ is a constant, we should take as a group the constant atom of  $\eval{O(q_m)}{\sumf^{(\schm,\initval)}}$, the $\initval(x_{j'})$-atoms for $j' \in J^{\circled{q_m}}$, and the $\vard^{\circled{C_{i_1}, i}}_{1, j}$-atoms for $j \in [r^{\circled{C_{i_1}}}]$ and $i \in [\ell_1]$.
%
Recall that the constant atom of $\eval{O(q_m)}{\sumf^{(\schm,\initval)}}$ contains the following  subexpression,
\begin{center}
	\vspace{-0.2cm}
	\resizebox{0.8\hsize}{!}{$
		e_0:= \sum \limits_{1 \le j \le l} b_j
		\begin{array}{l}
		\left((\lambda^{\circled{C_{i_2}}}_{j})^{\ell_2} \dots (\lambda^{\circled{C_{i_t}}}_{j})^{\ell_t}\right)
		\left(1+\lambda^{\circled{C_{i_1}}}_{j} + \dots + (\lambda^{\circled{C_{i_1}}}_{j})^{\ell_1-1} \right) \cste^{\circled{C_{i_1}}}_{j}. 
		\end{array}
		$}
\end{center}
Moreover, for each $j' \in  J^{\circled{q_m}} \cap I^{\circled{C_{i_1}}}_{pe}$, the coefficient of the $\initval(x_{j'})$-atom of $\eval{O(q_m)}{\sumf^{(\schm,\initval)}}$ contains the following subexpression, 
\begin{center}
	\resizebox{0.8\hsize}{!}{$
		e_{j'} := \sum \limits_{1 \le j \le l} 
		%\begin{array}{l}
		b_j \left((\cstl^{\circled{C_{i_2}}}_{j})^{\ell_2} \dots (\cstl^{\circled{C_{i_t}}}_{j})^{\ell_t}\right) 
		\left(1+\cstl^{\circled{C_{i_1}}}_{j} + \dots + (\cstl^{\circled{C_{i_1}}}_{j})^{\ell_1-1} \right) \csta^{\circled{C_{i_1}}}_{j,j'}.
		%\end{array} \hspace{1cm}  
		$}
\end{center}

For each $j'' \in J^{\circled{C_{i_1}}} \cap \rng(\pi^{\circled{C_{i_1}}})$ and $i \in [\ell_1]$, the coefficient of the $\vard^{\circled{C_{i_1}, i}}_{1, j''}$-atom of $\eval{O(q_m)}{\sumf^{(\schm,\initval)}}$ contains the following subexpression, 
\begin{center}
	\resizebox{0.95\hsize}{!}{$
		f_{j'',i} := \sum \limits_{1 \le j \le l} 
		%\begin{array}{l}
		b_j \left((\cstl^{\circled{C_{i_2}}}_{j})^{\ell_2} \dots (\cstl^{\circled{C_{i_t}}}_{j})^{\ell_t}\right) 
		\left((\cstl^{\circled{C_{i_1}}}_{j})^{\ell_1-i-1} \csta^{\circled{C_{i_1}}}_{j, (\pi^{\circled{C_{i_1}}})^{-1}(j'') } + (\cstl^{\circled{C_{i_1}}}_{j})^{\ell_1-i} \cstb^{\circled{C_{i_1}}}_{j,j'}\right).
		%\end{array}
		$}
\end{center}

For each $j'' \in J^{\circled{C_{i_1}}} \setminus \rng(\pi^{\circled{C_{i_1}}})$ and $i \in [\ell_1]$, the coefficient of the $\vard^{\circled{C_{i_1}, i}}_{1, j''}$-atom of $\eval{O(q_m)}{\sumf^{(\schm,\initval)}}$ contains the following subexpression, 
\begin{center}
	\resizebox{0.75\hsize}{!}{$
		f_{j'',i} := \sum \limits_{1 \le j \le l} 
		%\begin{array}{l}
		b_j \left((\cstl^{\circled{C_{i_2}}}_{j})^{\ell_2} \dots (\cstl^{\circled{C_{i_t}}}_{j})^{\ell_t}\right) 
		\left( (\cstl^{\circled{C_{i_1}}}_{j})^{\ell_1-i} \cstb^{\circled{C_{i_1}}}_{j,j'}\right).
		%\end{array}
		$}
\end{center}

Then we consider the expression 
\[e_0 + \sum \limits_{j' \in J^{\circled{q_m}} \cap I^{\circled{C_{i_1}}}_{pe}} (e_{j'} c^{\circled{q_m}}_{j'}) + \sum \limits_{j'' \in J^{\circled{C_{i_1}}} } \sum \limits_{i \in [\ell_1]} (f_{j'',i}\ c^{\circled{C_{i_1}}}_{j''}),\] 
which can be rewritten as $\mu'_{\schm,(i_1,0)} \ell_1 + \nu'_{\schm,(i_1,0)}$ for some integer constants $\mu'_{\schm, (i_1,0)}$ and $\nu'_{\schm, (i_1,0)}$. 
%If $\mu'_{\schm,(i_1,0)}=\mu_{\schm,(i_1,j')}=0$ for all $j' \in J^{\circled{q_m}} \cap I^{\circled{C_{i_1}}}_{pe}$, then we can ignore all subexpressions containing the cycle counter variable $\ell_1$ in   $\eval{O(q_m)}{\sumf^{(\schm,\initval)}}$, i.e., the subexpressions $\mu'_{\schm,(i_1,0)}\ell_1$ and $\mu_{\schm,(i_1,j')}\ell_1$ for all $j' \in J^{\circled{q_m}} \cap  I^{\circled{C_{i_1}}}_{pe}$.
%
\medskip\\
\framebox[\textwidth]{
	\begin{minipage}{0.95\textwidth}
		\noindent {\bf Step II$''$}. For each $i_1 \in [n]$, check all cycle scheme $\schm=C_{i_1}^{\ell_1} C_{i_2} \dots C_{i_t}$ such that $i_2,\dots,i_t$ are mutually distinct. There are only finitely many this kind of cycle schemes. If 
		one of the following constraints is satisfied, then return $\ltrue$. (1) There is $j' \in  I^{\circled{C_{i_1}}}_{pe} \setminus J^{\circled{q_m}}$ such that $\mu_{\schm,(i_1,j')} \neq 0$. (2) $\mu'_{\schm,(i_1,0)} \neq 0$.
		%
		If the decision procedure has not returned yet, then go to Step III$''$.
	\end{minipage}
}\smallskip\\

If after Step II$''$, the algorithm has not return yet, then similarly to Section~\ref{sec-glasso}, we can construct a finite set $U'' \subset \intnum$, which acts as a bounded domain for the constant atoms and the coefficients of non-constant atoms after removing all the subexpressions related to the cycle counting variables $\ell_1,\dots,\ell_t$. Moreover, we can construct the set $\mathscr{A''}$ of abstractions of cycle schemes.
%
\medskip\\
\framebox[\textwidth]{
	\begin{minipage}{0.95\textwidth}
		\noindent {\bf Step III$''$}. Similar to Step III, with $U,\mathscr{A}$ replaced by $U''$ and $\mathscr{A''}$.
	\end{minipage}
}\smallskip\\