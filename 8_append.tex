%!TEX root = main-cav.tex

\begin{appendix}

\section{Formal Semantics of the Programming Language}
\begin{figure}
	\hspace{-0.4cm}
	\scalebox{0.9}{
		\begin{tabular}{|l|l|}
			\hline
			Transitions&
			Side Condition\\
			\hline
			$(y := e;p, w, \rho) \longrightarrow (p, w, \rho')$&
			$\rho'=\rho[\eval{e}{\rho}/y]$\\
			
%			$\rho'(z) =\rho(z)$ for $z\neq y$, $\rho'(y) = \eval{\rho}{e}$\\
			
			$(y \addeq e;p, w, \rho) \longrightarrow (p, w, \rho')$&
			$\rho'=\rho[\eval{y+e}{\rho}/y]$\\
%			$\rho'(z) =\rho(z)$ for $z\neq y$, $\rho'(y) = \eval{y+e}{\rho}$\\
			
			$(\ite{g}{s_1}{s_2};p, w, \rho) \longrightarrow (s_1;p, w, \rho)$&
			$\rho \models g$\\
			
			$(\ite{g}{s_1}{s_2};p, w, \rho) \longrightarrow (s_2;p, w, \rho)$& $\rho \not \models g$\\
			
			$(\nnext;p, w, \rho) \longrightarrow (p, \tail(w), \rho')$&
			$\rho'=\rho[\head(w)/\cur]$ if $\rho(\cur) \neq \bot$ \\
			
			$(x':=x;p, w, \rho) \longrightarrow (p, w, \rho')$&
			$\rho'  =\rho[\rho(x)/x']$\\
			
			$(\loopL{s};\mbox{ret }r, w, \rho) \longrightarrow (s;\loopL{s};\mbox{ret }r, w, \rho)$& \\
			
			$(\loopL{s};\mbox{ret }r, \epsilon, \rho) \longrightarrow (\mbox{ret }r,  \epsilon, \rho)$& 	\\	
			\hline
			
		\end{tabular}
	}
	\caption{The Semantics of the Programming Language}
	\label{fig:semantics}
\end{figure}


Formally, the semantics of a program $p$ in the programming language is defined as a transition system in Fig.~\ref{fig:semantics}. Let $p$ be a reducer program and $w$ be an input data word.  Each configuration of the transition system is a triple $(p', w', \rho)$, where $p'$ is a program, $w'$ is a suffix of $w$, and $\rho$ is an valuation over $X^+\cup Y$ such that $\rho(\cur)=\head(w')$. 
Let $\rho_w$ be an assignment such that $\rho_w(\cur)=\head(w)$ and $\rho_w(z)=\bot$ for $z \in X \cup Y$.
The initial configuration is $(p, \tail{w}, \rho_w)$.
We use $p(w)$ to denote the \emph{output} of $p$ on $w$. Then $p(w) =d$ if there exists a path from the initial configuration $(p, w, \rho_w)$ to some return configuration $(\mbox{ret }r,  \epsilon, \rho_r)$ such that $
\eval{r}{\rho_r}=d$. Otherwise, $p(w)=\bot$. Since the program is deterministic, i.e., each input data word has at most one output, the semantics of $p$ is well-defined.

\section{Proofs in Section~\ref{sec:def-snt}}




\newcommand\assume{\mathsf{assume}}

\newcommand\loc{\mathfrak{l}}

\noindent {\bf Proposition~\ref{prop-mrprog-to-snt}}.
{\it 
For each reducer program $p$, an equivalent SNT $\Ss$ can be constructed.
}

\smallskip

\begin{proof}
We introduce a few notations first.

Let $s$ be a loop-free program. An \emph{execution path} $\pi$ of $s$ is a maximal path in the control flow graph of $s$ (here we use the standard definition of control flow graphs). Each execution path $\pi$ corresponds to a program $s_\pi$ obtained by sequentially composing the statements in $\pi$, where the statements $\assume(g)$ are used to represent the guards $g$. Then $s$ can be seen as a union of $s_\pi$, where $\pi$ ranges over the execution paths of $s$. 

Let $p$ be a reducer program of the form $s_1; \nnext; \loopL{s_2;\nnext}$; ret $r$.  In the following, we show how to construct an SNT $\Ss_p$ to simulate $p$.

The loop body $s_2;\nnext$ can be seen as a union of programs $p_\pi$ for execution paths $\pi$. We assume that no two distinct programs $p_\pi$ share locations. We first transform the loop into a collection of state-disjoint cycles $C_\pi$, one for each program $p_\pi$.  Let us focus on a program $p_\pi$. The set of states in $P_\pi$ comprises the location $\loc_0$ which is the entry point of the loop, and the locations succeeding each $\nnext$ statement in $p_\pi$. Moreover, we identify the location succeeding the last $\nnext$ statement and the entry point. The effect of the subprogram $s'$ between two successive $\nnext$ statements in the locations $\loc_1,\loc_2$ can be summarized into a transition $(\loc_0, g', \eta', \loc_1)$ resp. $(\loc_1, g', \eta', \loc_2)$ of $p_\pi$. This is possible due to the following two constraints: 1) the conditions $g$ in the statements $\ite{g}{s'_1}{s'_2}$  of $p_\pi$ are the conjunctions of $\cur \odot c$ and $\cur \odot x$, 2) the assignments to the control variables are of the form $x:=x'$ for $x' \in X^+$, and the assignments to the data variables are of the form $y:=e$ and $y {+=} e$, where $e$ contains only control variables or $\cur$. As a result of the two constraints, we can trace the evolvement of the values of the control variables and simulate all the statements $\assume(g)$ occurring in $s'$ by a guard $g'$ (obtained from these guards $g$ by some variable substitutions),  moreover, the effects of all the assignments therein can be summarized into an assignment function $\eta'$.  Similarly, we can do the same for the subprogram between the entry point and the first $\nnext$ statement of $p_\pi$.

In addition, each execution path of $s_1;\nnext$ can be simulated by a simple path of transitions of $\Ss_p$, which ends in the state $\loc_0$, the entry point of the loop.

The output function $O_p$ of $\Ss_p$ is defined as follow: $O_p(\loc_0) = r$ and $O(\loc)$ is undefined for each other state $\loc$.\qed
\end{proof}

\hide{
\begin{algorithm}[H]
	%  \SetAlgoLine
	\KwData{A reducer program $p$}
	$Q=\{q_0\}, \delta=\emptyset, O=\emptyset$, $\mathsf{toState}(p) =q_0$, $\mathsf{toVisit}=\{(\mathsf{toState}(p),p,\ltrue,\emptyset)\}$\;
	\While{$\mathsf{toVisit}\neq \emptyset$}{
		remove $(q,p,g,\eta)$ from $\mathsf{toVisit}$\;
		\Switch{$p$}{
			\lCase{$y := e;p'$,$y \addeq e;p'$,$x'=x;p'$: }{add $(q,p',g,\eta[e/y])$, $(q,p',g,\eta[(y+e)/y])$, $(q,p',g,\eta[x'/x])$ to $\mathsf{toVisit}$, respectively}
			\lCase{$\ite{g'}{s_1}{s_2};p'$: }{add both $(q,s_1;p',g\wedge g',\eta)$ and $(q,s_2;p',g\wedge \neg g',\eta)$ to $\mathsf{toVisit}$}
			\lCase{$\loopL{s;}\mbox{ret }r$: }{add both $(q,s;\loopL{s;}\mbox{ret }r,g,\eta)$ and $(q,\mbox{ret }r, g,\eta)$ to $\mathsf{toVisit}$}
			\lCase{$\nnext;p'$: }{\label{alg:next}
				\uIf{$\mathsf{toState}(p') \not\in Q$}{add $(\mathsf{toState}(p'),p',\ltrue,\emptyset)$ to $\mathsf{toVisit}$ and add $\mathsf{toState}(p')$ to $Q$}
				add $(q, \mathsf{toState}(p'),g,\eta)$ to $\delta$
			}
			\lCase{$\mbox{ret }r: $}{\label{alg:output}
				add a fresh state $q_r$ to $Q$, 
				add $(q, q_r,g,\eta)$ to $\delta$, and $O:=O[r/q_r]$}
		}
	}
	\Return $(Q,X,Y,\delta, \mathsf{toState}(p),O)$\;
	
	\caption{Translate a Reducer Program to a SNT}
	\label{fig:reducer2SNT}
\end{algorithm}
We use a tuple $(q,p,g,\eta)$ to store intermediate results of the translation, where $q$ is the source SNT state, $p$ is a reducer program, $g$ is a guard, and $\eta$ is an assignment.
The algorithm begins with the tuple $(p,p,\ltrue,\emptyset)$. The algorithm add a transition to SNT only when a $\nnext$ statement is encountered (line~\ref{alg:next}). When a $\mbox{ret }r$ statement is encountered, the algorithm adds a fresh state $q_r$ to the SNT and extends the output function to $O[r/q_r]$ (line~\ref{alg:output}).

The SNT returned from Algorithm~\ref{fig:reducer2SNT} is not yet generalized flat. It might have cycles sharing more than one states. All the cycles coming from the loop and branches inside the loop. There must be at least one state $s$ shared by all cycles. Therefore, we can make it generalized flat by duplicating all shared stated other than $s$ so all cycles will have their own copy of the shared states other than $s$.  
}

\vspace{4mm}

\noindent {\bf Proposition~\ref{prop-snt-cmm-to-eqv}}. 
\emph{The commutativity problem of SNTs is reduced to the equivalence problem of SNTs in exponential time}.

\begin{proof}
Suppose that $\Ss=(Q, X, Y, \delta, q_0, O)$ is an SNT such that $X=\{x_1,\dots,x_k\}$ and $Y=\{y_1,\dots,y_l\}$. Without loss of generality, we assume that the output of $\Ss$ is defined only for data words of length at least two. We will construct two SNTs $\Ss_1$ and $\Ss_2$ so that $\Ss$ is commutative iff $\Ss$ is equivalent to both $\Ss_1$ and $\Ss_2$.
\begin{itemize}
\item The intuition of $\Ss_1$ is that over a data word $w=d_1 d_2 d_3 \dots d_n$ with $n\ge 2$, $\Ss_1$ simulates the run of $\Ss$ over $d_2 d_1 d_3 \dots d_n$, that is, the data word obtained from $w$ by swapping the first two data values.
%
\item The intuition of $\Ss_2$ is that over a data word $w=d_1 d_2 d_3 \dots d_n$ with $n\ge 2$, $\Ss_1$ simulates the run of $\Ss$ over $d_2 d_3 \dots d_n d_1$, that is, the data word obtained from $w$ by moving the first data value to the end. 
\end{itemize}
The correctness of this reduction follows from Proposition 1 in \cite{CHSW15}.

\smallskip

\noindent {\it The construction of $\Ss_1$}.

Intuitively, over a data word $w=d_1d_2 d_3 \dots d_n$, we introduce an additional control variable $x'$ to store $d_1$, then simulates the run of $\Ss$ over $d_2 d_1 d_3 \dots d_n$ as follows: When reading $d_2$ in $w$, the data variables are updated properly by letting $x'$ to represent $d_1$ and $\cur$ to represent $d_2$.

Without loss of generality, we assume that for each pair of transitions $q_0 \xrightarrow{(g_1,\eta_1)} q_1 \xrightarrow{(g_2,\eta_2)} q_2$ starting from the initial state $q_0$ in $\Ss$, the following constraints are satisfied,
\begin{itemize}
\item $g_1$ does not contain any variable from $X$ (otherwise, $g_1$ would be evaluated to $\lfalse$),
%
\item for each variable $x \in X$ such that $x$ occurs in $g_2$, it holds that $x \in \dom(\eta_1)$,
%
\item after these two transitions, the values of all the variables from $\dom(\eta_1) \cup \dom(\eta_2)$ are defined, more specifically, for each $y \in Y \cap \dom(\eta_2)$ and each $z \in \vars(\eta_2(y))$, it holds that $z \in \dom(\eta_1)$.
\end{itemize}

Let $q'_{0},q'_{1} \not \in Q$ and $x' \not \in X$. Then $\Ss_1 = (Q \cup \{q'_{0},q'_1\}, X \cup \{x'\}, Y, \delta_1, q'_{0}, O_1)$ such that 
\begin{itemize}
\item $O_1(q'_0)$ and $O_1(q'_1)$ are undefined, and for each $q \in Q$, $O_1(q)=O(q)$,
%
\item $\delta_1$ is constructed from $\delta$ as follows,
\begin{itemize}
\item each element of $\delta$ is an element of $\delta_1$,
%
\item for each pair of transitions $q_0 \xrightarrow{(g_1,\eta_1)} q_1 \xrightarrow{(g_2,\eta_2)} q_2$ in $\Ss$, we add the transitions $(q_0, \ltrue, \eta'_1, q'_1)$ and $(q'_1, g', \eta'_2, q_2)$ into $\delta_1$, where $\eta'_1,g',\eta'_2$ are defined in the following. Suppose for each $y_j \in Y \cap \dom(\eta_1)$, $\eta_1(y_j)=a_{j} + b_{j}\cur$, and for each $y_j \in Y \cap \dom(\eta_2)$, 
\[\eta_2(y_j)= y_j + a'_{j} + b'_{j,0}  \cur + \sum\limits_{x_{j'} \in \dom(\eta_1)} b'_{j,j'} x_{j'},\] 
or 
\[
\eta_2(y_j) = a'_{j} + b'_{j,0} \cur + \sum \limits_{x_{j'} \in \dom(\eta_1)} b'_{j,j'} x_{j'} .
\]
Then $\eta'_1, g', \eta'_2$ are defined as follows.
\begin{itemize}
\item $\eta'_1(x')=\cur$, for each $x \in X \cap \dom(\eta_2)$, $\eta'_1(x)=\cur$, and for all the other variables $z$ from $X \cup Y$, $\eta'_1(z)$ is undefined.
%
\item $g' = g_1 \wedge g'_2$, where $g'_2$ is obtained from $g_2$ by replacing $\cur$ with $x'$, and each $x \in X$ with $\cur$.
%
\item For each $x \in X$, if $x \in \dom(\eta_2)$, then $\eta'_2(x)$ is undefined, otherwise, if $x \in \dom(\eta_1)$, then $\eta'_2(x)=\cur$, otherwise, $\eta'_2(x)$ is undefined.
%
\item For each $y_j \in Y$, if $y_j \in \dom(\eta_2)$, then 
\[
\begin{array}{l c l}
\eta'_2(y_j) & = & (a_{j} + b_{j}\cur) + a'_{j} + b'_{j,0} x' + \sum \limits_{x_{j'} \in \dom(\eta_1)} b'_{j,j'} \cur \\
& = & (a_{j} + a'_{j}) + b'_{j,0} x' + (b_{j}  + \sum \limits_{x_{j'} \in \dom(\eta_1)} b'_{j,j'} )\cur,
\end{array}
\]
or 
\[
\begin{array}{l c l}
\eta'_2(y_j) & = & a'_{j} + b'_{j,0} x' + \sum \limits_{x_{j'} \in \dom(\eta_1)} b'_{j,j'} \cur  \\
& = & a'_{j} + b_{j,0} x' + (\sum \limits_{x_{j'} \in \dom(\eta_1)} b'_{j,j'}  )\cur.
\end{array}
\]
%
Otherwise, if $y_j \in \dom(\eta_1)$, then $\eta'_2(y_j)= a_{j} + b_{j} \cur$. Otherwise, $\eta'_2(y_j)$ is undefined.
\end{itemize}
\end{itemize}
\end{itemize}
It is easy to see that the size of $\Ss_1$ is polynomial with respect to the size of $\Ss$.

\smallskip

\noindent {\it The construction of $\Ss_2$}.

Intuitively, over a data word $w=d_1\dots d_n$, we introduce an additional control variable $x'$ to store $d_1$, then simulates the run of $\Ss$ over $d_2\dots d_n d_1$: When reaching the end of $w$, $\Ss_2$ outputs immediately by using $x'$ to represent $d_1$ and simulating the last transition of $\Ss$ over $d_2 \dots d_n d_1$. In order to simulate \emph{deterministically} the last transition of $\Ss$ over $d_2 \dots d_n d_1$ when reading the end of $w$ (since SNTs are required to be deterministic), we need record in the states of $\Ss_2$ the relationship between $d_1$ and all the values stored in the control variables. This implies an exponential blow-up of the size of $\Ss_2$ with respect to $\Ss$.

Let $c_{max}$ and $c_{min}$ denote the maximum resp. minimum constant occurring the guards of the transitions of $\Ss$. As a convention, let $c_{max}=c_{min}=0$ if no constants occur in $\Ss$.

Suppose $q'_{0} \not \in Q$ and $x' \not \in X$. Then $\Ss_2 = (Q', Y, \delta_2, q'_{0}, O_2)$, where $O',\delta_2,O_2$ are defined as follows. 
\begin{itemize}
\item $Q' = \{q'_0\} \cup \left(Q \times \left([c_{\min}, c_{\max}] \cup \{-\infty,+\infty\}\right) \times X^{\{=, <, >,\bot\}} \right)$, where in a state $(q,(c, o)) \in Q'$, the third component $o$ denotes the relationship between $x'$ and $x$, e.g. $o(x)=<$ means that $x' < x$.
%
\item $\delta_2$ is defined as follows, 
\begin{itemize}
\item for each $c \in [c_{min}, c_{max}] \cup \{-\infty,+\infty\}$, $\delta_2$ contains $(q'_0,\ltrue,\eta, (q_0,(c, o_0)))$, where $\dom(\eta)=\{x'\}$, $\eta(x')=\cur$, and $o_0(x) = \bot$ for each $x \in X$,
%
\item for each $(q,g,\eta,q') \in \delta$ and $(q,(c,o)) \in Q'$ such that $g \wedge \bigwedge \limits_{x \in X, o(x) \neq \bot} x'\ o(x)\ x$ is satisfiable, $\delta_2$ contains the following three transitions, 
$(q,(c,o)) \xrightarrow{(g \wedge \cur = x', \eta)} (q',(c,o'_1))$, 
$(q,(c,o)) \xrightarrow{(g \wedge \cur< x', \eta)}  (q',(c,o'_2))$,
and  $(q,(c,o)) \xrightarrow{(g \wedge \cur > x', \eta)} (q',(c,o'_3))$, where 
for each $x \in X$, if $x \in \dom(\eta)$, then $o'_1(x) := \ =$, $o'_2(x):=\ >$, and $o'_3(x) :=\ <$, otherwise, $o'_1(x) = o'_2(x) = o'_3(x) := o(x)$.
\end{itemize}
%
\item $O_2$ is defined as follows: Let $(q,(c,o)) \in Q'$  such that there is $(q,g,\eta,q') \in \delta$ satisfying that $\left(g_c \wedge \bigwedge \limits_{x \in X, o(x) \neq \bot} \cur\ o(x)\ x \right) \models g$, and $O(q')$ is defined, where $g_c := \cur = c$ if $c \in [c_{min}, c_{max}]$, $g_c:=\cur < c_{min}$ if $c=-\infty$, and $g_c:=\cur > c_{max}$ otherwise. Suppose 
\[O(q')=a_0 + a_1 x_1 + \dots + a_k x_k + b_1 y_1 + \dots + b_l y_l.\]
Then let
\[O_2((q,(c,o)))=a_0 + a_1 \eta'(x_1) + \dots + a_k \eta'(x_k) + b_1 \eta'(y_1) + \dots + b_l \eta'(y_l),\]
where for each $z \in \dom(\eta)$, $\eta'(z)=\eta(z)$, and for all the other variables $z' \in X \cup Y$, $\eta'(z')=z'$.  \\
We would like to remark that $O_2$ is well-defined since for each $(q,(c,o)) \in Q'$, there is a unique $(q,g,\eta,q') \in \delta$ satisfying the aforementioned constraint, as a result of the determinism of $\Ss$.
\end{itemize}
%
Note that $\Ss_1$ and $\Ss_2$ constructed above preserve the generalized flatness of $\Ss$.
\qed
\end{proof}


\noindent {\bf Proposition \ref{prop-snt-eqv-to-nzero}}.
\emph{From SNT $\Ss_1$ and $\Ss_2$, a SNT $\Ss_3$ can be constructed in polynomial time such that $\Ss_1$ and $\Ss_2$ are  inequivalent iff there is a data word $w$ such that the output of $\Ss_3$ over $w$ is nonzero.}

\begin{proof}
Let $\Ss_1 = (Q_1,X_1,Y_1,\delta_1,q_{1,0}, O_1)$ and  $\Ss_2 = (Q_2,X_2,Y_2,\delta_2,q_{2,0}, O_2)$ be two SNTs. Without loss of generality, we assume that $Q_1 \cap Q_2 = \emptyset$, $X_1 \cap X_2 = \emptyset$, and $Y_1 \cap Y_2 = \emptyset$. 

Intuitively, we construct $\Ss$ as the product of $\Ss_1$ and $\Ss_2$. Specifically, $\Ss=(Q_1 \times Q_2, X_1 \cup X_2, Y_1 \cup Y_2, \delta, (q_{1,0},q_{2,0}), O)$, where
\begin{itemize}
\item $\delta$ comprises $((q_1,q_2), g_1 \wedge g_2, \eta_1 \cup \eta_2, (q'_1,q'_2))$ such that $(q_1,g_1,\eta_1,q'_1) \in \delta_1$ and $(q_2,g_2,\eta_2,q'_2) \in \delta_2$,
%
\item for each $(q_1,q_2) \in Q_1 \times Q_2$, 
\begin{itemize}
\item if $O_1(q_1)$ is defined and $O_2(q_2)$ is undefined or vice versa, then $O((q_1,q_2))=1$, 
%
\item otherwise, if both $O_1(q_1)$ and $O_2(q_2)$ are defined, then $O((q_1,q_2))=O_1(q_1) - O_2(q_2)$, 
%
\item otherwise (both $O_1(q_1)$ and $O_2(q_2)$ are undefined), $O((q_1,q_2))$ is undefined. 
\end{itemize}
\end{itemize}
From the aforementioned construction and the assumption that $\Ss$ is well-defined, it is easy to see that $\Ss_1$ and $\Ss_2$ are  inequivalent iff there is a data word $w$ such that the output of $\Ss$ over $w$ is non-zero.\qed
\end{proof}


\vspace{4mm}

\noindent {\bf Proposition~\ref{prop-snt-norm}}.
{\it From each SNT, an equivalent normalized SNT can be constructed in exponential time.} 


\newcommand{\tog}[1]{\mathsf{toGuard(#1)}}
\newcommand{\toec}[1]{\mathsf{toEqClass(#1)}}
\begin{proof}
Given an SNT $\Ss=(Q, X, Y, \delta, q_0, O)$, we show that an equivalent normalized SNT ${\Ss}'=(Q', X, Y, \delta', q'_0, O')$  can be constructed.

Before presenting the construction, we introduce some notations first.

Let $\sntcset_\Ss=\{\sntc^{<}_{1},\dots, \sntc^{<}_{k}\} \cup [c_{min}, c_{max}] \cup \{\sntc^{>}_{1},\dots, \sntc^{>}_{k}\}$ and $\cabs_\Ss$ denote the set of partial functions from some $X$ to $\sntcset_\Ss$. Intuitively, $\cabs_\Ss$ is the set of abstractions of the control variables, where $\sntc^{<}_{1},\dots, \sntc^{<}_{k}$ (resp. $\sntc^{>}_{1},\dots, \sntc^{>}_{k}$) are the $k$ colors to denote the control variables whose values are less than $c_{min}$ (resp. greater than $c_{max}$). For $f \in \cabs_\Ss$ and $x, x' \in X$, $x'$ is said to be a \emph{successor} of $x$ wrt. $f$ if one of the following holds: 
\begin{itemize}
\item either $f(x)=c$ and $f(x')=c+1$ for $c \in \intnum$ such that $c, c+1 \in [c_{min},c_{max}]$, or

\item $f(x) = \sntc^{<}_i$ and $f(x') = \sntc^{<}_{j}$ for $i,j: 1 \le i < j \le k$, and the range of $f$ does not contain any color from $\{\sntc^{<}_{i+1},\dots, \sntc^{<}_{j-1}\}$, or

\item $f(x) = \sntc^{>}_i$ and $f(x') = \sntc^{>}_{j}$ for some $i,j: 1 \le i < j \le k$, and and the range of $f$ does not contain any color from $\{\sntc^{>}_{i+1},\dots, \sntc^{>}_{j-1}\}$. 
\end{itemize}
For $x \in X$, $x$ is said to be the \emph{maximum} (resp. \emph{minimum}) control variable wrt. $f$ if $x \in \dom(f)$ and there is no $x' \in X$ such that $f(x')$ is a successor of $f(x)$ (resp. $f(x)$ is a successor of $f(x')$). Let $\sntcset^{<}_\Ss$ denote $\{\sntc^{<}_{1},\dots, \sntc^{<}_{k}\}$, similarly, let $\sntcset^{>}_\Ss$ denote $\{\sntc^{>}_{1},\dots, \sntc^{>}_{k}\}$. Two colors from $\sntcset^{<}_\Ss$ are said to be \emph{adjacent} if they are $\sntc^{<}_i$ and $\sntc^<_{i+1}$ for some $i: 1 \le i < k$. Similarly for two colors from $\sntcset^>_\Ss$. A linear order can be defined on $\sntcset^<_\Ss$ as follows: A color $\sntc^<_i$ is said to be less than $\sntc^<_j$ if $i<j$. A similar order relation can be defined over $\sntcset^>_\Ss$. Moreover, these two linear orders can be extended to a linear order on $\sntcset_\Ss$ in a natural way.

For $f \in \cabs_\Ss$, let $\varphi_f$ denote the constraint over control variables represented by $f$.
\[
\begin{array}{l c l }
\varphi_f  &:=& \bigwedge \limits_{f(x_i)=c,  c_{min} \le c \le c_{max}} x_i = c \ \wedge \\
&  & \bigwedge \limits_{f(x_i)=\sntc^{<}_{i'}, f(x_j)=\sntc^{<}_{j'}, i' < j' } (x_i < x_j \wedge x_j < c_{min})\  \wedge \\
& & \bigwedge \limits_{f(x_i)=\sntc^{<}_{i'}= f(x_j)}(x_i = x_j \wedge x_j < c_{min})\ \wedge \\
& & \bigwedge \limits_{f(x_i)=\sntc^{>}_{i'}, f(x_j)=\sntc^{>}_{j'}, i' < j' } (x_i < x_j \wedge x_i > c_{max})\ \wedge \\
& & \bigwedge \limits_{f(x_i)=\sntc^{>}_{i'}= f(x_j)} (x_i = x_j  \wedge x_i > c_{max}).
\end{array}
\]

Then $Q'= Q \times 2^Y \times \cabs_\Ss$, and $q'_0=(q_0, \emptyset, f_0)$ such that $\dom(f_0)=\emptyset$. Moreover, $O'$ is defined as follows: For each $(q, Z, f) \in Q'$, if $O(q)$  is defined and $\vars(O(q)) \subseteq \dom(f) \cup Z$, then $O'((q, Z, f))=O(q)$, otherwise, $O((q, Z, f))$ is undefined. It remains to define $\delta'$.

The transition set $\delta'$ is defined by the following rule: 
For each $(q, g, \eta, q') \in \delta$, $\delta'$ includes all the transitions $(q, Z, f) \xrightarrow{(g',\eta')} (q', Z', f')$ satisfying the following constraints. 
\begin{itemize}
\item For each $x \in \dom(f) \cap \dom(\eta)$, it holds that $\eta(x) \in \{\cur\} \cup \dom(f)$.  Intuitively, this means that if the original value of $x$ is defined  and $x$ is updated by $\eta$, then the value of $x$ after the update should be defined as well.

\item  For each $y \in Z \cap \dom(\eta)$, it holds that $\vars(\eta(y)) \subseteq \{\cur\} \cup  \dom(f) \cup Z$.  Intuitively, this means that if the original value of $y$ is defined and $y$ is updated by $\eta$, then the value of $y$ after the update should be defined as well.

\item $Z'$ is the union of $Z$ and the set of $y \in Y \cap \dom(\eta)$ such that $\vars(\eta(y)) \subseteq \{\cur\} \cup  \dom(f) \cup Z$.

\item $g',\eta', f'$ satisfy one of the following constraints.
\begin{itemize}
\item The guard $g' := g \wedge \cur = c$ such that $g' \wedge \varphi_f$ is satisfiable. The assignment $\eta'$ is the restriction of  $\eta$ to $Y$, that is, $\dom(\eta') = \dom(\eta) \cap Y$ and for each $y \in \dom(\eta')$, $\eta'(y)=\eta(y)$. The abstraction function $f'$ is defined as follows: For each $x \in X$ such that $\eta(x)=\cur$,  let $f'(x) = c$. Moreover, for each $x \in X$ such that $\eta(x) = x'$, let $f'(x)=f(x')$. For each $x \in X \setminus \dom(\eta)$, let $f'(x)=f(x)$.
 
\item The guard $g' := g \wedge \cur < c_{min} \wedge \cur = x$ such that $g' \wedge \varphi_f$ is satisfiable and $f(x)=\sntc^{<}_i$ for some $i$.  The assignment $\eta'$ is the restriction of  $\eta$ to $Y$. The abstraction function $f'$ is defined as follows: For each $x' \in X$ such that $\eta(x')=\cur$, let $f'(x')=f(x)$. Moreover, for each $x' \in X$ such that $\eta(x')=x''$, let $f'(x')=f(x'')$. For each $x \in X \setminus \dom(\eta)$, let $f'(x)=f(x)$.

\item The guard $g': = g \wedge \cur < c_{min} \wedge  x_i < \cur \wedge \cur < x_j$ such that $g' \wedge \varphi_f$ is satisfiable and $x_j$ is a successor of $x_i$ wrt. $f$. The assignment $\eta'$ is the same as $\eta$, except that for each $x \in X$ such that $\eta(x)=x'$, let $\eta'(x)$ undefined.  The abstraction function $f'$ is defined as follows: Let $f(x_i)=\sntc^{<}_{i'}$ and $f(x_j)=\sntc^{<}_{j'}$. 
\begin{itemize}
\item For each $x \in X$ such that $\eta(x)=x'$, let $f'(x)=f(x')$.
%
\item If there is $x \in X$ such that $\eta(x)=\cur$, we do the following: If $i'+1 < j'$, then let $f'(x)= \sntc^{<}_{i'+1}$. Otherwise, since $\rng(f) \setminus \{f(x) \mid \eta(x)=\cur\}$ contains at most $k-1$ colors from $\sntcset^<_\Ss$,  we can remove $\{x\mid \eta(x)=\cur\}$ from the domain of $f$ and adjust $f$ a bit so that $f(x_i)$ and $f(x_j)$ become non-adjacent, while preserving the order relation on $\sntcset^<_\Ss$. Let $f''$ denote the resulting function. Suppose $f''(x_i)=\sntc^<_{i''}$. Then let $f'(x)=\sntc^<_{i''+1}$  for each $x \in X$ such that $\eta(x)=\cur$.
%
\item For each $x \in X \setminus \dom(\eta)$, let $f'(x)=f(x)$. 
\end{itemize}

\item The guard $g' := g \wedge \cur < c_{min} \wedge  \cur < x_i$ such that $g' \wedge \varphi_f$ is satisfiable and $x_i$ is the minimum control variable wrt. $f$. The assignment $\eta'$ is the same as $\eta$, except that for each $x \in X$ such that $\eta(x)=x'$, let $\eta'(x)$ undefined.  The abstraction function $f'$ is defined as follows: Let $f(x_i)=\sntc^<_{i'}$.
\begin{itemize}
\item For each $x \in X$ such that $\eta(x)=x'$, let $f'(x)=f(x')$.
%
\item If there is $x \in X$ such that $\eta(x)=\cur$, we do the following: If $i' > 1$, then let $f'(x)= \sntc^{<}_{i'-1}$. Otherwise, since $\rng(f) \setminus \{f(x) \mid \eta(x)=\cur\}$ contains at most $k-1$ colors from $\sntcset^<_\Ss$,  we can remove $\{x \mid \eta(x)=\cur\}$ from the domain of $f$ and adjust $f$ a bit so that $f(x_i)$ become different from $1$, while preserving the order relation on $\sntcset^<_\Ss$. Let $f''$ denote the resulting function. Suppose $f''(x_i)=\sntc^<_{i''}$. Then let $f'(x)=\sntc^<_{i''-1}$ for each $x \in X$ such that $\eta(x)=\cur$. 

\item For each $x \in X \setminus \dom(\eta)$, let $f'(x)=f(x)$. 
\end{itemize}
%
\item The guard $g' := g \wedge \cur > c_{max} \wedge \cur = x$ for some $x$ such that $g' \wedge \varphi_f$ is satisfiable and $f(x)=\sntc^{>}_i$ for some $i$.  The assignment $\eta'$ is the restriction of  $\eta$ to $Y$. The abstraction function $f'$ is defined as follows: For each $x' \in X$ such that $\eta(x')=\cur$, let $f'(x')=f(x)$. Moreover, for each $x' \in X$ such that $\eta(x')=x''$, let $f'(x')=f(x'')$. 
%
\item The guard $g' := g \wedge \cur > c_{max} \wedge  x_i < \cur \wedge \cur < x_j$ such that $x_j$ is the successor of $x_i$ wrt. $f$ and $g' \wedge \varphi_f$ is satisfiable. The assignment $\eta'$ is the same as $\eta$, except that for each $x \in X$ such that $\eta(x)=x'$, let $\eta'(x)$ undefined.  The abstraction function $f'$ is defined as follows: Let $f(x_i)=\sntc^{>}_{i'}$ and $f(x_j)=\sntc^{>}_{j'}$. 
\begin{itemize}
\item For each $x \in X$ such that $\eta(x)=x'$, let $f'(x)=f(x')$.
%
\item If there is $x \in X$ such that $\eta(x)=\cur$, we do the following: If $i'+1 < j'$, then let $f'(x)= \sntc^{>}_{i'+1}$. Otherwise, since $\rng(f) \setminus \{f(x) \mid \eta(x)=\cur\}$ contains at most $k-1$ colors from $\sntcset^>_\Ss$,  we can remove $\{x \mid \eta(x)=\cur\}$ from the domain of $f$ and adjust $f$ a bit so that $f(x_i)$ and $f(x_j)$ become non-adjacent, while preserving the order relation on $\sntcset^>_\Ss$. Let $f''$ denote the resulting function. Suppose $f''(x_i)=\sntc^>_{i''}$. Then let $f'(x)=\sntc^>_{i''+1}$ for each $x \in X$ such that $\eta(x)=\cur$.

\item For each $x \in X \setminus \dom(\eta)$, let $f'(x)=f(x)$.  
\end{itemize}
%
\item The guard $g' := g \wedge \cur > c_{max} \wedge  \cur > x_i$ such that $g' \wedge \varphi_f$ is satisfiable and $x_i$ is the maximum control variable wrt. $f$. The assignment $\eta'$ is the same as $\eta$, except that for each $x \in X$ such that $\eta(x)=x'$, let $\eta'(x)$ undefined.  The abstraction function $f'$ is defined as follows: Let $f(x_i)=\sntc^>_{i'}$.
\begin{itemize}
\item For each $x \in X$ such that $\eta(x)=x'$, let $f'(x)=f(x')$.
%
\item If there is $x \in X$ such that $\eta(x)=\cur$, we do the following: If $i' < k$, then let $f'(x)= \sntc^{>}_{i'+1}$. Otherwise, since $\rng(f) \setminus \{f(x) \mid \eta(x)=\cur\}$ contains at most $k-1$ colors from $\sntcset^>_\Ss$,  we can remove $\{x \mid \eta(x)=\cur\}$ from the domain of $f$ and adjust $f$ a bit so that $f(x_i)$ become different from $k$, while preserving the order relation on $\sntcset^>_\Ss$. Let $f''$ denote the resulting function. Suppose $f''(x_i)=\sntc^>_{i''}$. Then let $f'(x)=\sntc^>_{i''+1}$ for each $x \in X$ such that $\eta(x)=\cur$. 

\item For each $x \in X \setminus \dom(\eta)$, let $f'(x)=f(x)$. 
\end{itemize}
\end{itemize}
\end{itemize}
\qed
\end{proof}

\section{Proofs in Section~\ref{sec-sum}}


\noindent {\bf Proposition~\ref{prop-sum-path}}.
{\it Suppose that $P$ is a path and the initial values of $X \cup Y$ are represented by a symbolic valuation $\initval$. Then the values of $X \cup Y$ after traversing the path $P$ are specified by a symbolic valuation $\sumf^{(P,\initval)}$ satisfying the following conditions.
\begin{itemize}
\item The set of indices of $X$, i.e., $[k]$, is partitioned into $I^{\circled{P}}_{pe}$ and $I^{\circled{P}}_{tr}$, the indices of \emph{persistent} and \emph{transient} control variables, respectively. A control variable is persistent if its value has not been changed while traversing $P$, otherwise, it is transient.
\item For each $x_j\in X$ such that $j\in I^{\circled{P}}_{pe}$, $\sumf^{(P,\initval)}(x_j)=\sval(x_j)$.
%
\item  For each $x_j\in X$ such that $j\in I^{\circled{P}}_{tr}$,
$\sumf^{(P,\initval)}(x_j)=\vard^{\circled{P}}_{\pi^{\circled{P}}(j)}$, where $\pi^{\circled{P}}: I^{\circled{P}}_{tr} \rightarrow [r^{\circled{P}}]$ is an injective mapping from the index of a transient control variable to the index of the data value assigned to it.
% 
\item For each $y_j \in Y$, 
$
 \sumf^{(P,\initval)}(y_j)  =
 \cste^{\circled{P}}_{j} + 
 \cstl^{\circled{P}}_j \initval(y_j)  + 
  \sum\limits_{j'\in [k]}\csta^{\circled{P}}_{j,j'}\initval(x_{j'}) +
  \sum\limits_{j''\in [r^{\circled{P}}]}\cstb^{\circled{P}}_{j,j''} \vard^{\circled{P}}_{j''}$,
\hide{
\item For each $y_j \in Y$, 
\[
\small
\begin{array}{l}
\smallskip
\sumf^{(P,\initval)}(y_j)  = \\
\hspace{2mm} \cste^{\circled{P}}_{j} + \cstl^{\circled{P}}_j \initval(y_j)  + \csta^{\circled{P}}_{j,1} \initval(x_1) + \dots + \csta^{\circled{P}}_{j,k} \initval(x_k) +  \cstb^{\circled{P}}_{j,1} \vard^{\circled{P}}_1 +\dots + \cstb^{\circled{P}}_{j,r^{\circled{P}}} \vard^{\circled{P}}_{r^{\circled{P}}},
\end{array}
\]} 
where $\cste^{\circled{P}}_j,\cstl^{\circled{P}}_j, \csta^{\circled{P}}_{j,1},\dots,\csta^{\circled{P}}_{j,k}, \cstb^{\circled{P}}_{j,1},\dots,\cstb^{\circled{P}}_{j,r^{\circled{P}}}$ are integer constants such that $\cstl^{\circled{P}}_{j} \in \{0,1\}$ (as a result of the ``independently evolving and copyless'' constraint).  It can happen that $\cstl^{\circled{P}}_j =0$,  which means that $\initval(y_j)$ is irrelevant to $\sumf^{(P,\initval)}(y_j)$. Similarly for $\csta^{\circled{P}}_{j,1}=0$, and so on.
\end{itemize}
}

\begin{proof}
Suppose that $\Ss=(Q,X,Y, \delta,q_0,O)$ is an (normalized) SNT. Suppose that $P=p_0 \xrightarrow{(g_1,\eta_1)} p_1 \dots p_{n-1} \xrightarrow{(g_n,\eta_n)} p_{n}$ is a path of $\Ss$ and $\initval$ is a symbolic valuation representing the  initial values of the control and data variables.  When $P$ is traversed in a run of $\Ss$ over a data word $w$,  the data value in a position of $w$ may have to be equal or unequal to the initial value of some control variable or some other data value in $w$ that have been met before (enforced by the guards and assignments in $P$). Let $\sim$ denote the equivalence relation on $[n]$ induced by $P$ such that $i \sim j$ iff the guards and assignments on $P$ enforce that the data value in the $i$-th position of $w$ must equal to that in the $j$-th position of $w$. Assuming that there are $r^{\circled{P}}$ equivalence classes of $\sim$, we use the variables $\vard^{\circled{P}}_1,\vard^{\circled{P}}_2,\dots, \vard^{\circled{P}}_{r^{\circled{P}}}$ to denote the data values met when traversing $P$, one for each equivalence class. 

We show by an induction that for each $i: 1 \le i \le n$, a symbolic valuation $\sumf_i$ over $X^+ \cup Y$ can be constructed  to describe the value of $x_j$ (resp. $y_j$) after going through the first $i$ transitions of $P$. Moreover, an index set $I_i \subseteq [k]$ is computed as well.
%
\begin{itemize}
\item Let $\sumf_0=\initval[\vard^{\circled{P}}_1/\cur]$ and $I_0 = \emptyset$.
%
%\item For each $x_j \in X$, if $x_j \in \dom(\eta_1)$, then $e_{1,x_j}=d^{(1)}_1$, otherwise, $e_{1,x_j}=d^{(0)}_j$. For each $y_j \in Y$, if $y_j \in \dom(\eta_1)$, then $e_{1,y_j} = \theta_0(\eta_{1}(y_j))$,
%otherwise, $e_{1,y_j}=o_j$. 
%
\item Let $i: 1 \le i \le n$. 
\begin{itemize}
\item For each $x_j \in X$, if $x_j \in \dom(\eta_i)$, then $\sumf_i(x_j)=\sumf_{i-1}(\cur)$ and $I_i= I_{i-1} \cup \{j\}$, otherwise, $\sumf_i(x_j) = \sumf_{i-1}(x_j)$ and and $I_i= I_{i-1}$. If $i < n$, suppose  the data value in the $(i+1)$-th position is represented by $\vard^{\circled{P}}_s$ for $1 \le s \le r^{\circled{P}}$, then let $\sumf_i(\cur)=\vard^{\circled{P}}_s$. Otherwise, $\sumf_i(\cur)=\bot$.
%
\item For each $y_j \in Y$, if $y_j \in \dom(\eta_i)$, then $\sumf_i(y_j) = \eval{\eta_i(y_j)}{\sumf_{i-1}}$, otherwise, $\sumf_i(y_j) =\sumf_{i-1}(y_j)$.
%
%\item For each $x_{j} \in X$ (resp. $y_j \in Y$), $\theta_i(x_{j})=e_{i,x_{j}}$ (resp. $\theta_i(y_{j})=e_{i, y_{j}}$). If $i < n$, then $\theta_i(\cur)=d^{(1)}_{s}$, where $1\le s \le r$ and $k+i + 1 \in I_s$, otherwise, $\theta_i(\cur)=\bot$.
\end{itemize} 
\end{itemize}
Then let $I^{\circled{P}}_{tr}:=I_n$ and $I^{\circled{P}}_{pe}:=[k] \setminus I^{\circled{P}}_{tr}$. The injective mapping $\pi^{\circled{P}}$ is defined as follows: For each $j \in I^{\circled{P}}_{tr}$, there is $s \in [r^{\circled{P}}]$ such that $\sumf_n(x_j)=\vard^{\circled{P}}_{s}$, let $\pi^{\circled{P}}(j)=s$. The symbolic valuation $\sumf^{(P,\initval)}$ can be defined as the restriction of $\sumf_n$ to $X \cup Y$. Since for each assignment $\eta_i$ and $y_j \in Y$, $\eta_i(y_j) = e$ or $\eta_i(y_j) = y_j +e$ for $e \in \Ee_{X^+}$, it follows that $\sumf^{(P,\initval)}(y_j)$ is of the form required by the proposition.
\qed
\end{proof}


\noindent {\bf Proposition~\ref{prop-sum-cycle}}.
{\it 
Suppose that $C$ is a cycle and $P=C^{\ell}$ such that $\ell \ge 2$. Then the symbolic valuation $\sumf^{(C^\ell,\initval)}$ to summarize the computation of $\Ss$ on $P$ is as follows,\medskip\\
\resizebox{\hsize}{!}{
$\begin{array}{l c l}
\sumf^{(C^\ell,\initval)}(y_j)  & = & 
\left(1 + \cstl^{\circled{C}}_{j} + \dots +(\cstl^{\circled{C}}_{j})^{\ell - 1} \right)\cste^{\circled{C}}_{j} + (\cstl^{\circled{C}}_{j})^\ell \initval(y_j) + \smallskip\\
%
& & \sum \limits_{j' \in I^{\circled{C}}_{pe}} \left(1+\cstl^{\circled{C}}_{j} + \dots +(\cstl^{\circled{C}}_{j})^{\ell - 1} \right) \csta^{\circled{C}}_{j,j'}\initval(x_{j'}) +  \sum \limits_{j' \in I^{\circled{C}}_{tr}}  (\cstl^{\circled{C}}_{j})^{\ell - 1} \csta^{\circled{C}}_{j,j'} \initval(x_{j'}) +  \\
%
& & \sum \limits_{j' \in \rng(\pi^{\circled{C}})} \sum \limits_{m\in[\ell -1]}
\left(  \csta^{\circled{C}}_{j, (\pi^{\circled{C}})^{-1}(j')} +(\cstl^{\circled{C}}_{j})\cstb^{\circled{C}}_{j,j'} \right)
(\cstl^{\circled{C}}_{j})^{\ell-m-1}
\vard^{\circled{C , m}}_{j'} +\\
%
& & \sum \limits_{j' \in [r^{\circled{C}}] \setminus \rng(\pi^{\circled{C}})}\sum \limits_{m\in[\ell -1]} \left((\cstl^{\circled{C}}_{j})^{\ell - m} \cstb^{\circled{C}}_{j,j'} \right) \vard^{\circled{C , m}}_{j'} + 
\sum \limits_{j' \in [r^{\circled{C}}] }  
 \cstb^{\circled{C}}_{j, j'} \vard^{\circled{C , \ell}}_{j'},
\end{array} 
$}\medskip\\
where the variables $\vard^{\circled{C , m}}_{1},\dots, \vard^{\circled{C , m}}_{r^{\circled{C}}}$ for $m\in [\ell-1]$
 represent the data values introduced when traversing $C$ for the $m$-th time.
}

%
\begin{proof}
We prove by an induction on $\ell$ that $\sumf^{(C^\ell,\initval)}(y_j)$ is of the desired form required by the proposition.

\noindent The induction base: $\ell=2$.

\smallskip

Let $\vard^{(\circled{C, 2})}_{1}, \dots, \vard^{(\circled{C, 2})}_{r^{\circled{C}}}$ be the data values introduced when traversing the cycle for the second time. Then from Corollary~\ref{cor-comp-two-paths}, we know that $\sumf^{(C^{2},\initval)} = \sumf^{(C,\sumf^{(C,\initval)})}$ is defined as follows: For each $y_j \in Y$,

\[
\begin{array}{rl}
	\medskip
	\sumf^{(C^{2},\initval)}(y_j) = & 
	\left(\cste^{\circled{C}}_{j}+
	\cstl^{\circled{C}}_{j} \cste^{\circled{C}}_{j}\right)+ \left(\cstl^{\circled{C}}_{j}\right)^2 \initval(y_j)+ \sum \limits_{j' \in I^{\circled{C}}_{pe}} 
	\left(1+\cstl^{\circled{C}}_{j}\right)  \csta^{\circled{C}}_{j,j'} \initval(x_{j'}) +\\
	\medskip
	& 
	\sum \limits_{j' \in  I^{\circled{C}}_{tr}} 
	 \cstl^{\circled{C}}_{j} \csta^{\circled{C}}_{j,j'}  \initval(x_{j'}) +
	\sum \limits_{j' \in \rng(\pi^{\circled{C}})} \left( \csta^{\circled{C}}_{j,(\pi^{\circled{C}})^{-1}(j')}+\cstl^{\circled{C}}_{j} \cstb^{\circled{C}}_{j,j'} \right) \vard^{\circled{C,1}}_{j'} + 
	 \\
	%
	\smallskip
	& 
	\sum \limits_{j' \in [r^{\circled{C}}]\setminus \rng(\pi^{\circled{C}})} \left( \cstl^{\circled{C}}_{j} \cstb^{\circled{C}}_{j,j'} \right) \vard^{\circled{C,1}}_{j'} +
	
	\sum \limits_{j'\in[r^{\circled{C}}]} \cstb^{\circled{C}}_{j,j'} \vard^{\circled{C,2}}_{j'}.
\end{array}
\]

\noindent Induction step: Let $\ell \ge 3$.

From the induction hypothesis, we know that for each $y_j \in Y$, $\sumf^{(C^{\ell-1},\initval)}(y_j)$ is of the desired form.

From Corollary~\ref{cor-comp-two-paths}, $\sumf^{(C^\ell,\initval)} = \sumf^{(C, \sumf^{(C^{\ell-1},\initval)})}$. Then for each $y_j \in Y$, by unfolding the expressions $\sumf^{(C^{\ell-1},\initval)}(x_{j'})$ for $j' \in [k]$ and $\sumf^{(C^{\ell-1},\initval)}(y_{j''})$ for $j'' \in [l]$ in $\sumf^{(C, \sumf^{(C^{\ell-1},\initval)})}(y_j)$, we can observe that $\sumf^{(C^\ell,\initval)}(y_j)$ is of the desired form.
\qed
\end{proof}

\section{Proofs in Section~\ref{sec-glasso}}



\noindent {\bf Lemma~\ref{prop-cycle-schm}}.
{\it 
Suppose $\schm=C_{i_1}^{\ell_1} C_{i_2}^{\ell_2} \dots C_{i_t}^{\ell_t}$ is a cycle scheme, and $\initval$ is a symbolic valuation representing the initial values of the control and data variables. 
For all $j' \in  I^{\circled{C_{i_{1}}}}_{pe}$, let $r_{j'}$ be the largest number $r \in [t]$ such that $j'\in\bigcap_{s\in[r]} I^{\circled{C_{i_{s}}}}_{pe}$, i.e., $x_{j'}$ remains persistent when traversing $C_{i_1}^{\ell_1} C_{i_2}^{\ell_2} \dots C_{i_{r_{j'}}}^{\ell_{r_{j'}}}$.
Then for each $j\in [l]$ and $j' \in  I^{\circled{C_{i_{1}}}}_{pe}$, the coefficient of the $\initval(x_{j'})$-atom in $\sumf^{(\schm,\initval)}(y_j)$ is 
\begin{center}
\resizebox{0.8\hsize}{!}{
$e+\sum\limits_{s_1\in[t]}  
\left(1+\lambda^{\circled{C_{i_{s_1}}}}_{j} + \dots + (\lambda^{\circled{C_{i_{s_1}}}}_{j})^{\ell_{s_1}-1} \right) \csta^{\circled{C_{i_{s_1}}}}_{j,j'}\prod\limits_{{s_2}\in[{s_1}+1,t]}\left(\lambda^{\circled{C_{i_{s_2}}}}_{j}\right)^{\ell_{s_2}}$},
\end{center}
where (1) $e\!=\!0$ when $r_{j'}\!=\!t$ and (2) $e=(\lambda^{\circled{C_{i_s}}}_{j})^{\ell_s-1} \csta^{\circled{C_{i_{s}}}}_{j,j'}$ with $s=r_{j'}+1$ when $r_{j'}<t$.\\
The constant atom of $\sumf^{(\schm,\initval)}(y_j)$ is 
\begin{center}
\resizebox{0.7\hsize}{!}{$
\sum\limits_{{s_1}\in[t]}
\left(1+\lambda^{\circled{C_{i_{s_1}}}}_{j} + \dots + (\lambda^{\circled{C_{i_{s_1}}}}_{j})^{\ell_{s_1}-1} \right)
\cste^{\circled{C_{i_{s_1}}}}_{j} 
\prod\limits_{{s_2}\in[{s_1}+1,t]}\left(\lambda^{\circled{C_{i_{s_2}}}}_{j}\right)^{\ell_{s_2}}$}
\end{center}
Moreover, for all $j \in [l]$, in $\sumf^{(\schm,\initval)}(y_j)$, only the constant atom and the coefficients of the $\initval(x_{j'})$-atoms with $j' \in  I^{\circled{C_{i_{1}}}}_{pe}$ contain a subexpression of the form $ \mu_\schm \ell_1$ for some $\mu_\schm\in \intnum$.
}

\begin{proof}
The lemma can be shown by applying Proposition~\ref{prop-sum-cycle}, Corollary~\ref{cor-comp-two-paths}, and an induction on the length $t$ of the cycle schemes.\qed
\end{proof}


\smallskip


\noindent {\bf Lemma~\ref{prop-bnd-domain-2}}.
{\it 
Suppose that the decision procedure has not returned yet after Step II. 
For all cycle scheme $\schm$ and $y_j \in Y$, the constant atom and the coefficients of all non-constant atoms in ${\sumf^{(\schm, \sumf^{(H,\initval_\bot)})}}^-(y_j)$ are from a finite set $U \subset \intnum$ comprises\\ 
(1)
the constant atom and the coefficients of the non-constant atoms in the expression ${\sumf^{(C^{\ell_i}_{i}, \sumf^{(H,\initval_\bot)})}}^-(y_j)$ for $i\in [n]$ and $\ell_i \in \{1,2\}$,\smallskip\\
(2) the numbers $\csta^{\circled{C_{s_2}}}_{j,j'} + \cstb^{\circled{C_{s_1}}}_{j,\pi^{\circled{C_{s_1}}}(j')}$ and $\csta^{\circled{C_{s_1}}}_{j, j''} + \csta^{\circled{C_{s_2}}}_{j,j''}$, where  $s_1,s_2 \in [n], j\in[l],j' \in I^{\circled{C_{s_1}}}_{tr} \cap I^{\circled{C_{s_2}}}_{tr},  j'' \in [k]$.
}

\begin{proof}
For each cycle scheme $\schm=C^{\ell_1}_{i_1} \dots C^{\ell_t}_{i_t}$ and each $y_j \in Y$, suppose for each $s\in [t]$, the data values introduced when traversing $C_{i_s}^{\ell_s}$ in $\schm$ are represented by the variables $\vard^{\circled{C_{i_s} , 1}}_{s,1}$, $\dots$, $\vard^{\circled{C_{i_s} , 1}}_{s,r^{\circled{C_{i_s}}}}$, $\dots$, $\vard^{\circled{C_{i_s} , \ell_s}}_{s,1}$, $\dots$, $\vard^{\circled{C_{i_s} , \ell_s}}_{s,r^{\circled{C_{i_s}}}}$. Then for each $y_j \in Y$,
 ${\sumf^{(\schm,\sumf^{(H,\initval_\bot)})}}^-(y_j)$ is a linear combination of $\vard^{\circled{H}}_1$, $\dots$, $\vard^{\circled{H}}_{r^{\circled{H}}}$, $\vard^{\circled{C_{i_1} , 1}}_{1,1}$, $\dots$, $\vard^{\circled{C_{i_1} , \ell_1}}_{1,r^{\circled{C_{i_1}}}}$, $\dots$, $\vard^{\circled{C_{i_t} , 1}}_{t,1}$, $\dots$, $\vard^{\circled{C_{i_t} , \ell_t}}_{t, r^{\circled{C_{i_t}}}}$. 

Suppose for each $y_j \in Y$,
\[
\begin{array}{l cl }
{\sumf^{(\schm,\sumf^{(H,\initval_\bot)})}}^-(y_j) &:= & (\cste^{\circled{\schm}}_{j})'  + (\csta^{\circled{\schm}}_{j,1})' \vard^{\circled{H}}_1 + \dots + (\csta^{\circled{\schm}}_{j,r^{\circled{H}}})' \vard^{\circled{H}}_{r^{\circled{H}}} + \\
& & (\cstb^{\circled{\schm,1}}_{1,1})' \vard^{\circled{C_{i_1},1}}_{1,1}  + \dots + (\cstb^{\circled{\schm,\ell_1}}_{1,r^{\circled{C_{i_1}}}})' \vard^{\circled{C_{i_1},\ell_1}}_{1,r^{\circled{C_{i_1}}}}  +  \\
& & \dots + \\
& & (\cstb^{\circled{\schm,1}}_{t,1})' \vard^{\circled{C_{i_{t}},1}}_{t,1} + \dots + (\cstb^{\circled{\schm,\ell_{t}}}_{t,r^{\circled{C_{i_{t}}}}})' \vard^{\circled{C_{i_{t}},\ell_{t}}}_{t, r^{\circled{C_{i_{t}}}}}.
\end{array}
\]

In the following, we show by induction on $t$ that for each cycle scheme $\schm=C^{\ell_1}_{i_1} \dots C^{\ell_t}_{i_t}$ and $y_j \in Y$, the following results hold.
\begin{enumerate}
\item In ${\sumf^{(\schm,\sumf^{(H,\initval_\bot)})}}^-(y_j)$, the constant atom and all the coefficients of the non-constant atoms are from $U$.
%
\item For each $\vard^{\circled{H}}_{j'}$ such that ${\sumf^{(\schm,\sumf^{(H,\initval_\bot)})}}^-(x_{j''})=\vard^{\circled{H}}_{j'}$ for some $j''  \in [k]$, the following fact holds: if there is $s \in [t]$ such that $\cstl^{\circled{C_{i_s}}}_j =0$, let $s_0$ be the maximum $s$ satisfying the constraint, then $(\csta^{\circled{\schm}}_{j,j'})'=\csta^{\circled{C_{i_{s_0}}}}_{j, j''}$, otherwise, $(\csta^{\circled{\schm}}_{j,j'})'= \beta^{\circled{H}}_{j,j'}$.
%
\item For each $s \in [t]$, $i \in [\ell_s]$, and $j' \in [r^{\circled{C_{i_s}}}]$ such that ${\sumf^{(\schm,\sumf^{(H,\initval_\bot)})}}^-(x_{j''})=\vard^{\circled{\schm, i}}_{s, j'}$ for some $j''  \in [k]$, it holds that $i = \ell_s$, $j'' \in I^{\circled{C_{i_s}}}_{tr}$, $j'' \in I^{\circled{C_{i_{s'}}}}_{pe}$ for each $s': s < s' \le t$, and the following fact holds: if there is $s': s < s' \le t$ such that $\cstl^{\circled{C_{i_{s'}}}}_j =0$, let $s'_0$ be the maximum $s'$ satisfying the constraint, then $(\cstb^{\circled{\schm, i}}_{j,j'})'=\csta^{\circled{C_{i_{s'_0}}}}_{j, j''}$, otherwise, $(\cstb^{\circled{\schm, i}}_{j,j'})'= \cstb^{\circled{C_{i_s}}}_{j,j'}$. 
\end{enumerate}

Induction base: $t=1$. 
\begin{itemize}
\item The first result: Follow from the definition of $U$. 

\item The second result: If $\cstl^{\circled{C_{i_1}}}_j = 0$, then $(\csta^{\circled{\schm}}_{j,j'})'=\csta^{\circled{C_{i_{1}}}}_{j, j''}$,  otherwise, $(\csta^{\circled{\schm}}_{j,j'})'=0$, since the expression $\csta^{\circled{C_{i_1}}}_{j,j''} \ell_1$ is removed from the coefficient of the $\sumf^{(H,\initval_\bot)}(x_{j''})$-atom in $\sumf^{(C^{\ell_1}_{i_1},\sumf^{(H,\initval_\bot)})}(y_j)$, i.e. the $\vard^{\circled{H}}_{j'}$-atom in $\sumf^{(C^{\ell_1}_{i_1},\sumf^{(H,\initval_\bot)})}(y_j)$. 

\item The third result: Suppose that $(\sumf^{(C^{\ell_1}_{i_1},\sumf^{(H,\initval_\bot)})})'(x_{j''})=\vard^{\circled{C_{i_1}, i}}_{1, j'}$ for $i \in [\ell_1]$, $j' \in [r^{\circled{C_{i_1}}}]$, and $j'' \in [k]$. Then $j'' \in I^{\circled{C_{i_1}}}_{tr}$, otherwise, $\vard^{\circled{C_{i_1}, i}}_{1, j'}$ would not be assigned to $x_{j''}$. From this, we deduce that $i = \ell_s$. Moreover, $(\csta^{\circled{C^{\ell_1}_{i_1}}}_{j,j'})'= \cstb^{\circled{C_{i_1}}}_{j,j'}$. 
\end{itemize}

Induction step: Suppose $t \ge 2$ and $\schm=C^{\ell_1}_{i_1} \dots C^{\ell_t}_{i_t}$.

Let $\schm_1= C^{\ell_1}_{i_1} \dots C^{\ell_{t-1}}_{i_{t-1}}$.  Then for each $y_j \in Y$, 
\[{\sumf^{(\schm,\sumf^{(H,\initval_\bot)})}}^-(y_j)=
{\sumf^{(C^{\ell_t}_{i_t},\ {\sumf^{(\schm_1, \sumf^{(H,\initval_\bot)})}}^-)}}^-(y_j).\] 

By the induction hypothesis, the three results hold for ${\sumf^{(\schm_1, \sumf^{(H,\initval_\bot)})}}^-$.

We illustrate the arguments for the case $\cstl^{\circled{C_{i_t}}}_{j} = 1$. The case $\cstl^{\circled{C_{i_t}}}_{j} = 0$ is simpler and can be discussed similarly. Suppose $y_j \in Y$.  In the following, we check that the constant atom and the coefficients of all the non-constant atoms of ${\sumf^{(\schm,\sumf^{(H,\initval_\bot)})}}^-(y_j)$ belong to $U$.  
%For brevity, we abbreviate an(resp. the) atom of ${\sumf^{(\schm,\sumf^{(H,\initval_\bot)})}}^-(y_j)$ as an (resp. the) atom below.
\begin{itemize}
	\item $(\cste^{\circled{\schm}}_{j})' = 0 + (\cstl^{\circled{C_{i_t}}}_{j})^{\ell_t} (\cste^{\circled{\schm_1}}_j)' = (\cste^{\circled{\schm_1}}_j)' \in U$ (here $\cste^{\circled{C_{i_t}}}_{j} \ell_t$ is removed).
	%
	\item For each $j' \in [r^{\circled{H}}]$ s.t. there exists no $j'' \in [k]$ satisfying that ${\sumf^{(\schm_1,\sumf^{(H,\initval_\bot)})}}^-(x_{j''})=\vard^{\circled{H}}_{j'}$, $(\csta^{\circled{\schm}}_{j, j'})' = (\cstl^{\circled{C_{i_t}}}_{j})^{\ell_t} (\csta^{\circled{\schm_1}}_{j, j'})' = (\csta^{\circled{\schm_1}}_{j, j'})' \in U$.
	%
	\item For each $j' \in [r^{\circled{H}}]$ such that ${\sumf^{(\schm_1,\sumf^{(H,\initval_\bot)})}}^-(x_{j''})=\vard^{\circled{H}}_{j'}$ for some $j''  \in I^{\circled{C_{i_t}}}_{pe}$, $(\csta^{\circled{\schm}}_{j, j'})' = 0 + (\cstl^{\circled{C_{i_t}}}_{j})^{\ell_t} (\csta^{\circled{\schm_1}}_{j, j'})'= (\csta^{\circled{\schm_1}}_{j, j'})' \in U$ (here $\csta^{\circled{C_{i_t}}}_{j,j'} \ell_t$ is removed). In this case, we have ${\sumf^{(\schm,\sumf^{(H,\initval_\bot)})}}^-(x_{j''})=\vard^{\circled{H}}_{j'}$. From the induction hypothesis, it is easy to see that the second result holds for $\schm$, $y_j$.
	%
	\item For each $j' \in [r^{\circled{H}}]$ such that ${\sumf^{(\schm_1,\sumf^{(H,\initval_\bot)})}}^-(x_{j''})=\vard^{\circled{H}}_{j'}$ for some $j''  \in I^{\circled{C_{i_t}}}_{tr}$, $(\csta^{\circled{\schm}}_{j, j'})' =(\cstl^{\circled{C_{i_t}}}_{j})^{\ell_t-1} \csta^{\circled{C_{i_t}}}_{j,j''} + (\cstl^{\circled{C_{i_t}}}_{j})^{\ell_t} (\csta^{\circled{\schm_1}}_{j, j'})' = \csta^{\circled{C_{i_t}}}_{j,j''} + (\csta^{\circled{\schm_1}}_{j, j'})' $. From the induction hypothesis, we know that either $(\csta^{\circled{\schm_1}}_{j, j'})' = \csta^{\circled{C_{i_{s_0}}}}_{j,j''}$ if there is $s$ such that $\cstl^{\circled{C_{i_s}}}_j =0$,  or otherwise, $(\csta^{\circled{\schm_1}}_{j, j'})'=\cstb^{\circled{H}}_{j, j'}$. Therefore, $(\csta^{\circled{\schm}}_{j, j'})' =\csta^{\circled{C_{i_t}}}_{j,j''} +  \csta^{\circled{C_{i_{s_0}}}}_{j,j''}$ or $\csta^{\circled{C_{i_t}}}_{j,j''}+ \cstb^{\circled{H}}_{j, j'}$. We conclude that $(\csta^{\circled{\schm}}_{j, j'})' \in U$.
	%
	\item For each $s \in [t-1]$, $i \in [\ell_s]$, and $j' \in [r^{\circled{C_{i_s}}}]$ such that there does not exist $j'' \in [k]$ satisfying that ${\sumf^{(\schm_1,\sumf^{(H,\initval_\bot)})}}^-(x_{j''}) = \vard^{\circled{C_{i_s}, i}}_{s, j'}$, it holds that $(\cstb^{\circled{\schm,i}}_{s,j'})' = (\cstl^{\circled{C_{i_t}}}_{j})^{\ell_t}  (\cstb^{\circled{\schm_1, i}}_{s, j'})'  =  (\cstb^{\circled{\schm_1, i}}_{s, j'})'  \in U$. 
	%
	\item For each $s \in [t-1]$, $i \in [\ell_s]$, and $j' \in [r^{\circled{C_{i_s}}}]$ such that ${\sumf^{(\schm_1,\sumf^{(H,\initval_\bot)})}}^-(x_{j''}) = \vard^{\circled{C_{i_s}, i}}_{s, j'}$ for some $j'' \in I^{\circled{C_{i_t}}}_{pe}$, $(\cstb^{\circled{\schm,i}}_{s,j'})' =(\cstl^{\circled{C_{i_t}}}_{j})^{\ell_t}  (\cstb^{\circled{\schm_1, i}}_{s, j'})'+ 0  =  (\cstb^{\circled{\schm_1, i}}_{s, j'})' \in U$ (here $\csta^{\circled{C_{i_t}}}_{j, j''} \ell_t$ is removed). Moreover, from the induction hypothesis, the third condition holds for $\schm$ and $y_j$.
	%
	\item For each $s \in [t-1]$, $i \in [\ell_s]$, and $j' \in [r^{\circled{C_{i_s}}}]$ such that ${\sumf^{(\schm_1,\sumf^{(H,\initval_\bot)})}}^-(x_{j''}) = \vard^{\circled{C_{i_s}, i}}_{s, j'}$ for some $j'' \in I^{\circled{C_{i_t}}}_{tr}$, it holds that $i = \ell_s$, $j'' \in I^{\circled{C_{i_s}}}_{tr}$, and for each $s': s < s' \le t$, $j'' \in I^{\circled{C_{i_{s'}}}}_{pe}$. Then $(\cstb^{\circled{\schm,i}}_{s,j'})' =(\cstl^{\circled{C_{i_t}}}_{j})^{\ell_t}  (\cstb^{\circled{\schm_1, i}}_{s, j'})' + \csta^{\circled{C_{i_t}}}_{j, j''}  =  (\cstb^{\circled{\schm_1, i}}_{s, j'})' + \csta^{\circled{C_{i_t}}}_{j, j''}$. From the induction hypothesis,  if there is $s': s < s' \le t-1$ such that $\cstl^{\circled{C_{i_{s'}}}}_j =0$, let $s'_0$ be the maximum $s'$ satisfying the constraint, then $(\cstb^{\circled{\schm_1, i}}_{j,j'})'=\csta^{\circled{C_{i_{s'_0}}}}_{j, j''}$, otherwise, $(\cstb^{\circled{\schm_1, i}}_{j,j'})'= \cstb^{\circled{C_{i_s}}}_{j,j'}$. Therefore, $(\cstb^{\circled{\schm,i}}_{s,j'})' = \csta^{\circled{C_{i_{s'_0}}}}_{j, j''} + \csta^{\circled{C_{i_t}}}_{j, j''}$ or $\cstb^{\circled{C_{i_s}}}_{j,j'} + \csta^{\circled{C_{i_t}}}_{j, j''}$, thus belongs to $U$. In this case, ${\sumf^{(\schm,\sumf^{(H,\initval_\bot)})}}^-(x_{j''})=\vard^{\circled{C_{i_t},\ell_t}}_{t, \pi^{\circled{C_{i_t}}}(j'')}$ and $(\cstb^{\circled{\schm,\ell_t}}_{t, \pi^{\circled{C_{i_t}}}(j'')})' = \cstb^{\circled{C_{i_t}}}_{j, \pi^{\circled{C_{i_t}}}(j'')}$. So the third condition holds for $\schm$ and $y_j$.
	%
	\item The coefficients of all the other atoms are those of  the $\vard^{\circled{C_{i_t}, i}}_{j, j'}$-atoms for $i \in [\ell_t]$ in ${\sumf^{(C^{\ell_t}_{i_t},\sumf^{(H,\initval_\bot)})}}^-(y_j)$.
\end{itemize} \qed

\end{proof}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%the proof of the claim%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Extension of the decision procedure: Constants in guards}

We now consider the situation that the guards of the transitions in $\Ss$ may contain constants, that is, the atomic formulae of the form $cur \odot c$ for integer constants $c$. 

We illustrate the arguments for generalized lassos and adapt the decision procedure Step I-III to Step I$''$-III$''$ below. The arguments for the SNTs whose transition graphs are not necessarily generalized lassos are similar.

Suppose $H (C_1, \dots, C_n)$ is a generalized lasso, $H=q_0 \dots q_m$, and $O(q_m)=a_0 + a_1 x_1 + \dots + a_k x_k + b_1 y_1 + \dots + b_l y_l$.

From the guards and assignments of the transitions in $H$, we know that some of $\vard^{\circled{H}}_1,\dots, \vard^{\circled{H}}_{r^{\circled{H}}}$ have to be integer constants in $[c_{min}, c_{max}]$. Let $J^{\circled{H}} \subseteq [r^{\circled{H}}]$ denote the set of indices $j \in [r^{\circled{H}}]$ such that $\vard^{\circled{H}}_j$ has to be in $[c_{min}, c_{max}]$. Let $c^{\circled{H}}_j \in [c_{min}, c_{max}]$ denote this constant corresponding to $\vard^{\circled{H}}_j$. Since $\Ss$ is assumed to be normalized, we know that for each $j \not \in J^{\circled{H}}$,  $\vard^{\circled{H}}_j < c_{min}$ or $\vard^{\circled{H}}_j > c_{max}$.
%
%
%
%
\smallskip\\
\framebox[\textwidth]{
\begin{minipage}{0.95\textwidth}
\noindent {\bf Step I$''$}. For each $j \in [r^{\circled{H}}] \setminus J^{\circled{H}}$, decide whether the coefficient of the $\vard^{\circled{H}}_j$-atom in $\eval{O(q_m)}{\sumf^{(H,\initval_\bot)}}$ is nonzero. If the answer is yes, then return $\ltrue$. If the decision procedure has not returned yet, substitute each data variable $\vard^{\circled{H}}_j$ for $j \in J^{\circled{H}}$ with $c^{\circled{H}}_j$ in $\eval{O(q_m)}{\sumf^{(H,\initval_\bot)}}$. Then $\eval{O(q_m)}{\sumf^{(H,\initval_\bot)}}$ becomes an integer constant $c^{\circled{H}}$. If $c^{\circled{H}} \neq 0$, then return $\ltrue$.  Otherwise, go to Step II$''$.
\end{minipage}
}\bigskip

For each $i_1 \in [n]$, let $J^{\circled{q_m}}$ denote the set of indices $j' \in [k]$ such that $\initval(x_{j'})$ has to be in $[c_{min}, c_{max}]$, which is enforced by the state $q_m$. Recall that the SNT $\Ss$ is state-dominating. Therefore, from the state $q_m$, we know which control variable should have a value in $[c_{min},c_{max}]$. For each $j' \in J^{\circled{q_m}}$, let $c^{\circled{q_m}}_{j'}$ denote this constant corresponding to $j'$. 

Let $\schm=C_{i_1}^{\ell_1} C^{\ell_2}_{i_2} \dots C^{\ell_t}_{i_t}$ be a cycle scheme. 
For each $i_1 \in [n]$, let $J^{\circled{C_{i_1}}}$ denote the set of indices $j'' \in [r^{\circled{C_{i_1}}}]$ such that there is $c^{\circled{C_{i_1}}}_{j''} \in [c_{min}, c_{max}]$ satisfying that for each $i \in [\ell_1]$, $\vard^{\circled{C_{i_1}, i}}_{1, j''}$ has to be equal to $c^{\circled{C_{i_1}}}_{j''}$, as a result of the guards and assignments on $C_{i_1}$. (Recall that the SNT $\Ss$ is required to be normalized). Note that the definition of $J^{\circled{C_{i_1}}}$ is independent of the choices of $\schm$.

Suppose $\schm=C_{i_1}^{\ell_1} C^{\ell_2}_{i_2} \dots C^{\ell_t}_{i_t}$ is a cycle scheme. Then for each $j' \in  I^{\circled{C_{i_1}}}_{pe} \setminus J^{\circled{q_m}}$, we can obtain $\mu_{\schm, (i_1,j')} \ell_1 + \nu_{\schm, (i_1,j')}$ as in Step II of Section~\ref{sec-glasso}. 

We then define $\mu'_{\schm,(i_1,0)} \ell_1 + \nu'_{\schm,(i_1,0)}$ as follows. Because $\initval(x_{j'})$ is a constant for each $j' \in J^{\circled{q_m}}$, and for each $j \in [r^{\circled{C_{i_1}}}]$ and $i \in [\ell_1]$, $\vard^{\circled{C_{i_1}, i}}_{1, j}$ is a constant, we should take as a group the constant atom of  $\eval{O(q_m)}{\sumf^{(\schm,\initval)}}$, the $\initval(x_{j'})$-atoms for $j' \in J^{\circled{q_m}}$, and the $\vard^{\circled{C_{i_1}, i}}_{1, j}$-atoms for $j \in [r^{\circled{C_{i_1}}}]$ and $i \in [\ell_1]$.
%
Recall that the constant atom of $\eval{O(q_m)}{\sumf^{(\schm,\initval)}}$ contains the following  subexpression,
\begin{center}
	\vspace{-0.2cm}
	\resizebox{0.8\hsize}{!}{$
e_0:= \sum \limits_{1 \le j \le l} b_j
\begin{array}{l}
 \left((\lambda^{\circled{C_{i_2}}}_{j})^{\ell_2} \dots (\lambda^{\circled{C_{i_t}}}_{j})^{\ell_t}\right)
\left(1+\lambda^{\circled{C_{i_1}}}_{j} + \dots + (\lambda^{\circled{C_{i_1}}}_{j})^{\ell_1-1} \right) \cste^{\circled{C_{i_1}}}_{j}. 
\end{array}
$}
\end{center}
Moreover, for each $j' \in  J^{\circled{q_m}} \cap I^{\circled{C_{i_1}}}_{pe}$, the coefficient of the $\initval(x_{j'})$-atom of $\eval{O(q_m)}{\sumf^{(\schm,\initval)}}$ contains the following subexpression, 
\begin{center}
	\resizebox{0.8\hsize}{!}{$
e_{j'} := \sum \limits_{1 \le j \le l} 
%\begin{array}{l}
b_j \left((\cstl^{\circled{C_{i_2}}}_{j})^{\ell_2} \dots (\cstl^{\circled{C_{i_t}}}_{j})^{\ell_t}\right) 
\left(1+\cstl^{\circled{C_{i_1}}}_{j} + \dots + (\cstl^{\circled{C_{i_1}}}_{j})^{\ell_1-1} \right) \csta^{\circled{C_{i_1}}}_{j,j'}.
%\end{array} \hspace{1cm}  
$}
\end{center}

For each $j'' \in J^{\circled{C_{i_1}}} \cap \rng(\pi^{\circled{C_{i_1}}})$ and $i \in [\ell_1]$, the coefficient of the $\vard^{\circled{C_{i_1}, i}}_{1, j''}$-atom of $\eval{O(q_m)}{\sumf^{(\schm,\initval)}}$ contains the following subexpression, 
\begin{center}
	\resizebox{0.95\hsize}{!}{$
f_{j'',i} := \sum \limits_{1 \le j \le l} 
%\begin{array}{l}
 b_j \left((\cstl^{\circled{C_{i_2}}}_{j})^{\ell_2} \dots (\cstl^{\circled{C_{i_t}}}_{j})^{\ell_t}\right) 
\left((\cstl^{\circled{C_{i_1}}}_{j})^{\ell_1-i-1} \csta^{\circled{C_{i_1}}}_{j, (\pi^{\circled{C_{i_1}}})^{-1}(j'') } + (\cstl^{\circled{C_{i_1}}}_{j})^{\ell_1-i} \cstb^{\circled{C_{i_1}}}_{j,j'}\right).
%\end{array}
$}
\end{center}

For each $j'' \in J^{\circled{C_{i_1}}} \setminus \rng(\pi^{\circled{C_{i_1}}})$ and $i \in [\ell_1]$, the coefficient of the $\vard^{\circled{C_{i_1}, i}}_{1, j''}$-atom of $\eval{O(q_m)}{\sumf^{(\schm,\initval)}}$ contains the following subexpression, 
\begin{center}
	\resizebox{0.75\hsize}{!}{$
f_{j'',i} := \sum \limits_{1 \le j \le l} 
%\begin{array}{l}
 b_j \left((\cstl^{\circled{C_{i_2}}}_{j})^{\ell_2} \dots (\cstl^{\circled{C_{i_t}}}_{j})^{\ell_t}\right) 
\left( (\cstl^{\circled{C_{i_1}}}_{j})^{\ell_1-i} \cstb^{\circled{C_{i_1}}}_{j,j'}\right).
%\end{array}
$}
\end{center}

Then we consider the expression 
\[e_0 + \sum \limits_{j' \in J^{\circled{q_m}} \cap I^{\circled{C_{i_1}}}_{pe}} (e_{j'} c^{\circled{q_m}}_{j'}) + \sum \limits_{j'' \in J^{\circled{C_{i_1}}} } \sum \limits_{i \in [\ell_1]} (f_{j'',i}\ c^{\circled{C_{i_1}}}_{j''}),\] 
which can be rewritten as $\mu'_{\schm,(i_1,0)} \ell_1 + \nu'_{\schm,(i_1,0)}$ for some integer constants $\mu'_{\schm, (i_1,0)}$ and $\nu'_{\schm, (i_1,0)}$. 
%If $\mu'_{\schm,(i_1,0)}=\mu_{\schm,(i_1,j')}=0$ for all $j' \in J^{\circled{q_m}} \cap I^{\circled{C_{i_1}}}_{pe}$, then we can ignore all subexpressions containing the cycle counter variable $\ell_1$ in   $\eval{O(q_m)}{\sumf^{(\schm,\initval)}}$, i.e., the subexpressions $\mu'_{\schm,(i_1,0)}\ell_1$ and $\mu_{\schm,(i_1,j')}\ell_1$ for all $j' \in J^{\circled{q_m}} \cap  I^{\circled{C_{i_1}}}_{pe}$.
%
\medskip\\
\framebox[\textwidth]{
	\begin{minipage}{0.95\textwidth}
		\noindent {\bf Step II$''$}. For each $i_1 \in [n]$, check all cycle scheme $\schm=C_{i_1}^{\ell_1} C_{i_2} \dots C_{i_t}$ such that $i_2,\dots,i_t$ are mutually distinct. There are only finitely many this kind of cycle schemes. If 
		one of the following constraints is satisfied, then return $\ltrue$. (1) There is $j' \in  I^{\circled{C_{i_1}}}_{pe} \setminus J^{\circled{q_m}}$ such that $\mu_{\schm,(i_1,j')} \neq 0$. (2) $\mu'_{\schm,(i_1,0)} \neq 0$.
		%
		If the decision procedure has not returned yet, then go to Step III$''$.
	\end{minipage}
}\smallskip\\

If after Step II$''$, the algorithm has not return yet, then similarly to Section~\ref{sec-glasso}, we can construct a finite set $U'' \subset \intnum$, which acts as a bounded domain for the constant atoms and the coefficients of non-constant atoms after removing all the subexpressions related to the cycle counting variables $\ell_1,\dots,\ell_t$. Moreover, we can construct the set $\mathscr{A''}$ of abstractions of cycle schemes.
%
\medskip\\
\framebox[\textwidth]{
	\begin{minipage}{0.95\textwidth}
		\noindent {\bf Step III$''$}. Similar to Step III, with $U,\mathscr{A}$ replaced by $U''$ and $\mathscr{A''}$.
	\end{minipage}
}\smallskip\\

\end{appendix}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



