\section{Case Studies}
\label{sec_cases}
In this section we discuss more challenging examples. 

\input{example2}
	
For cases with multiplication,division, or other more complicated functions at the return point, e.g., the \texttt{avg} case in Figure~\ref{fig:examples2}(b), we can model them as an \emph{uninterpreted $k$-ary function} and verify all $k$ parameters of the uninterpreted functions remain the same no matter how the input is permuted, e.g., the \texttt{avg} program always produces the same \texttt{sum} and \texttt{cnt} for all permutation of the same input list. This is a \emph{sound} but \emph{incomplete} procedure for verifying programs of this type. Nevertheless, it is not often that a  practical program for data analytics produces, e.g., $2q/2r$ from some input and $q/r$ for its permutation. Hence this procedure is often enough for proving commutativity for real world programs.

The case \texttt{MAD} (Mean Absolute Deviation) is a bit more involved. Beside the division operator $/$ that also occurs in the \texttt{avg} example, it uses a new list operation $\init$, which reset $\cur$ to the head of the input list. The strategy to verify this program is to divide the task into two parts: (1) ensure that the value of \texttt{avg} is independent of the order of the input, (2) treat \texttt{avg} as a symbolic variable and then check if the 2nd half of the program (the part after $\next$) is commutative. The latter requires an extension to the SNT decision problems. Given a list $l$, we say a list $l'$ is a $k$-permutation of $l$ iff there exists $\sigma_k\in S_|l|$ such that $\sigma_k(i)=i$ for $1\leq i\leq k$ and $l'=\sigma_k(l)$. A \emph{$k$-commutativity problem} of a SNT $\Ss$ asks whether for each data word $w$ and its $k$-permutation $w'$, $\Ss(w)=\Ss(w')$. The problem can be reduce to SNT equivalence problems in a similar way to the standard commutativity problem.

\begin{proposition}\label{prop-snt-kcmm-to-eqv}
	The $k$-commutativity problem of SNTs is reduced to the equivalence problem of SNTs in exponential time. 
\end{proposition}

To verify the 2nd task of the MAD example, we model \texttt{avg} as a control variable and assign the first value in the input data word to it. Then we can reduce the commutative problem of the 2nd part to the $1$-commutative problem of the corresponding SNT. We handle the division at the end of the problem in the same way as we did for the \texttt{avg} program.

The case \texttt{SD} (Standard Deviation) is more difficult to handle. The main difficulty comes from the use of multiplication in the middle of the program (instead of in the return point). In order to have a sound procedure to verify this kind of program, we will need the support of uninterpreted $k$-ary function also in the SNT transitions. However, this is not a trivial extension and we consider it as a future work.


